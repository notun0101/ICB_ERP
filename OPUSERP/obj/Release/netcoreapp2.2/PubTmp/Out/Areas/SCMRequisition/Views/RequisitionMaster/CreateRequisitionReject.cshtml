@model RequisitionViewModel
@{
    ViewData["Title"] = "Create Requisition";
}
<style>
    .cardimg {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .boxDesign {
        transition: .3s all;
    }

        .boxDesign:hover {
            transform: scale(.9);
            border: 1px solid black;
            box-shadow: 1px 1px gray;
        }

    .cardimg img {
        height: 70px;
        width: 70px;
        margin-top: 20px;
        border-radius: 50%;
        border: 1px solid;
        padding-top: 5px;
    }

    .card-body {
        text-align: left;
    }

    #divPanel .card-title {
        font-size: 18px !important;
    }

    #divChieldPanel {
        text-align: center;
    }
</style>
<form method="post" enctype="multipart/form-data" data-parsley-validate="parsley" id="FormId">
    <div class="card mb-2 mt-2">
        <div class="card-header">
            <div class="row">
                <div class="col-md-9">
                    <h5 class="card-title" style="color: black">@Model.fLang.title</h5>
                </div>
                <div class="col-md-2 pull-right">
                    <button type="button" class="btn btn-outline-primary pull-right" style="position: absolute;right: -91px" onclick="location.href='@Url.Action("Index", "RequisitionMaster")'"><i class='fa fa-backward'></i></button>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <input type="hidden" id="reqMasterId" name="reqMasterId" value="0" />
                <div class="col-6">
                    <div class="form-group row">
                        <label for="reqNo" class="col-sm-4 col-form-label">@Model.fLang.reqNo</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="reqNo" name="reqNo" value="" readonly />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="reqDate" class="col-sm-4 col-form-label">@Model.fLang.reqDate</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="reqDate" name="reqDate" disabled />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="reqDept" class="col-sm-4 col-form-label">@Model.fLang.reqDept</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="reqDept" name="reqDept" value="@ViewBag.DepartmentName" readonly />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="revremarks" class="col-sm-4 col-form-label">Review Remarks</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="revremarks" name="revremarks" value="@ViewBag.remarks" disabled />
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    @*<div class="form-group row">
                         <label for="subject" class="col-sm-4 col-form-label">@Model.fLang.bracsubject<span style="color:red;">*</span></label>
                         <div class="col-sm-8">
                             <textarea class="form-control" id="subject" name="subject"></textarea>
                         </div>
                        </div>*@

                    <div class="form-group row">
                        <label for="projectId" class="col-sm-4 col-form-label">@Model.fLang.projectName<span style="color:red;">*</span></label>
                        <div class="col-sm-8">
                            <select class="form-control" id="projectId" name="projectId" data-parsley-required="true" disabled>
                                @foreach (var data in Model.projects)
                                {
                                    <option value="@data.Id">@data.projectName</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="isPostPR" class="col-sm-4 col-form-label">@Model.fLang.isPostPR</label>
                        <div class="col-sm-8">
                            <select class="form-control" name="isPostPR" id="isPostPR" disabled>
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="isPostPR" class="col-sm-4 col-form-label">Source of Fund</label>
                        <div class="col-sm-8">
                            <select class="form-control" name="foundsourceId" id="foundsourceId" disabled>
                                <option value="">Select</option>
                                @foreach (var data in Model.fundSources)
                                {
                                    <option value="@data.Id">@data.sourceName</option>
                                }

                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="subject" class="col-sm-4 col-form-label">@Model.fLang.bracsubject<span style="color:red;">*</span></label>
                        <div class="col-sm-8">
                            <textarea class="form-control" id="subject" name="subject" disabled></textarea>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <div class="card mb-2">
        <div class="card-header">
            <h5 class="card-title" style="color: black">@Model.fLang.approvalPanel</h5>
        </div>
        <div class="card-body">
            <div class="row" id="divPanel">
                @*<div class="col-sm-3" style="width:200% ;border:solid .5px;">

                    <img class="card-img-top" src="~/images/HR_DB_Image/Artboard – 7.png" alt="Card image" style="width:200px;margin: 7% 0 0 15%;  border-radius: 50%;">
                    <div class="card-body" style="height:140px;">

                        <h4 class="card-title" id="hp">John Ahamed</h4>
                        <p class="card-text" id="hp">jr.Engineer</p>
                        <span style="font-size:.8em;font-weight:bold;float:right;">
                            <input type="button" class="btn btn-primary btn-sm pull-left cls' + index + ' clsSequenceNo" style="padding:0px 5px 0px 5px;" value="' + option.sequenceNo + '" />
                        </span>
                        <input type="hidden" class="clsUserId" value="' + option.nextApproverId + '" />
                      </div>
                    </div>*@

            </div>
        </div>
    </div>

    @*<div class="card col-md-3" >
        <div class="card-header">
            file name
        </div>
        <div class="card-body" style="text-align: center;">
            <i class="fa fa-file" style="font-size:40px;color:lightgray"> </i>
        </div>
        <div class="card-footer" style="text-align: center;">

        </div>
      
    </div> <br />*@


    

    <div class="card mb-2" style="display:none">
        <div class="card-header">
            <h5 class="card-title" style="color: black">@Model.fLang.itemDetails</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <input type="hidden" id="detailsId" name="detailsId" value="0" />
                <input type="hidden" id="itemId" name="itemId" value="0" />
                <input type="hidden" id="IsEdit" name="IsEdit" value="0" />
                <div class="col-6">
                    <div class="form-group row">
                        <label for="itemSpecification" class="col-sm-4  col-form-label">@Model.fLang.itemId<span style="color:red;">*</span></label>
                        <div class="col-sm-8">
                            <input type="hidden" id="itemSpecificationId" name="itemSpecificationId" />
                            <input type="text" data-parsley-required="true" data-parsley-trigger="keyup" class="form-control" name="itemSpecificationName" id="itemSpecificationName">
                        </div>
                    </div>

                    <div class="form-group row" style="display:none;">
                        <label for="itemId" class="col-sm-4 col-form-label">@Model.fLang.itemId<span style="color:red;">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="itemName" name="itemName" />
                        </div>
                    </div>
                </div>

                <div class="col-6">
                    <div class="form-group row">
                        <label for="reqQty" class="col-sm-4 col-form-label">@Model.fLang.reqQty<span style="color:red;">*</span></label>
                        <div class="col-sm-8">
                            <input type="number" class="form-control" id="reqQty" name="reqQty" />
                        </div>
                    </div>
                    <div style="display:none"></div>
                </div>

                <div class="col-12">
                    <div class="form-group row">
                        <label for="reqRate" class="col-sm-2 col-form-label">Estimated Cost<span style="color:red;">*</span></label>
                        <div class="col-sm-4">
                            <input type="number" class="form-control" id="reqRate" name="reqRate" />
                        </div>
                        <label for="employeeId" class="col-sm-2 col-form-label">Delivery Contact</label>
                        <div class="col-sm-4">
                            <select class="form-control" name="employeeId" id="employeeId">
                                <option value="">Select</option>
                                @foreach (var data in Model.employeeInfos)
                                {
                                    <option value="@data.Id">@data.nameEnglish-@data.designation</option>
                                }
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="cumulativeQty" class="col-sm-2  col-form-label">Cumulative Qty.</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control text-right" name="cumulativeQty" id="cumulativeQty" readonly>
                        </div>

                        <label for="unit" class="col-sm-2 col-form-label">Unit</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="unit" name="unit" readonly />
                        </div>
                    </div>


                </div>



                <div class="col-6">
                    <div class="form-group row">
                        <label for="reqDept" class="col-sm-4 col-form-label">Delivery Address</label>
                        <div class="col-sm-8">
                            <textarea type="text" class="form-control" id="deliveryaddress" name="deliveryaddress"></textarea>
                        </div>
                    </div>
                    <div class="form-group row" id="divJustify">
                        <label for="justification" class="col-sm-4 col-form-label">Justification<span style="color:red;">*</span></label>
                        <div class="col-sm-8">
                            <textarea type="text" class="form-control" id="justification" name="justification"></textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="targetDate" class="col-sm-4 col-form-label">@Model.fLang.targetDate<span style="color:red;">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="targetDate" name="targetDate" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-6">
                            <div class="from-group row">
                                <label for="chksrc" class="col-sm-9 col-form-label">@Model.fLang.preferableVendor</label>
                                <div class="col-sm-3">
                                    <input type="checkbox" name="source" id="chksrc" onclick="ShowSource()" style="width: 20px;height: 19px;margin-left: -45%;margin-top:3%;" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-6">
                    <div class="form-group row">

                        <label for="reqRate" class="col-sm-4 col-form-label">Budget Code</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="budgetCode" name="budgetCode" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="totalAmount" class="col-sm-4 col-form-label">@Model.fLang.totalAmount</label>
                        <div class="col-sm-8">
                            <input type="number" class="form-control" id="totalAmount" name="totalAmount" readonly />
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="lastPrice" class="col-sm-4 col-form-label">@Model.fLang.lastPrice</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="lastPrice" name="lastPrice" readonly />
                        </div>
                    </div>

                </div>
            </div>

            <div class="card" id="divsrc" style="display:none;">
                <div class="card-header row" style="margin: 0;">
                    <div class="col-3">
                        <div class="from-group row">
                            <label for="chkjustification" class="col-sm-9 col-form-label">Single Source</label>
                            <div class="col-sm-3">
                                <input type="radio" name="source" id="chkjustification" onclick="Showjustification()" style="width: 20px;height: 19px;margin-left: -93%;margin-top:3%;" />
                            </div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="from-group row">
                            <div class="col-sm-8">
                                <label for="chkCompititionWaiver" class="col-sm-11 col-form-label">Multiple Source</label>
                            </div>
                            <div class="col-sm-4">
                                <input type="radio" name="source" id="chkCompititionWaiver" onclick="ShowtxtSupplier()" style="width: 20px;height: 19px;margin-left: -93%;margin-top:3%;" />
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group row" id="divSupplier">
                            <input type="hidden" id="hdnSupplier" value="0" />
                            <label for="unit" class="col-sm-4 col-form-label">@Model.fLang.supplier</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control input-sm" id="supplier" name="supplier" />
                            </div>
                            <div class="col-sm-2">
                                <a href="javascript:void(0)" class="btn btn-info" onclick="AddSupplier()"><i class="fas fa-plus"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">

                    <div class="form-group row" id="divtblSupplier">
                        <input type="hidden" id="PreferableVendorsId" name="PreferableVendorsId" value="0" />
                        <div class="c">
                            <div class="row" id="tblSupplier1">

                            </div>
                        </div>



                    </div>
                </div>
            </div>


        </div>



        <div class="col-sm-12">


            <label for="pfiles" id="choseFile1" class="custom-file-upload" style="width:150px;margin-left: 7px;text-align:left;background-color:rgb(26,187,156);color:white">
                <i class="fa fa-cloud-upload">Choose Image</i>
            </label>

            <input type="file" class="" name="pfiles" id="pfiles" multiple="multiple" />
        </div>
        <div class="row ">
            <div class="col-md-12">
                <div class="row " id="dtAttachmentp5" style="margin-left:5px">

                </div>

            </div>

        </div>

        <hr style="margin:0" />
        <div class="row">
            <div class="col-12" style="margin-bottom: 7px;">
                <button type="button" onclick="AdditemDetails()" value="Add" title="Add" class="btn btn-success btn-lg ml-1" style="float:right; margin-top: 7px;margin-right: 20px;"><i class="fas fa-plus fa-w-1"></i></button>&nbsp;&nbsp;
                <button type="button" onclick="Refresh()" value="Refresh" title="Refresh" class="btn btn-success btn-lg ml-1" style="float:right; margin-top:7px;"><i class="fas fa-circle-notch"></i></button>
            </div>
        </div>


    </div>


    <div class="card mb-2">
        <div class="card-header">
            <h5 class="card-title" style="color: black">@Model.fLang.itemDetailsList</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-sm table-bordered table-responsive tableBody" id="tblitemDetails">
                        <thead style="width:100%">
                            <tr>
                                <th width="5%">Sl No.</th>
                                <th width="20%">@Model.fLang.itemId</th>

                                <th width="10%">Budget Code</th>
                                <th width="16%">@Model.fLang.targetDate</th>

                                <th width="10%">@Model.fLang.reqQty</th>
                                <th width="11%">Unit</th>
                                <th width="11%">Estimated Cost</th>

                                <th width="14%">@Model.fLang.totalAmount</th>

                            </tr>
                        </thead>
                        <tbody id="detailsData"></tbody>
                        <tfoot>
                            <tr><td colspan="7" style="text-align:right">Grand Total :</td><td colspan="2"><span class="pull-right" id="grandTotal"></span></td></tr>
                        </tfoot>
                    </table>

                    <div class="row">
                        <div class="col-sm-12">


                            <input type="file" class="" name="files" id="files" multiple="multiple" />
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</form>

<div class="row">
	<div class="card">
		<div class="card-header">
			Status Logs
		</div>
		<div class="card-body">
			<table class="table">
				<thead>
					<tr>
						<th>Req Date</th>
						<th>Req No</th>
						<th>Type</th>
						<th>Department</th>
						<th>Project Name</th>
						<th>Status</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var item in Model.statusLogs)
					{
						<tr>
							<td>@item.requisition?.reqDate</td>
							<td>@item.requisition?.reqNo</td>
							<td>@item.requisition?.reqType</td>
							<td>@item.requisition?.reqDept</td>
							<td>@item.requisition?.project?.projectName</td>
							<td>@item.Status</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>
</div>


<!-- New Item Specification -Modal-->
<div class="modal fade" id="addItemSpecificationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Item Specification</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <form id="frmaddItemSpecification" autocomplete="off" style="width:100%">
                        <div class="col-md-12">
                            <div class="form-group row">
                                <input type="hidden" id="itemIdspec" name="itemIdspec" />
                                <label for="itemDescription" class="col-sm-2 col-form-label">@Model.fLang.itemId</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="itemNamespec" name="itemNamespec" readonly>
                                    <input type="hidden" id="itemIdspec" name="itemIdspec" value="0" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="itemDescription" class="col-sm-2 col-form-label">@Model.fLang.itemSpecificationId</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="itemspecification" name="itemspecification">
                                </div>
                            </div>

                            <div class="form-group row">
                                <div class="col-md-6">
                                    <div class="form-group row">
                                        <label for="accountLedgerId" class="col-sm-4 col-form-label">Spec Category</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" name="specCategory" id="specCategory">
                                                <option value="">Select Category</option>
                                                @foreach (var data in Model.specificationCategories)
                                                {
                                                    <option value="@data.Id">@data.specificationCategoryName</option>
                                                }
                                            </select>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-6">
                                    <div class="form-group row">
                                        <label for="catValue" class="col-sm-4 col-form-label">Value</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="catValue" name="catValue">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-sm-11">
                                        </div>
                                        <div class="col-sm-1">
                                            <button type="button" onclick="AdditemDetailsSpec()" value="Add" title="Add" class="btn btn-success" style="float:right;"><i class="fas fa-plus fa-w-1"></i></button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <br />
                            <div class="row">

                                <input type="hidden" id="detailsIdSpec" name="detailsIdSpec" value="0" />
                                <input type="hidden" id="IsEditSpec" name="IsEditSpec" value="0" />
                                <div class="col-12">
                                    <table class="table table-bordered table-striped" id="tblitemDetailsSpec" data-parsley-required="true">
                                        <thead style="width:100%;background-color:lightgray;">
                                            <tr>
                                                <th style="width:40%">Specification Name</th>
                                                <th style="width:20%">Category</th>
                                                <th style="width:20%">Value</th>
                                                <th style="width:20%">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </form>


                </div>
            </div>
            <div class="modal-footer">
                <div class="col-sm-10">
                    <a href="javascript:void(0)" style="color:deepskyblue;" data-dismiss="modal">Cancel</a>
                </div>
                <div class="col-sm-2">
                    <button type="button" id="btnSaveItemSpec" class="btn-primary btn-sm">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts{
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-migrate-3.0.0.min.js" type="text/javascript"></script>
    @*<script src="~/js/jquery.autocomplete.js" type="text/javascript"></script>
        <script src="~/js/jquery.autocomplete.min.js" type="text/javascript"></script>*@
    <script type="text/javascript">
        //$('#btnSave').click(function () {
        //    console.log(data[0].value)
        //    swal({
        //        title: 'Are you sure?', text: 'Do you want to submit this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, submit it!'
        //    }).then(function () {

        //    });
        //})

        var formdata = new FormData();
        var pIndexattach = 0;
        var Indexattach = 0;
        var arrSupp = [];
        var arrSupImg = [];
        var arrReqImg = [];
        function GetApproverPanelList(response) {
            //console.log(response)
            $("#divPanel").empty();
            var divPanel = $("#divPanel");
            var inputPanel;
            var index = 0;
			$.each(response, function (id, option) {
				var designation = option.DesignationName;
				if (option.DesignationName == null) {
					designation = '';
				}
				//console.log(option)
                var source = option.imagePath;

                if (source == '' || source == null)
                {
                        source = "images/HR_DB_Image/male.png";
                }
                var empName = option.EmpName.substr(option.EmpName, 100);
                empName = empName.substr(0, Math.min(empName.length, empName.lastIndexOf(" ")))
                if (option.isActive == 0)
                {
					inputPanel = `<div class="col-sm-3" style="width:40% ;text-align: center;" id="divChieldPanel">
                                    <div class="card div${index} boxDesign" id="btnTotalLead">
                                        <div class="cardimg">
                                        <img class="card-img-top" src="/${source}" alt="Card image">
                                    </div>
                                    <div class="card-body" style="height:120px;">

                                                   <h4 class="card-title" style="font-size=18px !important; text-align: center !important;">${empName}</h4>
                                                   <p class="card-text" style="margin-bottom: 1%; text-align: center !important;">${designation}</p>

                                    </div>
                                         <div class="card-footer">
                                           <span style="font-size:.6em;font-weight:bold;">
                                            <input type="button" class="btn btn-primary btn-sm pull-left cls${index} clsSequenceNo" style="padding:0px 5px 0px 5px;" value="${option.sequenceNo}" />
                                        </span >
                                        </div>
                                        <input type="hidden" class="clsUserId" value="${option.nextApproverId}" />
                                    </div
                                </div>`
                    //inputPanel = '<div class="col-sm-3" style="width:200% ;border:solid .5px;">' +
                    //    '<a href="javascript:void(0)" class="btn btn-success div' + index + ' boxDesign" id="btnTotalLead" role="button" style="width:100%;float:left;color:black;background-color:#fff">' +
                    //   // '<div class="row">' +
                    //    //'<div class="col-md-4">' +
                    //    //'<span style="padding:0px 0px 0px 0px;">' +
                    //    ' <img class="card-img-top" src="~/images/HR_DB_Image/Artboard – 7.png" alt="Card image" style="width:200px;margin: 7% 0 0 15%;  border-radius: 50%;">' +
                    //    '<input type="button" class="btn btn-primary btn-sm pull-left cls' + index + ' clsSequenceNo" style="padding:0px 5px 0px 5px;" value="' + option.sequenceNo + '" />' +
                    //    '</span>' +

                    //    //'</div>' +
                    //    '<div class="card-body" style="height:140px;" >' +
                    //    '<h4 class="card-title" id="hp">' + empName + '</h4><br />' +
                    //    ' <p class="card-text"  id="hp">' + option.DesignationName + '</p>' +
                    //    '</div>' +

                    //    '</div>' +
                    //    '<div class="col-md-12" style="margin-top: -32px;">' +
                    //    ' <input type="text" class="form-control" id="" name="" style="margin-left: 62px;'+
                    //'width: 101px;'+
                    //'background: #f9a7a7" value="On Leave">' +

                    //    '</div>' +
                    //    '</a>' +
                    //    '<input type="hidden" class="clsUserId" value="' + option.nextApproverId + '" />'
                    //'</div>';

                    divPanel.append(inputPanel);
                }
                else
                {
					inputPanel = `<div class="col-sm-3" style="width:40% ;" id="divChieldPanel">
                                    <div class="card div${index} boxDesign" id="btnTotalLead">
                                        <div class="cardimg">
                                        <img class="card-img-top" src="/${source}" alt="Card image">
                                    </div>
                                    <div class="card-body" style="height:120px;">

                                                 <h4 class="card-title" style="text-align: center !important;">${empName}</h4>
                                                  <p class="card-text" style="margin-bottom: 1%; text-align: center !important;">${designation}</p>

                                    </div>
                                     <div class="card-footer">
                                                 <span style="font-size:.8em;font-weight:bold;">
                                                     <input type="button" class="btn btn-primary btn-sm pull-left cls${index} clsSequenceNo" style="padding:0px 5px 0px 5px;" value="${option.sequenceNo}" />
                                                 </span >
                                           </div>

                                        <input type="hidden" class="clsUserId" value="${option.nextApproverId}" />
                                    </div
                                </div>`

                    //inputPanel = '<div class="col-md-3" style="padding-left:0px;padding-right:0px;" id="divChieldPanel">' +
                    //    '<a href="javascript:void(0)" class="btn btn-success div' + index + ' boxDesign" id="btnTotalLead" role="button" style="width:100%;float:left;color:black;background-color:#fff">' +
                    //    '<div class="row">' +
                    //    '<div class="col-md-4">' +
                    //    '<span style="padding:0px 0px 0px 0px;">' +
                    //    '<img src="/' + source + '" style="width:60px;height:60px;"/>' +
                    //    '<input type="button" class="btn btn-primary btn-sm pull-left cls' + index + ' clsSequenceNo" style="padding:0px 5px 0px 5px;" value="' + option.sequenceNo + '" />' +
                    //    '</span>' +

                    //    '</div>' +
                    //    '<div class="col-md-8">' +
                    //    '<span class="pull-left" style="font-weight:bold">' + empName + '</span><br />' +
                    //    '<span class="pull-left" style="font-size:.7em">' + option.DesignationName + '</span>' +
                    //    '</div>' +progress

                    //    '</div>' +
                    //    '</a>' +
                    //    '<input type="hidden" class="clsUserId" value="' + option.nextApproverId + '" />'
                    //'</div>';

                    divPanel.append(inputPanel);
                }
                index++;
            });
        }

        function GetReqNo(response) {
            //console.log(response);
            //$('#reqNo').val(response.AutoNumber);
            $('#reqNo').val(response);
        }
        var attid = 0;
        $(document).ready(function () {
            $('#progress').hide();

			$('#employeeId').select2();
			$("#divJustify").show();
            $("#chkCompititionWaiver").prop("checked", true);
			if ($('#tbodyAttachment tr').length == 0) {
				$('.attatchmentTbl').hide();
				$('.attatchmentTb').hide();
			}
            $("#reqDate").datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "2010:2030" }).datepicker("setDate", new Date());
            $("#targetDate").datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "2010:2030" }).datepicker("setDate", new Date());

            $('#reqQty').keyup(function () {
                CalculateAmount();
            });
            $('#reqRate').keyup(function () {
                CalculateAmount();
            });
            var projectId = $('#projectId').val();
            Common.Ajax('GET', '/api/RequisitionMaster/GetRequisitionNo/' + projectId, [], 'json', GetReqNo);
            Common.Ajax('GET', '/SCMMasterData/Item/GetAllSpecificationInfo', [], 'json', ajaxGetItemSpecification);
            //Common.Ajax('GET', '/global/api/GetAllItemForRequisition', [], 'json', ajaxGetAllItemForRequisition);

            Common.Ajax('GET', '/api/matrix/ApproverPanelList/' + 1 + '/' + $('#projectId').val(), [], 'json', GetApproverPanelList);
            $('#projectId').change(function () {
                Common.Ajax('GET', '/api/matrix/ApproverPanelList/' + 1 + '/' + $('#projectId').val(), [], 'json', GetApproverPanelList);
                Common.Ajax('GET', '/api/RequisitionMaster/GetRequisitionNo/' + $(this).val(), [], 'json', GetReqNo);
            });

            //$('#reqDate').change(function () {
            //    Common.Ajax('GET', '/api/RequisitionMaster/GetRequisitionNo/' + $(this).val(), [], 'json', GetReqNo);
            //});

            $("#btnSave").click(function () {
                swal({
                    title: 'Are you sure?', text: 'Do you want to submit this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, submit it!'
                }).then(function () {
                   $('#progress').show();
                    $('#FormId').hide();
                       SaveMasterDetails();


                });

            })
            if (window.File && window.FileList && window.FileReader) {
                var filesInput = document.getElementById("pfiles");

                //$("#tbodyAttachment").empty();

                filesInput.addEventListener("change", function (event) {

                    var files = event.target.files; //FileList object
                    var output = document.getElementById("result");

                    for (var i = 0; i < files.length; i++) {
                        var file = files[i];
                        pIndexattach = pIndexattach + 1;
                        var attach_id = "pfiles";
                        var FileSize = $('#' + attach_id)[0].files[0].size;
                        var fileName = $('#' + attach_id)[0].files[0].name;
                        var path = URL.createObjectURL(event.target.files[0]);
                        $('#btnSave').prop('disabled', false);
                        var specid = $('#itemSpecificationId').val();
                        var filesizekb = (parseFloat(FileSize) / 1024).toFixed(0);

                        var dtTable = $("#dtAttachmentp");
                        var tableBody = dtTable.find('tbody');
                       // var trow = tableBody.find()

                        if (!file.type.match('image')) //file
                        {
                            var ext = this.value.match(/\.(.+)$/)[1];
                            var picReader = new FileReader();
                            picReader.addEventListener("load", function (event) {
                                var attach_id = "files";
                                var picFile = event.target;
                                '<tr>' +
                                tableBody.append(
                                    '<td class="cls' + specid+'" id="1' + pIndexattach + '">' + fileName + '</td>' +

                                    '<td class="cls' + specid + '" id="2' + pIndexattach + '"><i class="fa fa-file" style="font-size:40px;color:lightgray"> </i></td>' +

                                    '<td class="cls' + specid +'" id="3' + pIndexattach + '" style="display:none"><input type="text"   name="pSubjects" value="' + pIndexattach + 'A" /><input class="clsFileTitlep" type="text" value="' + path + '" name="pFiles" style="display:none"/><input type="text" value="' + specid + '" name="pspecid" class="clsFileTitleps" style="display:none"/></td>' +
                                    '<td class="cls' + specid +'" id="4' + pIndexattach + '">' +  '<a href="javascript:void(0)" class="btn btn-danger btn-sm" title="Delete" onclick="DeleteImageP(' + pIndexattach + ',' + "'" + fileName + "'" + ')">Delete</a></td>')
                                    +
                                    '</tr>'

                                arrSupImg.push({
                                    sid: specid,
                                    ind: pIndexattach,
                                    fName: fileName,
                                    p: path
                                })
                                $('#dtAttachmentp5').append(`<div class="card col-md-3" id="DeleteImageP1">
																	<div class="card-header">
																		${fileName}
																	</div>
																	<div class="card-body" style="text-align: center;">
																		<i class="fa fa-file" style="font-size:40px;color:lightgray"> </i>
																	</div>
                                                                        <div class="card-footer" style="text-align: center;">
                                                                        <input type="hidden"  name="pSubjects" value="' + ${pIndexattach} + 'A" /><input class="clsFileTitlep" type="text" value="' + ${path} + '" name="pFiles" style="display:none"/><input type="text" value="' + ${specid} + '" name="pspecid" class="clsFileTitleps" style="display:none"/>

                                                                       <a href="javascript:void(0)" class="btn btn-danger btn-sm" title="Delete" onclick="DeleteImageP1(' + key + ')" style="margin-left: 5px;">Delete</a>
																	</div>

																</div>`)
                            });
                        }
                        else {
                            var picReader = new FileReader();
                            picReader.addEventListener("load", function (event) {
                                var attach_id = "files";
                                var picFile = event.target;
                                '<tr >' +
                                tableBody.append(

                                    '<td class="cls' + specid +'" id="1' + pIndexattach + '" style="height:50px;width: 45px; background - color:lightgray"><img src=' + "'" + path + "'" + ' height=50 width=45 /></td>' +
                                    '<td class="cls' + specid +'" id="2' + pIndexattach + '" style="display:none"><input type="text" name="Subjects"   value="' + pIndexattach + 'A" /><input class="clsFileTitlep" type="text" value="' + path + '" name="pFiles" style="display:none"/><input type="text" value="' + specid + '" name="pspecid" class="clsFileTitleps" style="display:none"/></td>' +
                                    '<td  id="3' + pIndexattach + '">' + '<a href="javascript:void(0)" class="btn btn-danger btn-sm cls' + specid +'" title="Delete" onclick="DeleteImageP(' + pIndexattach + ',' + "'" + fileName + "'" + ')">Delete</a></td>')
                                    +
                                    '</tr>'
                                arrSupImg.push({
                                    sid: specid,
                                    ind: pIndexattach,
                                    fName: fileName,
                                    p: path
                                })

                                $('#dtAttachmentp5').append(`<div class="card col-md-3" id="DeleteImageP1">
																	<div class="card-header">
																		${fileName}
																	</div>
																	<div class="card-body" style="text-align: center;">
                                                                           <img src='${path}' height=50 width=45 />
																		<input type="hidden" name="Subjects"   value="' + ${pIndexattach} + 'A" /><input class="clsFileTitlep" type="text" value="' + ${path} + '" name="pFiles" style="display:none"/><input type="text" value="' + ${specid} + '" name="pspecid" class="clsFileTitleps" style="display:none"/>
																	</div>
                                                                        <div class="card-footer" style="text-align: center;">
																	   <a href="javascript:void(0)" class="btn btn-danger btn-sm cls' + ${specid} +'" title="Delete" onclick="DeleteImageP1(' + key + ')" style="margin-left: 5px;">Delete</a>
																	</div>

																</div>`)
                            });
                        }
                        picReader.readAsDataURL(file);
                    }
                    var fileInput = document.getElementById('pfiles');
                    for (i = 0; i < fileInput.files.length; i++) {
                        formdata.append(fileInput.files[i].name, fileInput.files[i]);
                    }
                });

            }

            else {
                console.log("Your browser does not support File API");
            }

            if (window.File && window.FileList && window.FileReader) {
                var filesInput = document.getElementById("files");

                //$("#tbodyAttachment").empty();

                    filesInput.addEventListener("change", function (event) {

                        var files = event.target.files; //FileList object
                        var output = document.getElementById("result");

                        for (var i = 0; i < files.length; i++) {
                            var file = files[i];
                            Indexattach = Indexattach + 1;
                            var attach_id = "files";
                            var FileSize = $('#' + attach_id)[0].files[0].size;
                            var fileName = $('#' + attach_id)[0].files[0].name;
                            var path = URL.createObjectURL(event.target.files[0]);
                            $('#btnSave').prop('disabled', false);

                            var filesizekb = (parseFloat(FileSize) / 1024).toFixed(0);

                            var dtTable = $("#dtAttachment");
                            var tableBody = dtTable.find('tbody');

                            if (!file.type.match('image')) //file
                            {
                                var ext = this.value.match(/\.(.+)$/)[1];
                                var picReader = new FileReader();
                                picReader.addEventListener("load", function (event) {
                                    var attach_id = "files";
                                    var picFile = event.target;

                                    tableBody.append(
                                        '<tr id=' + Indexattach + '>' +
                                        '<td>' + fileName + '</td>' +

                                        '<td><i class="fa fa-file" style="font-size:40px;color:lightgray"> </i></td>' +
                                        '<td style="display:none"><input type="text" class="clsFileTitle2"  name="Subjects" value="' + Indexattach + 'A" /><input type="text" value="' + path + '" name="Files" style="display:none"/></td>' +
                                        '<td><a href=' + "'" + path + "'" + '  target="_blank"  title="Preview"  class="btn btn-info btn-sm"><i class="fa fa-eye"></i></a>' + '&nbsp;&nbsp;' + '<a href="javascript:void(0)" class="btn btn-danger btn-sm" title="Delete" onclick="DeleteImage(' + Indexattach + ',' + "'" + fileName + "'" + ')">Delete</a></td>' +
										'</tr>')

                                    $('#dtAttachmentp4').append(`<div class="card col-md-3" id="DeleteImage1">
																	<div class="card-header">
																		${fileName}
																	</div>
																	<div class="card-body" style="text-align: center;">
																		<i class="fa fa-file" style="font-size:40px;color:lightgray"> </i>
																	</div>
                                                                        <div class="card-footer" style="text-align: center;">
																		<input type="hidden" class="clsFileTitle2"  name="Subjects" value="' + ${Indexattach} + 'A" /><input type="text" value="' + ${path} + '" name="Files" style="display:none"/>
																				<a href=' + "'" + path + "'" + '  target="_blank"  title="Preview"  class="btn btn-info btn-sm"><i class="fa fa-eye"></i></a><a href="javascript:void(0)" class="btn btn-danger btn-sm" title="Delete" onclick="DeleteImage1(' + key + ')" style="margin-left: 5px;">Delete</a>
																	</div>

																</div>`)
                                });
                            }
                            else {
                                var picReader = new FileReader();
                                picReader.addEventListener("load", function (event) {
                                    var attach_id = "files";
                                    var picFile = event.target;
                                    tableBody.append(
                                        '<tr id=' + Indexattach + '>' +
                                        '<td>' + fileName + '</td>' +
                                        '<td style="height:50px;width: 45px; background - color:lightgray"><img src=' + "'" + path + "'" + ' height=50 width=45 /></td>' +
                                        '<td style="display:none"><input type="text" name="Subjects"  class="clsFileTitle2" value="' + Indexattach + 'A" /><input type="text" value="' + path + '" name="Files" style="display:none"/></td>' +
                                        '<td><a href=' + "'" + path + "'" + '  target="_blank"  title="Preview"  class="btn btn-info btn-sm"><i class="fa fa-eye"></i></a>' + '&nbsp;&nbsp;' + '<a href="javascript:void(0)" class="btn btn-danger btn-sm" title="Delete" onclick="DeleteImage(' + Indexattach + ',' + "'" + fileName + "'" + ')">Delete</a></td>' +
                                        '</tr>')
                                });
                            }
                            picReader.readAsDataURL(file);
						}

						$('.attatchmentTbl').show();
						$('.attatchmentTb').show();

                        var fileInput = document.getElementById('files');
                        for (i = 0; i < fileInput.files.length; i++) {
                            formdata.append(fileInput.files[i].name, fileInput.files[i]);
                        }
                    });

            }

            else {
                console.log("Your browser does not support File API");
            }
            //$("#divSupplier").hide();
            //$("#divtblSupplier").hide();
            $('#chkCompititionWaiver').val(0);

            $('#chkCompititionWaiver').on("click", function () {
                if ($('#chkCompititionWaiver').prop('checked') == true) {
                    $('#chkCompititionWaiver').val(1);
                } else {
                    $('#chkCompititionWaiver').val(0);
                }
            });
            Common.Ajax('GET', '/global/api/supplier/GetAllSupplier/', [], 'json', ajaxGetAllSupplier);

            if (@ViewBag.masterId> 0) {
                Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/GetRequisitionMasterByReqId/?reqId=' + @ViewBag.masterId, [], 'json', ajaxGetRequisitionMasterByReqId);
                Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/GetItemListByRequisitionId/?reqId=' + @ViewBag.masterId, [], 'json', ajaxGetItemListByRequisitionId);
               // Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/GetItemListByRequisitionId/?reqId=' + @ViewBag.masterId, [], 'json', ajaxGetItemListByRequisitionId1);
                LoadAttachment(@ViewBag.masterId);
                //Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/GetPreferableVendorList/?reqId=' + @ViewBag.masterId, [], 'json', ajaxGetPreferableVendorList);
            }
        })

        function AdditemDetailsSpec() {
            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var index = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                index = $("#tblitemDetailsSpec tbody>tr").length;
            }
            else {
                index = ifExistIndex;
                tdRID = $("#tblitemDetailsSpec tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsspecificationCategoryId").val();
            }



            if ($("#itemspecification").val() == "") {
                alert("Plaese Enter Specification Name.");
                return false
            }

            if ($("#specCategory").val() == "") {
                alert("Plaese Enter Specification Category.");
                return false
            }
            if ($("#catValue").val() == "") {
                alert("Plaese Enter Category Value.");
                return false
            }

            let id = parseInt($("#detailsIdSpec").val()) ? parseInt($("#detailsIdSpec").val()) : 0;
            var itemSpecificationName = $("#itemspecification").val();
            var itemSpecificationNameShow = $("#itemspecification").val();
            var specificationCategoryId = $("#specCategory").val();
            var specificationCategoryName = $("#specCategory option:selected").text();
            var catValue = $("#catValue").val();


            var RowCount = $("#tblitemDetailsSpec tbody>tr").length;
            var editOption = parseInt($('#IsEditSpec').val()) ? parseInt($('#IsEditSpec').val()) : 0;

            for (i = 0; i <= RowCount; i++) {
                var _itemSpecificationName = $("#itemSpecificationNameVD" + i).val();
                var _specificationCategoryId = $("#specificationCategoryId" + i).val();
                if (_itemSpecificationName == itemSpecificationName && _specificationCategoryId == specificationCategoryId && editOption == 0) {
                    alert('You have already added this Specification Category!');
                    return false
                }
                if (_itemSpecificationName == itemSpecificationName) {
                    itemSpecificationNameShow = "";
                }
            }

            var dtTable = $("#tblitemDetailsSpec");
            var tableBody = dtTable.find('tbody');
            var trHtml = '<tr id=' + index + '>' +
                '<td>' + itemSpecificationNameShow + '<input type="hidden" id="itemSpecificationName' + index + '" name="itemSpecificationName" class="clsitemSpecificationName" value="' + itemSpecificationNameShow + '"/><input type="hidden" id="itemSpecificationNameVD' + index + '" name="itemSpecificationNameVD" class="clsitemSpecificationNameVD" value="' + itemSpecificationName + '"/></td>' +
                '<td>' + specificationCategoryName + '<input type="hidden" name="id"class="clsId" value="' + id + '"><input type="hidden" id="specificationCategoryId' + index + '" name="specificationCategoryId" class="clsspecificationCategoryId" value="' + specificationCategoryId + '"/></td>' +
                '<td>' + catValue + '<input type="hidden" id="CategoryValue' + index + '" name="CategoryValue" class="clsCategoryValue" value="' + catValue + '"/></td>' +
                '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="DeleteSpec(' + index + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
                '<a onclick="EditTblSpec(' + index + "," + specificationCategoryId + ", '" + itemSpecificationName + "',  '" + catValue + "'," + id + ')" href="javascript:void(0)" title="Edit" class="btn btn-success btn-xs" > <i class="fa fa-edit"></i></a >' +

                '</tr>';
            if (ifExistIndex == null || ifExistIndex == "null") {
                tableBody.append(trHtml);
            }
            else {
                var rowUpdate = $("#tblitemDetailsSpec tbody >tr:eq(" + ifExistIndex + ")");
                rowUpdate.replaceWith(trHtml);
                window.localStorage.setItem("holdIndex", null);
                ifExistIndex = null;
            }
            RefreshSpec();
        }

        function EditTblSpec(index, specificationCategoryId, itemSpecificationName, catValue, Id) {
            var rightIndex = index;
            $("#IsEditSpec").val(1);
            $('#detailsIdSpec').val(Id);
            $('#itemspecification').val(itemSpecificationName);
            $('#specCategory').val(specificationCategoryId);
            $('#catValue').val(catValue);

            window.localStorage.setItem('holdIndex', null);
            if (rightIndex != null) {
                window.localStorage.setItem('holdIndex', rightIndex);
            }
        }

        function RefreshSpec() {
            $('#detailsIdSpec').val('');
            $("#IsEditSpec").val(0);

            $('#specCategory').val('');
            $('#catValue').val('');
            window.localStorage.setItem("holdIndex", null);
            ifExistIndex = null;
        }

        function DeleteSpec(index) {
            swal({
                title: 'Are you sure?', text: 'Do you want to delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, delete it!'
            }).then(function () {
                $("#tblitemDetailsSpec #" + index).remove();
                swal('', 'Deleted Successfully!', 'success');
            });

        }

        function EditTbl(index, itemsId, quantity, itemName, itemSpecification, unit, price, Id) {
            var rightIndex = index;
            $("#IsEdit").val(1);
            $('#detailsId').val(Id);

            $('#Qty').val(quantity);
            $('#price').val(price);
            $('#itemName').val(itemName);
            $('#itemsId').val(itemsId);
            $('#itemSpecificationName').val(itemSpecification);
            $('#unit').val(unit);

            $('#itemNamespec').val(itemName);
            $('#itemIdspec').val(itemsId);
            Common.Ajax('GET', '/SCMMasterData/Item/GetAllSpecificationDetailByitemId/?itemId=' + $("#itemIdspec").val(), [], 'json', ajaxGetAllSpecificationDetailByitemId);

            window.localStorage.setItem('holdIndex', null);
            if (rightIndex != null) {
                window.localStorage.setItem('holdIndex', rightIndex);
            }
        }

        function ajaxGetAllSpecificationDetailByitemId(response) {
            console.log(response);
            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var index = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                index = $("#tblitemDetailsSpec tbody>tr").length;
            }
            else {
                index = ifExistIndex;
                tdRID = $("#tblitemDetailsSpec tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsspecificationCategoryId").val();
            }
            $("#tblitemDetailsSpec tbody>tr").empty();
            $.each(response, function (key, value) {
                var itemSpecificationName = value.specificationName;
                var itemSpecificationNameShow = value.specificationName;
                var RowCount = $("#tblitemDetailsSpec tbody>tr").length;
                for (i = 0; i <= RowCount; i++) {
                    var _itemSpecificationName = $("#itemSpecificationNameVD" + i).val();

                    if (_itemSpecificationName == itemSpecificationName) {
                        itemSpecificationNameShow = "";
                    }
                }

                index = $("#tblitemDetailsSpec tbody>tr").length;
                var dtTable = $("#tblitemDetailsSpec");
                var tableBody = dtTable.find('tbody');
                var trHtml = '<tr id=' + index + '>' +
                    '<td>' + itemSpecificationNameShow + '<input type="hidden" id="itemSpecificationName' + index + '" name="itemSpecificationName" class="clsitemSpecificationName" value="' + itemSpecificationNameShow + '"/><input type="hidden" id="itemSpecificationNameVD' + index + '" name="itemSpecificationNameVD" class="clsitemSpecificationNameVD" value="' + itemSpecificationName + '"/></td>' +
                    '<td>' + value.specificationCategoryName + '<input type="hidden" name="id"class="clsId" value="' + value.Id + '"><input type="hidden" id="specificationCategoryId' + index + '" name="specificationCategoryId" class="clsspecificationCategoryId" value="' + value.specificationCategoryId + '"/></td>' +
                    '<td>' + value.value + '<input type="hidden" id="CategoryValue' + index + '" name="CategoryValue" class="clsCategoryValue" value="' + value.value + '"/></td>' +
                    '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="DeleteSpec(' + index + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
                    '<a onclick="EditTblSpec(' + index + "," + value.specificationCategoryId + ", '" + value.specificationName + "',  '" + value.value + "'," + value.Id + ')" href="javascript:void(0)" title="Edit" class="btn btn-success btn-xs" > <i class="fa fa-edit"></i></a >' +


                    '</tr>';
                if (ifExistIndex == null || ifExistIndex == "null") {
                    tableBody.append(trHtml);
                }
                else {
                    var rowUpdate = $("#tblitemDetailsSpec tbody >tr:eq(" + ifExistIndex + ")");
                    rowUpdate.replaceWith(trHtml);
                    window.localStorage.setItem("holdIndex", null);
                    ifExistIndex = null;
                }
            })

            index = index + 1;
        }

        $("#btnSaveItemSpec").click(function (e) {
            let rowCount = $("#tblitemDetailsSpec tbody>tr").length;
            if (rowCount < 1) {
                alert("Invalid attempt!!!");
                return false;
            }
            e.preventDefault();
            var form = $("#frmaddItemSpecification");
            $.ajax({
                url: '/SCMMasterData/Item/SaveItemSpecification',
                data: form.serialize(),
                type: 'POST',
                success: function (records) {
                    swal({
                        title: '', text: 'Save Successfully!', type: 'success', showCancelButton: false, confirmButtonColor: '#3085d6', confirmButtonText: 'Ok!',
                    }).then(function () {

                        $('#addItemSpecificationModal').modal('hide');
                        Common.Ajax('GET', '/global/api/ItemSpec/' + records, [], 'json', ajaxGetItemSpacification);
                    });
                }
            });
        });

        function ajaxGetItemSpacification(response) {
            var GetInStockItemSpacificationList = [];
            $.each(response, function (id, option) {
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.specificationName;
                GetInStockItemSpacificationList[GetInStockItemSpacificationList.length] = obj;
            });
            $('#itemSpecificationName').autocomplete({
                source: GetInStockItemSpacificationList,
                select: function (event, ui) {
                    $("#itemSpecificationId").val(ui.item.key);
                }
            });
        }

        function ajaxGetRequisitionMasterByReqId(response) {
            $.each(response, function (i, item) {
                $("#reqMasterId").val(item.Id);
                $("#itemName").val(item.itemName);
                $("#reqMasterId").val(item.Id);
                $("#reqNo").val(item.reqNo);
                $("#reqDate").val(item.reqDate);
                $("#subject").val(item.subject);
                $("#reqType").val(item.reqType);
                $("#isPostPR").val(item.isPostPR);
                $("#reqDept").val(item.reqDept);
                $("#reqDept").val(item.reqDept);
                $("#projectId").val(item.projectId);
                $("#foundsourceId").val(item.fundSourceId);
                $("#deliveryaddress").val(item.deliveryaddress);
                $("#employeeId").val(item.employeeinfoId);
                Common.Ajax('GET', '/api/matrix/ApproverPanelList/' + 1 + '/' + item.projectId, [], 'json', GetApproverPanelList);
            });

        }

        function ShowtxtSupplier() {
            $('#supplier').val('');
            //$("#justification").prop('required', false);
            $("#divJustify").show();
            var CompititionResult = $("#chkCompititionWaiver").is(":checked");
            if (CompititionResult == true) {
                $("#divSupplier").show();
                $("#divtblSupplier").show();

            }
            else {
                $("#divtblSupplier").hide();
                $("#divSupplier").hide();
                $("#supplier").val("");
                $("#hdnSupplier").val("0");
            }
        }
        function ShowSource() {
            var source = $("#chksrc").is(":checked");
            if (source == true) {
                $("#divsrc").css("display", "block");
            }
            else { $("#divsrc").css("display", "none");}
            //$("#divsrc").show();
        }
        function Showjustification() {
            $('#supplier').val('');
            $("#tblSupplier").find("tr:gt(1)").remove();
            var single = $("#chkjustification").is(":checked");
            if (single == true) {

                $("#divJustify").show();
                $("#divSupplier").show();
                $("#divtblSupplier").show();
                //$("#justification").prop('required', true);
                //$("#chkCompititionWaiver").attr("disabled", true);
            }
            else {
               // $("#justification").prop('required', false);
				$("#divJustify").show();
                $("#divtblSupplier").hide();
                $("#divSupplier").hide();
                $("#supplier").val("");
                $("#hdnSupplier").val("0");
                $("#chkCompititionWaiver").removeAttr("disabled");
            }
        }

        function DeleteImage(Indexattach, fileName) {
            formdata.delete(fileName);
            $("#" + Indexattach).remove();
			Indexattach = Indexattach - 1;

			if ($('#tbodyAttachment tr').length == 0) {
				$('.attatchmentTbl').hide();
				$('.attatchmentTb').hide();
			}
            return false;
        }
        function DeleteImageP(Indexattach, fileName) {
            formdata.delete(fileName);
            arrSupImg = arrSupImg.filter(function (data) {
                if (data["ind"] == Indexattach) {
                    return false;//remove old data from array
                }
                else
                    return true;
            })
            //arrSupImg = jQuery.grep(y, function (value) {
            //    return value != Indexattach;
            //});
            //console.log(arrSupImg);
            $("#1" + Indexattach).remove();
            $("#2" + Indexattach).remove();
            $("#3" + Indexattach).remove();
            $("#4" + Indexattach).remove();
            pIndexattach = pIndexattach - 1;
            return false;
        }

        function ajaxGetItemSpecification(response) {

            var GetList = [];
            $.each(response, function (id, option) {
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.specificationName;
                obj.unitName = option.Item.unit.unitName;
                obj.itemId = option.Item.Id;
                GetList[GetList.length] = obj;
            });
            $('#itemSpecificationName').autocomplete({
                source: GetList,
                select: function (event, ui) {
                    $("#unit").val(ui.item.unitName);
                    $("#itemSpecificationName").val(ui.item.value);
                    $("#itemSpecificationId").val(ui.item.key);
                    $("#itemId").val(ui.item.itemId);
                    Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/GetCumulativeGRQtyBySpecId/?itemspecId=' + ui.item.key, [], 'json', ajaxGetCumulativeGRQtyBySpecId);
                }
            });

        }

        function ajaxGetCumulativeGRQtyBySpecId(response) {
            $("#cumulativeQty").val(response.grQty);
        }

        function ajaxGetAllSupplier(response) {
            var GetList = [];
            $.each(response, function (id, option) {
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.orgCode + '-' + option.organizationName;
                GetList[GetList.length] = obj;
            });
            $('#supplier').autocomplete({
                source: GetList,
                select: function (event, ui) {
                    $("#supplier").val(ui.item.value);
                    $("#hdnSupplier").val(ui.item.key);
                }
            });
        }

        function ajaxGetAllItemForRequisition(response) {
            var GetList = [];
            $.each(response, function (id, option) {
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.itemName;
                obj.value2 = option.unit.unitName;
                GetList[GetList.length] = obj;
            });
            $('#itemName').autocomplete({
                source: GetList,
                select: function (event, ui) {
                    $("#itemName").val(ui.item.value);
                    $("#itemNamespec").val(ui.item.value);
                    $("#itemId").val(ui.item.key);
                    $("#itemIdspec").val(ui.item.key);
                    $("#unit").val(ui.item.value2);
                    var ItemId = ui.item.key;
                    Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/GetAllItemSpecificationByitemId/?ItemId=' + ItemId, [], 'json', ajaxGetItemSpecification);
                    $("#IsEdit").val(0);
                    Common.Ajax('GET', '/SCMMasterData/Item/GetAllSpecificationDetailByitemId/?itemId=' + ui.item.key, [], 'json', ajaxGetAllSpecificationDetailByitemId);
                }
            });
        }

        function CalculateAmount() {
            var Qty = 0;
            var Rate = 0;
            var Total = 0;
            if ($('#reqQty').val()!="") {
                Qty = $('#reqQty').val();
            }
            if ($('#reqRate').val() != "") {
                Rate = $('#reqRate').val();
            }
            Total = Qty * Rate;
            $('#totalAmount').val(Total);
        }

        function LoadAttachment(MasterId) {
            var rowno = 0
            $.ajax({
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("GetMasterWiseRequisitionAttachment", "RequisitionMaster", "http")',
                data: { MasterId: MasterId },
                dataType: 'json',
                async: true,
                success: function (attachments) {
                    //console.log(attachments);
                    var index = 1;
                    var dtTable = $("#dtAttachment");
                    var tableBody = dtTable.find('tbody');
                    tableBody.empty();
                    $.each(attachments, function (index, E) {
                        rowno = rowno + 1;
                        var filePath = '/Upload/' + E.fileName

                        if (E.FilePath != "") {
                            if (E.MimeType == "application/msword" || E.MimeType == "application/pdf" || E.MimeType == "application/x-msexcel" || E.MimeType == "application/octet-stream" || E.MimeType == "text/plain" || E.MimeType == "application/vnd.openxmlformats-officedocument.wordprocessingml.document" || E.MimeType == "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet") {
                                tableBody.append(
                                    '<tr id=' + rowno + '>' +
                                    '<td>' + E.fileName + '</td>' +
                                    '<td style="height:50px;width: 45px; background - color:lightgray"><img src=' + "'" + filePath + "'" + ' height=50 width=45 /></td>' +
                                    '<td style="display:none"><input type="text" name="Subjects"  class="clsFileTitle" value="' + rowno + 'A" /><input type="text" value="' + filePath + '" name="Files" style="display:none"/></td>' +
                                    '<td><a href=' + "'" + filePath + "'" + '  target="_blank"  title="Preview"  class="btn btn-info btn-sm"><i class="fa fa-eye"></i></a>' + '&nbsp;&nbsp;' + '<a href="javascript:void(0)" class="btn btn-danger btn-sm" title="Delete" onclick="DeleteImage(' + rowno + ',' + "'" + E.fileName + "'" + ')">Delete</a></td>' +
                                    '</tr>')
                            }
                            else {
                                tableBody.append(
                                    '<tr id=' + rowno + '>' +
                                    '<td>' + E.fileName + '</td>' +
                                    '<td style="height:50px;width: 45px; background - color:lightgray"><img src=' + "'" + filePath + "'" + ' height=50 width=45 /></td>' +
                                    '<td style="display:none"><input type="text" name="Subjects"  class="clsFileTitle" value="' + rowno + 'A" /><input type="text" value="' + filePath + '" name="Files" style="display:none"/></td>' +
                                    '<td><a href=' + "'" + filePath + "'" + '  target="_blank"  title="Preview"  class="btn btn-info btn-sm"><i class="fa fa-eye"></i></a>' + '&nbsp;&nbsp;' + '<a href="javascript:void(0)" class="btn btn-danger btn-sm" title="Delete" onclick="DeleteImage(' + rowno + ',' + "'" + E.fileName + "'" + ')">Delete</a></td>' +
                                    '</tr>')
                            }

                        }
                        index = index + 1;
                    });
                    $('#AjaxLoader').hide()
                },
                error: function (request, status, error) {
                    alert(request.statusText + "/" + request.statusText + "/" + error);
                }
            });
        }



        //function edit1(response) {
        function ajaxGetItemListByRequisitionId1 (response) {
            var footerAmountTotal = 0;
            $.each(response, function (k, v) {

                //    $.each(data, function (ind, value) {
                //        $('#aa').append(`<ol></ol>`)
                //})

                console.log(v)
                footerAmountTotal += v.reqQty * v.reqRate;
                $('#detailsData').append(`
                <td>${k+1}</td>
                <td>${v.itemSpecification.Item.itemName}</td>
                <td>${v.itemSpecification.specificationName}</td>
                <td>${v.budgetCode}</td>
                <td>${v.targetDate}</td>
                <td>${v.justification}</td>
                <td>${v.reqQty}</td>
                <td>${v.itemSpecification.Item.unit.unitName}</td>
                <td>${'null'}</td>
                <td>${v.reqRate}</td>
                <td>${v.reqQty * v.reqRate}</td>
                <td>
                <a onclick="EditTblWithId('+ index + ',' +${ v.itemSpecification.itemId} +"'" + ', ' + "'"+ ${v.itemSpecification.specificationName}.replace(/'/g, " &#39").replace(/" / g, "&#34") + "'" + ', ' + "'" + ${v.itemSpecification.Item.unit.unitName} + "'" + ', ' + "'" + ${v.targetDate} + "'" + ',' + "'" + ${v.justification}.replace(/'/g, "&#39").replace(/"/g, "&#34") + "'" + ',' + ${v.reqQty} + ', ' + ${v.reqRate} + ', ' + ${v.reqQty * v.reqRate} + ', ' + ",'" + ${v.itemSpecification.Item.itemName}.replace(/'/g, "&#39").replace(/"/g, "&#34") + "'," + ',' + ${v.Id} + ',' + ${ v.itemSpecificationId} + ')" href="javascript:void(0)" title="Edit" class="btn btn-success btn-xs"> <i class="fa fa-edit"></i></a>
                </td>

                `)

                $('#grandTotal').text(footerAmountTotal);
            })
        }



		function ajaxGetItemListByRequisitionId(response) {
			console.log(response)
            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var index = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                index = $("#tblitemDetails tbody>tr").length;
            }
            else {
                index = ifExistIndex;
                tdRID = $("#tblitemDetails tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsItemId").val();
            }
            $("#tblitemDetails tbody>tr").empty();
            var itemtotalAmount = 0;

            $.each(response, function (key, value) {
                var just = "";
                if (value.justification == null) {
                    just = "";
                }
                else {
                    just = value.justification.replace(/'/g, "&#39").replace(/"/g, "&#34")
                }
                itemtotalAmount = value.reqQty * value.reqRate;
                index = $("#tblitemDetails tbody>tr").length;
                var dtTable = $("#tblitemDetails");
                var tableBody = dtTable.find('tbody');
                //console.log("sumonssss");
                //console.log(tableBody);

                var trHtml = '<tr id=' + index + '>' +
                    '<td>' + (parseInt(index) + 1) + '</td>' +
                    '<td>' + value.itemSpecification.specificationName + '<input type="hidden" name="id"class="clsId" value="' + value.Id + '"><input type="hidden" name="ItemId"  id="txItemId" class="clsItemId"value="' + value.itemSpecification.itemId + '"/><input type="hidden"name="itemSpecificationId" id="txitemSpecificationId" class="clsitemSpecificationId"value="' + value.itemSpecification.specificationName + '"/><input type="hidden" name="itemSpecificationName" id="txitemSpecificationName" class="clsitemSpecificationName"value="' + value.itemSpecification.specificationName + '"/></td>' +
                    //'<td>' + value.itemSpecification.specificationName + '<input type="hidden"name="itemSpecificationId" id="txitemSpecificationId" class="clsitemSpecificationId"value="' + value.itemSpecification.specificationName + '"/><input type="hidden" name="itemSpecificationName" id="txitemSpecificationName" class="clsitemSpecificationName"value="' + value.itemSpecification.specificationName + '"/>+</td>' +
                    '<td>' + value.budgetCode + '<input type="hidden"name="budgetCode" class="clsbudgetCode"value="' + value.budgetCode + '"/></td>' +
                    '<td>' + value.targetDate + '<input type="hidden"name="targetDate" class="clstargetDate"value="' + value.targetDate + '"/></td>' +
                    //'<td>' + value.justification + '<input type="hidden"name="justification" class="clsjustification"value="' + value.justification + '"/></td>' +
                    '<td>' + value.reqQty + '<input type="hidden"name="reqQty" class="clsreqQty"value="' + value.reqQty + '"/></td>' +
                    '<td>' + value.itemSpecification.Item.unit.unitName + '<input type="hidden"name="unit" class="clsunit"value="' + value.itemSpecification.Item.unit.unitName + '"/></td>' +
                    '<td>' + value.reqRate + '<input type="hidden"name="reqRate" class="clsreqRate"value="' + value.reqRate + '"/></td>' +
                    '<td>' + itemtotalAmount + '<input type="hidden"name="totalAmount" class="clstotalAmount"value="' + itemtotalAmount + '<input type="hidden" name="location" class="clslocation" value="' + value.deliveryLocation + '<input type="hidden" name="employeeId" class="clsemployeeId" value="' + value.employeeId + '  "/></td>' +

                    

                    '</tr>';

                if (ifExistIndex == null || ifExistIndex == "null") {
                    //tableBody.html(trHtml);
                    tableBody.append(trHtml);
                }
                else {
                    var rowUpdate = $("#tblitemDetails tbody >tr:eq(" + ifExistIndex + ")");
                    rowUpdate.replaceWith(trHtml);
                    window.localStorage.setItem("holdIndex", null);
                    ifExistIndex = null;
                }
            })
            SumCal();
            index = index + 1;
        }

        function AddSupplier() {

            var single = $("#chkjustification").is(":checked");
            if (single == true) {

                //$("#tblSupplier").find("tr:gt(0)").remove();
                if ($("#tblSupplier tr").length > 1) {
                    swal('Warning', 'Can not add more Then 1 supplier', 'warning').then(function () {
                        $("#supplier").val('');
                    })
                    return false;
                }
                var justifi = $("#justification").val();
                if (justifi == '') {
                    alert('Please insert Justification')
                    return false;
                }
            }
            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var indexSupplier = "0";
            indexSupplier = $("#tblSupplier tbody>tr").length;

            //if (ifExistIndex == "null" || ifExistIndex == null) {
            //    indexSupplier = $("#tblSupplier tbody>tr").length;
            //}
            //else {
            //    indexSupplier = ifExistIndex;
            //    tdRID = $("#tblSupplier tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsItemIdSupplier").val();
            //}

            let id = parseInt($("#PreferableVendorsId").val()) ? parseInt($("#PreferableVendorsId").val()) : 0;
            let ItemId = $('#itemId').val();
            let ItemName = $('#itemName').val();

            let itemSpecificationId = $('#itemSpecificationId').val();
            let itemSpecificationName = $('#itemSpecificationName').val();
            let supplierId = $("#hdnSupplier").val();
            let supplier = $("#supplier").val();

            if (ItemId == 0) {
                alert("Please select Item");
                return false;
            }
            if (itemSpecificationId == '') {
                alert("Please enter item Specification")
                return false;
            }
            if (supplier == '') {
                alert("Please insert Supplier");
                return false;
            }


            var RowCount = $("#tblSupplier tbody>tr").length;

            for (i = 1; i <= RowCount; i++) {
                var _ItemId = $("#txItemIdSupplier").val();
                var spec = $("#txitemSpecificationIdSupplier").val();
                var Supp = $("#txsupplierId").val();

                if (_ItemId == ItemId && spec == itemSpecificationId && Supp == supplierId) {
                    alert('You have already added this supplier');
                    $('#supplier').val('');
                    return false;
                }
            }

            var dtTable = $(".c");
            var tableBody = dtTable.find('tbody');
            var c = dtTable.find('#tblSupplier1');
            //var trHtml = '<tr id=' + indexSupplier + '>' +
            //    //'<td>' + ItemName + '<input type="hidden" name="id"class="clsIdSupplier" value="' + id + '"><input type="hidden" name="ItemId"  id="txItemIdSupplier" class="clsItemIdSupplier"value="' + ItemId + '"/></td>' +
            //    //'<td>' + itemSpecificationName + '<input type="hidden"name="itemSpecificationIdSupplier" id="txitemSpecificationIdSupplier" class="clsitemSpecificationIdSupplier"value="' + itemSpecificationId + '"/></td>' +
            //    '<td>' + supplier + '<input type="hidden"name="supplier" id="txsupplierId" class="clssupplier"value="' + supplierId + '"/></td>' +
            //    '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Deletesupplier(' + indexSupplier + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +

            //    '</tr>';

            var divHtml = `<div class="col-sm" style="width:40% ;" id="divChieldPanel">
                                  <div class="card" style="height: 101%;">
                                          <div class="card-header">
                                    <h5 class="card-title" style="color: black">@Model.fLang.supplier</h5>
                                    </div>
                                        <div class="card-body" style="">
                                                        <label class="card-text" style="margin-bottom: 1%;font-size:18px;">${supplier}</label>
                                                         <input type="hidden" name="supplier" id="txsupplierId" class="clssupplier" value="value.Id" />
                                        </div>
                                           <div class="card-footer text-center font-weight-bold" style:"margin: 0 -8% -9% -9%;">
                                             <a href="javascript:void(0)" style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-sm" onclick="Deletesupplier1(' + key + ')"><i class="fa fa-trash"></i></a>

                                          </div>
                                 </div>



                            </div>`;

            c.append(divHtml);
            //tableBody.append(trHtml);
            arrSupp.push({
                supplierId: supplierId,
                name: supplier,
                itemId: ItemId,
                indxSpl: indexSupplier,
                itemSpecificationId:itemSpecificationId
            });

            //if (ifExistIndex == null || ifExistIndex == "null") {
            //    tableBody.append(trHtml);
            //    //var sup = $(".clssupplier").closest('td').text();
            //    //var supid = $(".clssupplier").val();
            //    arrSupp.push({
            //        id: supplierId,
            //        name: supplier,
            //        itemid: ItemId,
            //        indxSpl: indexSupplier
            //    });
            //}
            //else {
            //    var rowUpdate = $("#tblSupplier tbody >tr:eq(" + ifExistIndex + ")");
            //    rowUpdate.replaceWith(trHtml);
            //    //window.localStorage.setItem("holdIndex", null);
            //    //ifExistIndex = null;
            //}

            $('#hdnSupplier').val('')
            $('#supplier').val('')
        }


        function Deletesupplier1(key) {
            $('#divChieldPanel').remove();

        }
        function DeleteImageP1(key) {
            $('#DeleteImageP1').remove();

        }
        function DeleteImage1(key) {
            $('#DeleteImage1').remove();

        }

        //function Deletesupplier1(indexSupplier) {
        //    $("#tblSupplier1 #" + indexSupplier).remove();
        //    arrSupp = arrSupp.filter(function (data) {
        //        if (data["indxSpl"] == indexSupplier) {
        //            return false;//remove old data from array
        //        }
        //        else
        //            return true;
        //    })
        //    return false;
        //}


		function AdditemDetails() {
            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var index = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                index = $("#tblitemDetails tbody>tr").length;
            }
            else {
                index = ifExistIndex;
                tdRID = $("#tblitemDetails tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsItemId").val();
            }

            let id = parseInt($("#detailsId").val()) ? parseInt($("#detailsId").val()) : 0;
            let ItemId = $('#itemId').val();
            let ItemName = '';//$('#itemName').val();
            //let itemSpecificationId = $('#itemSpecificationId').val();
            var itemSpecificationId = parseInt($('#itemSpecificationId').val()) ? parseInt($('#itemSpecificationId').val()) : 0;
            let itemSpecificationName = $('#itemSpecificationName').val();
            var targetDate = $("#targetDate").val();
            var budgetCode = $("#budgetCode").val();
            var justification = $("#justification").val();
			var deliveryaddress = $("#deliveryaddress").val();

             //supplier = $(".clssupplier").closest("td").text();
           // $('#chksrc').attr('checked', false);
            var source =  $("#chksrc").prop("checked", false);

            if (source == false) {
                    $("#divsrc").css("display", "block");
                }
               else { $("#divsrc").css("display", "none"); }


           // $("#chksrc").attr(":checked");
            var location = $("#deliveryaddress").val();
            var employeeId = $("#employeeId").val();

            let unit = $('#unit').val();
            let reqQty = $('#reqQty').val();
            let reqRate = $('#reqRate').val();
            let totalAmount = $('#totalAmount').val();

            if (ItemId == 0) {
                    alert("Please select Item");
                    return false;
            }

            if (reqQty == '') {
                alert("Please insert Quantity");
                return false;
            }

            if (reqRate == '') {
                alert("Please insert Approx. Price");
                return false;
            }

            if (targetDate == '') {
                alert("Please enter Delivery Target Date")
                return false;
            }

            //if (justification == '') {
            //    alert("Please enter Justification")
            //    return false;
            //}

            if (itemSpecificationName == '') {
                alert("Please enter item Specification")
                return false;
            }
            else if (itemSpecificationId == 0) {
                alert("Please select valid Specification Name")
                return false;
            }

            var editOption = parseInt($('#IsEdit').val()) ? parseInt($('#IsEdit').val()) : 0;
            var RowCount = $("#tblitemDetails tbody>tr").length;

            for (i = 1; i <= RowCount; i++) {
                var _ItemId = $("#txItemId").val();
                var spec = $("#txitemSpecificationId").val();
                var specname = $("#txitemSpecificationName").val();

                if (editOption == 1) {

                } else {
                    if (_ItemId == ItemId && specname == itemSpecificationName) {

                        alert('You have already added this item specification');
                        return false
                    }
                }
            }

            var dtTable = $("#tblitemDetails");
                var tableBody = dtTable.find('tbody');
            var trHtml = '<tr id=' + index + '>' +
                '<td>' + (parseInt(index) + 1) + '</td>' +
                    //'<td>' + ItemName + '<input type="hidden" name="id"class="clsId" value="' + id + '"><input type="hidden" name="ItemId"  id="txItemId" class="clsItemId"value="' + ItemId + '"/></td>' +
                    '<td>' + itemSpecificationName + '<input type="hidden"name="itemSpecificationId" id="txitemSpecificationId" class="clsitemSpecificationId"value="' + itemSpecificationId + '"/><input type="hidden"name="itemSpecificationName" id="txitemSpecificationName" class="clsitemSpecificationName"value="' + itemSpecificationName + '"/></td>' +
                    '<td>' + budgetCode + '<input type="hidden"name="budgetCode" class="clsbudgetCode"value="' + budgetCode + '"/><input type="hidden" name="ItemId"  id="txItemId" class="clsItemId"value="' + ItemId + '"/></td>' +

                '<td>' + targetDate + '<input type="hidden"name="targetDate" class="clstargetDate"value="' + targetDate + '"/><input type="hidden"name="justification" class="clsjustification"value="' + justification + '"/></td>' +
                    //'<td>' + justification + '<input type="hidden"name="justification" class="clsjustification"value="' + justification + '"/></td>' +
                    '<td>' + reqQty + '<input type="hidden"name="reqQty" class="clsreqQty"value="' + reqQty + '"/></td>' +
                    '<td>' + unit + '<input type="hidden"name="unit" class="clsunit"value="' + unit + '"/></td>' +
                    '<td>' + reqRate + '<input type="hidden"name="reqRate" class="clsreqRate"value="' + reqRate + '"/></td>' +
                    '<td>' + totalAmount + '<input type="hidden"name="totalAmount" class="clstotalAmount" value="' + totalAmount + '<input type="hidden" name="location" class="clslocation" value="' + location + '<input type="hidden" name="employeeId" class="clsemployeeId" value="' + employeeId + ' "/></td>' +
                    //'<td>' + '<input type="hidden" name="location" class="clslocation" value="' + location + '"/></td>' +
                    //'<td>' + '<input type="hidden" name="employeeId" class="clsemployeeId" value="' + employeeId + '"/></td>' +
                    '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Delete(' + index + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
				'<a onclick="EditTblWithId(' + index + ',' + ItemId + ', `' + "'" + itemSpecificationName.replace(/'/g, "&#39").replace(/"/g, "&#34") + "'" + '`, ' + "'" + unit + "'" + ', ' + "'" + targetDate + "'" + ', `' + "'" + justification.replace(/'/g, "&#39").replace(/"/g, "&#34") + "'" + '`,' + reqQty + ', ' + reqRate + ', ' + totalAmount + ',' + "`'" + ItemName.replace(/'/g, "&#39").replace(/"/g, "&#34") + "'`" + ',' + id + ',' + itemSpecificationId + ', `' + deliveryaddress + '`)" href="javascript:void(0)" title="Edit" class="btn btn-success btn-xs" > <i class="fa fa-edit"></i></a ></td>' +
                    '</tr>';
			console.log(ifExistIndex);
            if (ifExistIndex == null || ifExistIndex == "null") {
				tableBody.append(trHtml);
				$('#dtAttachmentp5').empty();
            }
            else {
                var rowUpdate = $("#tblitemDetails tbody >tr:eq(" + ifExistIndex + ")");
                rowUpdate.replaceWith(trHtml);
                window.localStorage.setItem("holdIndex", null);
                ifExistIndex = null;
            }
            SumCal();
            Refresh();
            var dtTable = $("#dtAttachmentp");
            var tableBody1 = dtTable.find('tbody');
            tableBody1.empty();
            //arrSupp = [];
            //arrSupImg = [];
        }

        function SumCal() {

            var sum = 0;
            $(".clstotalAmount").each(function () {
                sum += +parseFloat($(this).val().replace(/,/g, '')) ? parseFloat($(this).val().replace(/,/g, '')) : 0;
            });
            $("#grandTotal").html(sum).number(true, 0);

        }

        function EditTblWithId(index, ItemId, itemSpecificationName, unit, targetDate,
			justification, reqQty, reqRate, totalAmount, ItemName, Id, itemSpecificationId, deliveryaddress) {
            var rightIndex = index;


            if (@ViewBag.masterId> 0) {

                Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/GetPreferableVendorListBySpecId/?specID=' + itemSpecificationId, [], 'json', AjaxVendorList);
            } else {
                var dtTable = $("#tblSupplier");
                var tableBody = dtTable.find('tbody');
                tableBody.empty();
                $.each(arrSupp, function (key, value) {
                    if (value.itemId == ItemId) {
                        var trHtml = '<tr id=' + key + '>' +
                            //'<td>' + ItemName.slice(1, -1) + '<input type="hidden" name="id"class="clsIdSupplier" value="' + value.supplierId + '"><input type="hidden" name="ItemId"  id="txItemIdSupplier" class="clsItemIdSupplier"value="' + ItemId + '"/></td>' +
                            //'<td>' + itemSpecificationName.slice(1, -1) + '<input type="hidden"name="itemSpecificationIdSupplier" id="txitemSpecificationIdSupplier" class="clsitemSpecificationIdSupplier"value="' + itemSpecificationId + '"/></td>' +
                            '<td>' + value.name + '<input type="hidden"name="supplier" id="txsupplierId" class="clssupplier"value="' + value.supplierId + '"/></td>' +
                            '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Deletesupplier(' + key + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
                            '</tr>';
                        tableBody.append(trHtml);
                    }
                });
            }

            var dtTable1 = $("#dtAttachmentp");
            var tableBody1 = dtTable1.find('tbody');
            tableBody1.empty();
            $.each(arrSupImg, function (key, value) {
                if (value.sid == itemSpecificationId) {
                    '<tr>' +
                        tableBody1.append(
                            '<td class="cls' + value.sid + '" id="1' + value.ind + '" style="height:50px;width: 45px; background - color:lightgray"><img src=' + "'" + value.p + "'" + ' height=50 width=45 /></td>' +
                            '<td class="cls' + value.sid + '" id="2' + value.ind + '" style="display:none"><input type="text" name="Subjects"   value="' + value.ind + 'A" /><input class="clsFileTitlep" type="text" value="' + value.p + '" name="pFiles" style="display:none"/><input type="text" value="' + value.sid + '" name="pspecid" class="clsFileTitleps" style="display:none"/></td>' +
                            '<td  id="3' + value.ind + '">' + '<a href="javascript:void(0)" class="btn btn-danger btn-sm cls' + value.sid + '" title="Delete" onclick="DeleteImageP(' + value.ind + ',' + "'" + value.fileName + "'" + ')">Delete</a></td>')
                        +
                        '</tr>'
                }
            });

            $("#IsEdit").val(1);
            $('#detailsId').val(Id);
            $('#itemId').val(ItemId)
			$('#deliveryaddress').val(deliveryaddress)
            $('#itemName').val(ItemName.slice(1, -1))
            $('#itemSpecificationId').val(itemSpecificationId);
            $('#itemSpecificationName').val(itemSpecificationName.slice(1, -1));
            $('#unit').val(unit);
            $('#targetDate').val(targetDate);
            $('#justification').val(justification.slice(1, -1));
            $('#reqQty').val(reqQty);
            $('#reqRate').val(reqRate);
            $('#totalAmount').val(totalAmount);
           // Common.Ajax('GET', '/SCMMasterData/Item/GetAllSpecificationDetailByitemId/?itemId=' + ItemId, [], 'json', ajaxGetAllSpecificationDetailByitemId);
            window.localStorage.setItem('holdIndex', null);
            if (rightIndex != null) {
                window.localStorage.setItem('holdIndex', rightIndex.toString());
            }
        }

        function AjaxVendorList(response) {

            $('#tblSupplier').empty();
            $.each(response, function (key, value) {
                console.log(value);
                var trHtml = `<div class="col-sm-3" style="width:40% ;" id="divChieldPanel">
                                    <div class="card div${index} boxDesign" id="btnTotalLead">
                                        <div class="card-body" style="height:120px;">
                                                        <p class="card-text" style="margin-bottom: 1%;">${value.organization.organizationName}</p>
                                                         <input type="hidden" name="supplier" id="txsupplierId" class="clssupplier" value="value.Id" />
                                        </div>
                                           <div class="card-footer">
                                               <span style="font-size:.6em;font-weight:bold;">
                                               <input type="button" class="btn btn-primary btn-sm pull-left cls${index} clsSequenceNo" style="padding:0px 5px 0px 5px;" value="${option.sequenceNo}" />
                                               </span >
                                          </div>
                                           <span style="font-size:.8em;font-weight:bold;float:right;">
                                             <input type="button" class="btn btn-primary btn-sm pull-left cls' + index + ' clsSequenceNo" style="padding:0px 5px 0px 5px;" value="' + option.sequenceNo + '" />
                                            </span>
                                          <a href="javascript:void(0)" style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Deletesupplier(' + key + ')"><i class="fa fa-trash"></i></a>
                                    </div>
                            </div>`;
                    //'<tr id=' + key + '>' +
                    //'<td>' + value.organization.organizationName + '<input type="hidden"name="supplier" id="txsupplierId" class="clssupplier"value="' + value.Id + '"/></td>' +
                    //'<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Deletesupplier(' + key + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
                    //'</tr>';
                $('#tblSupplier').append(trHtml);
            });
            $("#chksrc").click();
            //var dtTable = $("#tblSupplier");
            //var tableBody = dtTable.find('tbody');
            //tableBody.empty();
            //$.each(response, function (key, value) {
            //        var trHtml = '<tr id=' + key + '>' +
            //            '<td>' + value.organization.organizationName + '<input type="hidden"name="supplier" id="txsupplierId" class="clssupplier"value="' + value.Id + '"/></td>' +
            //            '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Deletesupplier(' + key + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
            //            '</tr>';
            //        tableBody.append(trHtml);
            //});
            //$("#chksrc").click();
        }
        function Refresh() {
            $("#tblSupplier > tbody").empty();
            $(".cls" + $('#itemSpecificationId').val()).hide();
            $('#detailsId').val('');
            $('#itemId').val('')
            $('#itemName').val('')
            $('#itemSpecificationId').val('');
            $('#itemSpecificationName').val('');
            $('#unit').val('');
            $('#justification').val('');
            $('#reqQty').val('');
            $('#reqRate').val('');
            $('#totalAmount').val('');
            $("#IsEdit").val(0);

            $('#deliveryaddress').val('');
            $('#employeeId').val('');
			$('#tblSupplier1').empty();

            window.localStorage.setItem("holdIndex", null);
            ifExistIndex = null;
        }

        function Delete(index) {
            swal({
                title: 'Are you sure?', text: 'Do you want to Delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, Delete it!'
            }).then(function () {
                $("#tblitemDetails #" + index).remove();
                SumCal();
                return false;
            });

        }
        function ajaxGetPreferableVendorList(response) {
            //console.log(response);

            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var indexSupplier = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                indexSupplier = $("#tblSupplier tbody>tr").length;
            }
            else {
                indexSupplier = ifExistIndex;
                tdRID = $("#tblSupplier tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsItemIdSupplier").val();
            }

            $("#tblSupplier tbody>tr").empty();
            $.each(response, function (key, value) {
                var dtTable = $("#tblSupplier");
                var tableBody = dtTable.find('tbody');
                var trHtml = '<tr id=' + indexSupplier + '>' +
                    //'<td>' + value.requisitionDetail.item.itemName + '<input type="hidden" name="id"class="clsIdSupplier" value="' + value.Id + '"><input type="hidden" name="ItemId"  id="txItemIdSupplier" class="clsItemIdSupplier"value="' + value.requisitionDetail.itemId + '"/></td>' +
                    //'<td>' + value.requisitionDetail.itemSpecification.specificationName + '<input type="hidden"name="itemSpecificationIdSupplier" id="txitemSpecificationIdSupplier" class="clsitemSpecificationIdSupplier"value="' + value.requisitionDetail.itemSpecification.specificationName + '"/></td>' +
                    '<td>' + value.supplier.supplierName + '<input type="hidden"name="supplier" id="txsupplierId" class="clssupplier"value="' + value.supplierId + '"/></td>' +
                   '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Deletesupplier(' + indexSupplier + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +

                    '</tr>';

                if (ifExistIndex == null || ifExistIndex == "null") {
                    tableBody.append(trHtml);
                }
                else {
                    var rowUpdate = $("#tblSupplier tbody >tr:eq(" + ifExistIndex + ")");
                    rowUpdate.replaceWith(trHtml);
                    window.localStorage.setItem("holdIndex", null);
                    ifExistIndex = null;
                }
                indexSupplier = indexSupplier + 1;

            })

            indexSupplier = $("#tblSupplier tbody>tr").length;
            if (indexSupplier > 0) {
                $("#divSupplier").show();
                $("#divtblSupplier").show();
                $("#chkCompititionWaiver").attr('checked', true);

            }
        }

        //function Deletesupplier(indexSupplier) {
        //    $("#tblSupplier #" + indexSupplier).remove();
        //    arrSupp = arrSupp.filter(function (data) {
        //        if (data["indxSpl"] == indexSupplier) {
        //            return false;//remove old data from array
        //        }
        //        else
        //            return true;
        //    })
        //    return false;
        //}


        function SaveMasterDetails() {
            $('#btnSave').prop('disabled', true);
            var tablelength = $("#tblitemDetails tbody>tr").length;
            var reqMasterId = $("#reqMasterId").val();
            var reqNo = $("#reqNo").val();
            var reqDate = $("#reqDate").val();
            var targetDate = $("#targetDate").val();
            var subject = $("#subject").val();
            var reqType = $("#reqType").val();
            var isPostPR = $("#isPostPR").val();
            var reqDept = $("#reqDept").val();
            var fundsourceId = $("#foundsourceId").val();
            var deliveryaddress = $("#deliveryaddress").val();
            var employeeId = $("#employeeId").val();

            var id = parseInt($("#id").val()) ? parseInt($("#id").val()):0;

            if (reqDate == '') {
                $('#btnSave').prop('disabled', false);
                alert("Please enter Requisition Date")
                return false;
            } else if (reqNo=='') {
                $('#btnSave').prop('disabled', false);
                alert("Please enter Requisition No")
                return false;
            }else if (subject == '') {
                $('#btnSave').prop('disabled', false);
                alert("Please enter purpose")
                return false;
            } else if (reqType == '') {
                $('#btnSave').prop('disabled', false);
                alert("Please enter Requisition Status")
                return false;
            }else if (tablelength < 1) {
                $('#btnSave').prop('disabled', false);
                alert("there is no data in the table")
                return false;
            }

            var itemDetails = [];
            $("#tblitemDetails tbody>tr").each(function () {
                itemDetails.push({
                    detailsId: $(this).find(".clsId").val(),
                    itemId: $(this).find(".clsItemId").val(),
                    itemSpecificationId: $(this).find(".clsitemSpecificationId").val(),
                    itemSpecificationName: $(this).find(".clsitemSpecificationName").val(),
                    reqQty: $(this).find(".clsreqQty").val(),
                    reqRate: $(this).find(".clsreqRate").val(),
                    targetDate: $(this).find(".clstargetDate").val(),
                    justification: $(this).find(".clsjustification").val(),
                    budgetCode: $(this).find(".clsbudgetCode").val(),
                    deliveryLocation: $(this).find(".clslocation").val(),
                    employeeId: $(this).find(".clsemployeeId").val(),
                });
            });

            var appPanel = [];
            $("#divPanel > #divChieldPanel").each(function () {
                appPanel.push({
                    sequenceNo: $(this).find(".clsSequenceNo").val(),
                    userId: $(this).find(".clsUserId").val(),
				});
				console.log(appPanel)
            });

            var supplierDetails = arrSupp;

            //var supplierDetails = [];
            //$("#tblSupplier tbody>tr").each(function () {
            //    supplierDetails.push({
            //        Id: $(this).find(".clsIdSupplier").val(),
            //        itemId: $(this).find(".clsItemIdSupplier").val(),
            //        itemSpecificationId: $(this).find(".clsitemSpecificationIdSupplier").val(),
            //        supplierId: $(this).find(".clssupplier").val(),
            //    });
            //});

            var allTrx = new Object();
            allTrx.reqMasterId = reqMasterId;
            allTrx.projectId = $('#projectId').val();
            allTrx.reqNo = reqNo;
            allTrx.reqDate = reqDate;
            allTrx.subject = subject;
            allTrx.reqType = reqType;
            allTrx.isPostPR = isPostPR;
            allTrx.foundsourceId = fundsourceId;
            allTrx.deliveryaddress = deliveryaddress;
            allTrx.employeeId = employeeId;
            allTrx.reqDept = reqDept;
            allTrx.Details = itemDetails;
            allTrx.panels = appPanel;
            allTrx.preferableVendors = supplierDetails;

            //$('#progress').show();
            //$('#FormId').hide();
            $.ajax({
                url: '@Url.Action("SaveMasterDetails", "RequisitionMaster")',
                type: 'Post',
                data: allTrx
            })
                .done(function (data) {

                    var Attachmentp = 0;

                    Attachmentp = $("#dtAttachmentp tbody").length;
                    if (arrSupImg.length > 0) {
                        UploadAttachmentp(data);
                    }
                    else {
                          $('#btnSave').prop('disabled', false);
                        $('#progress').hide();
                        swal('success', 'Saved Successfully!', 'success').then(function () {
                            var link = '@Url.Action("Index", "RequisitionMaster", "http")'
                        window.location.href = link;
                        });
                    }

                    var Attachment = 0;
                    Attachment = $("#dtAttachment tbody>tr").length;
                    if (Attachment > 0) {
                        UploadAttachment(data);
                    }
                    else {
                        $('#btnSave').prop('disabled', false);
                        $('#progress').hide();
                        swal('success', 'Saved Successfully!', 'success').then(function () {
                            var link = '@Url.Action("Index", "RequisitionMaster", "http")'
                        window.location.href = link;
                        });

                    }

                    @*if (Attachmentp > 0) {
                        UploadAttachmentp(data);
                    }
                    else {

                        $('#btnSave').prop('disabled', false);
                        $('#progress').hide();
                        var link = '@Url.Action("CreateRequisition", "RequisitionMaster", "http")'
                        window.location.href = link;
                    }*@
                    //alert("Save Successfully");
                })
                .fail(function () {
                    $('#btnSave').prop('disabled', false);
                    $('#progress').hide();
                    alert("Unable to Save. Please Try Again");
                });
        }
         function UploadAttachment(id) {
            if (window.FormData !== undefined) {
                var arrayFileAtach = [];
                var indexFileAtach = 1;
                var $FileAtach = $('.clsFileTitle2');
                $FileAtach.each(function () {
                    arrayFileAtach.push($(this).val());
                    formdata.append("id", id);
                    formdata.append("arrayFileAtach", arrayFileAtach);
                    arrayFileAtach = [];
                });

                $.ajax({
                    url: '@Url.Action("UploadAttachment", "RequisitionMaster", "http")',
                    type: "POST",
                    contentType: false,
                    data: formdata,
                    dataType: "json",
                    //cache: false,
                    processData: false,
                    //async: false,

                })
                    .done(function (data) {
                       // alert("Save Successfully");
                         $('#btnSave').prop('disabled', false);
                        $('#progress').hide();
                     var link = '@Url.Action("CreateRequisition", "RequisitionMaster", "http")'
                     window.location.href = link;
                    })
                    .fail(function () {
                        $('#btnSave').prop('disabled', false);
                        $('#progress').hide();
                        alert("Uploading failed");
                    })
            } else {
                alert("FormData is not supported.");
            }
        }


        function UploadAttachmentp(id) {

            if (window.FormData !== undefined) {
                var arrayFileAtach = [];
                var arrayFileAtachs = [];
                var indexFileAtach = 1;

                var $FileAtach = arrSupImg;
                //var $FileAtach = $('.clsFileTitlep');
                var $FileAtachs = $('.clsFileTitleps');
                $.each(arrSupImg, function (key, value) {
                    arrayFileAtach.push(value.p);
                    //arrayFileAtach.push($(this).val());
                    formdata.append("id", id);
                    formdata.append("arrayFileAtach", arrayFileAtach);
                    arrayFileAtach = [];
                });
                $.each(arrSupImg, function (key, value) {
                    arrayFileAtachs.push(value.sid);

                    formdata.append("id", id);
                    formdata.append("arrayFileAtachs", arrayFileAtachs);
                    arrayFileAtach = [];
                });

                //$FileAtachs.each(function () {
                //    arrayFileAtachs.push($(this).val());

                //    formdata.append("arrayFileAtachs", arrayFileAtachs);
                //    arrayFileAtachs = [];
                //});

                $.ajax({
                    url: '@Url.Action("UploadAttachmentp", "RequisitionMaster", "http")',
                    type: "POST",
                    contentType: false,
                    data: formdata,
                    dataType: "json",
                    //cache: false,
                    processData: false,
                    //async: false,

                })
                    .done(function (data) {
                      //  alert("Save Successfully");
                         $('#btnSave').prop('disabled', false);
                        $('#progress').hide();
                     @*var link = '@Url.Action("CreateRequisition", "RequisitionMaster", "http")'
                     window.location.href = link;*@
                    })
                    .fail(function () {
                        $('#btnSave').prop('disabled', false);
                        $('#progress').hide();
                        alert("Uploading failed");
                    })
            } else {
                alert("FormData is not supported.");
            }
        }


    </script>

}
<style>
    .cls0 {
        background-color: red;
    }

    btn-success .div0 {
        border-color: red
    }

    .ui-autocomplete {
        cursor: pointer;
        height: 400px;
        width: 300px;
        overflow-y: scroll;
        background-color: white;
        color: rgb(0,188,212);
        z-index: 1050;
        /*outline-style:outset;*/
    }

    .custom-file-upload {
        border: 1px solid #ccc;
        display: inline-block;
        padding: 6px 12px;
        cursor: pointer;
    }

    input[type="file"] {
        display: none;
    }
</style>

