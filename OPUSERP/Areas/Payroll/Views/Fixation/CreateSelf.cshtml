@model FixationIntegrationViewModel
@{
    ViewData["Title"] = "Create";
    Layout = "~/Areas/Payroll/Views/Shared/_SalaryMasterForm.cshtml";

}

<div class="card" style="width: 100%;">
    <div class="card-header  d-flex flex-row align-items-center justify-content-between">
        <h5 class="m-0 font-weight-bold text-primary">Fixation Integration Information</h5>
        <a class='btn btn-info' style="" data-toggle='tooltip' title='Go Back' href='/Payroll/Fixation/FixationIntegrationList'><i class="fas fa-backward"></i></a>

    </div>
    <div class="card-body">

        <div class="container">
            <form asp-area="Payroll" asp-controller="Fixation" asp-action="Create" method="post">
                <div asp-validation-summary="All" class="text-danger"></div>
                <div class="row">
                    <input type="hidden" id="fixationintegrationId" name="fixationintegrationId" value=0>
                    <input type="hidden" id="employeeId" value="@Model.employee?.Id" readonly name="employeeId">
                    <div class="col-sm-6">
                        <div class="form-group row">
                            <label for="empcode" class="col-sm-4 col-form-label">Employee Name</label>
                            <div class="col-sm-8">
                                <input type="hidden" class="form-control" id="empCode" value="@Model.employee?.employeeCode" readonly name="empCode">
                                <input type="text" class="form-control" id="employeeName" value="@Model.employee?.nameEnglish" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="joiningDate" class="col-sm-4 col-form-label">Joining Date</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="joiningDate" id="joiningDate" value="@Model.employee?.joiningDateGovtService" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="dateOfBirth" class="col-sm-4 col-form-label">Birth Date</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="dateOfBirth" id="dateOfBirth" value="@Model.employee?.dateOfBirth" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="currentGrade" class="col-sm-4 col-form-label">Current Grade</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="currentGrade" name="currentGrade" value="@Model.fixationIntegration?.currentGrade" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="lastIncrementDate" class="col-sm-4 col-form-label">Last Increment date</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="lastIncrementDate" id="lastIncrementDate" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="postingPlace" class="col-sm-4 col-form-label">Posting Place</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="postingPlace" id="postingPlace" value="@Model.employee?.presentPosting" readonly>

                            </div>
                        </div>
                        @*<div class="form-group row">
            <label for="initialBasic" class="col-sm-4 col-form-label">Initial basic</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="initialBasic" name="initialBasic" value="">

            </div>
        </div>
        <div class="form-group row">
            <label for="startingBasic" class="col-sm-4 col-form-label">Starting Basic</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="initialstartingBasicBasic" name="startingBasic">
            </div>
        </div>
        <div class="form-group row">
            <label for="newBasicPoint" class="col-sm-4 col-form-label">New basic point</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="newBasicPoint" name="newBasicPoint">

            </div>
        </div>
        <div class="form-group row">
            <label for="basicPay" class="col-sm-4 col-form-label">Basic Pay as on</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="basicPay" name="basicPay">
            </div>
        </div>*@
                        <div class="form-group row">
                            <label for="lastPromotionDate" class="col-sm-4 col-form-label">Last promotion Date</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="lastPromotionDate" name="lastPromotionDate" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="effectiveDate" class="col-sm-4 col-form-label">Effective Date </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="effectiveDate" id="effectiveDate" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="nextIncrementDate" class="col-sm-4 col-form-label">Next Increment Date </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="nextIncrementDate" id="nextIncrementDate" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">

                        <div class="form-group row">
                            <label for="brachCode" class="col-sm-4 col-form-label">Branch</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="hrBranchId" id="hrBranchId" value="@Model.employee?.hrBranchId" readonly>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="designation" class="col-sm-4 col-form-label">Designation</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="designation" id="designation" value="@Model.employee?.lastDesignation?.designationName" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="fixationType" class="col-sm-4 col-form-label">Fixation Type </label>
                            <div class="col-sm-8">
                                <select class="form-control" name="fixationType" id="fixationType" required>
                                    <option value="">Select</option>
                                    <option value="Initial">Initial</option>
                                    <option value="Increment">Increment</option>
                                    <option value="Promotion">Promotion</option>

                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="fixationGrade" class="col-sm-4 col-form-label">Fixation Grade </label>
                            <div class="col-sm-8">
                                <select type="text" class="form-control" name="fixationGrade" id="fixationGrade">
                                    <option value="">Select</option>
                                    @foreach (var data in Model.salaryGrades)
                                    {
                                        <option value="@data.Id">@data.payScale</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="amount" class="col-sm-4 col-form-label">Amount</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="amount" id="amount" value="@Model.fixationIntegration?.amount">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="refNo" class="col-sm-4 col-form-label">Ref. No </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="refNo" id="refNo">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="note" class="col-sm-4 col-form-label">File No </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="fileNo" id="fileNo" value="@Model.employee?.fileNo" readonly>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="letterDate" class="col-sm-4 col-form-label">letter Date </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="letterDate" id="letterDate" readonly>
                            </div>
                        </div>
                   

                    </div>
                </div>
                <hr>
                <button type="submit" id="submitbtn" value="Submit" class="btn btn-success btn-lg" style="float:right; margin-top:5px;display:none;"><i class="fas fa-save"></i></button>
                <button type="button" id="submit" value="Submit" class="btn btn-success btn-lg" style="float:right; margin-top:5px;"><i class="fas fa-save"></i></button>
            </form>
        </div>
    </div>
</div>
<script>

    $(document).ready(function () {
        $('#fixationGrade').val('@Model.fixationIntegration?.fixationGradeId');
        $('#dateOfBirth').val(formatDate);
        $('#joiningDate').val(formatDate);
        $("#submit").click(function () {
            swal({
                title: 'Are you sure?', text: 'Do you want to submit this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, submit it!'
            }).then(function () {
                $("#submitbtn").click();
            });
        });
        //Common.Ajax('GET', '/global/api/GetActiveAllEmployeeInfo', [], 'json', ajaxGetEmployees);

        $("#lastIncrementDate").datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "2010:2030" }).datepicker("setDate", new Date());
        $("#lastPromotionDate").datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "2010:2030" }).datepicker("setDate", new Date());
        $("#letterDate").datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "2010:2030" }).datepicker("setDate", new Date());
        $("#effectiveDate").datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "2010:2030" }).datepicker("setDate", new Date());
        $("#nextIncrementDate").datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "2010:2030" }).datepicker("setDate", new Date());
    });
   function ajaxFiationGrade(res) {
        console.log(res)
        $('#fixationGrade').val(res.fixationGradeId)
       $('#amount').val(res.amount)
    }
    $('#fixationGrade').on('change', function () {
        var empCode = $('#empCode').val();
        Common.Ajax('GET', '/Payroll/Fixation/GetNewIncrementFixationByEmpCode?code=' + code, [], 'json', ajaxNewFixationIncrement, false);

    })

    $('#fixationType').on('change', function () {
        if ($(this).val() == 'Promotion') {
            var code = $('#empCode').val();
            var type = "Promotion";
            Common.Ajax('GET', '/Payroll/Fixation/GetPromotionSalaryByEmpCodeAndType?code=' + code + '&type=' + type, [], 'json', ajaxFunctionGetGrade, false);
        }
        if ($(this).val() == 'Increment') {
            var code = $('#empCode').val();
            var type = "Increment";
            Common.Ajax('GET', '/Payroll/Fixation/GetPromotionSalaryByEmpCodeAndType?code=' + code + '&type=' + type, [], 'json', ajaxFunctionGetGrade, false);
        }
    })
    function ajaxFunctionGetGrade(res) {
        console.log(res);
    }
    function formatDate(date) {
        date = new Date(date);
        var year = date.getFullYear(),
            month = date.getMonth() + 1, // months are zero indexed
            day = date.getDate(),
            hour = date.getHours(),
            minute = date.getMinutes(),
            second = date.getSeconds(),
            hourFormatted = hour % 12 || 12, // hour returned in 24 hour format
            minuteFormatted = minute < 10 ? "0" + minute : minute,
            morning = hour < 12 ? "am" : "pm";

        return day + "/" + + month + "/" + year;

    }

</script>
