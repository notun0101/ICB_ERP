@model RequisitionDetailReportViewModel
@{
	ViewData["Title"] = "Purchase Register Detail";
	Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Style{

}

<div class="Card" style="width: 100%;">
	<div class="card-header row" style="background-color:#EAF6FA;">
		<div class="col-8">
			<h5 class="card-title" style="color: black">Purchase Register</h5>
		</div>

		<div class="col-4">
			<div class="input-group mb-3">
				<div class="input-group-prepend">
					<a class='btn btn-info' style="margin-left: 184px;" data-toggle='tooltip' href='javascript:void(0)' onclick="PrintPdf()"><i style=" font-size: 16px;" class="fas fa-print"></i></a>

					<a class='btn btn-info' style="margin-left: 9px;" data-toggle='tooltip' title='Go Back' href='/Home/GridMenuPage?moduleId=1&perentId=1246'><i style=" font-size: 16px;" class="fas fa-backward"></i></a>

				</div>
			</div>
		</div>
	</div>
	<div class="card-body">
		<div class="container">
			<form asp-area="" asp-controller="" asp-action="Index" id="FormId" method="post" data-parsley-validate="parsley" enctype="multipart/form-data">

				<div class="col-12">
					<div class="row">
						<div class="col-6">
							<div class="form-group row">
								<label for="" class="col-sm-4 col-form-label">Filter By Date Range</label>
								<div class="col-sm-8">

									<select class="form-control" id="DateDrop" name="">
										<option value="">Select</option>
										<option value="">PR Date</option>
										<option value="">Expected</option>
										<option value="">CS Date</option>
										<option value="">GRN Date</option>
										<option value="">Bill Date</option>
										<option value="">Payment Date</option>

									</select>
								</div>
							</div>
						</div>
						<div class="col-6">

						</div>
					</div>
					<div class="row">

						<div class="col-6">
							<div class="form-group row">
								<label for="" class="col-sm-4 col-form-label">Supplier</label>
								<div class="col-sm-8">

									<select class="form-control" id="supplier" name="">
										<option value="">Select</option>
										@*@foreach (var item in )
											{
												<option value="></option>
											}*@
									</select>
								</div>
							</div>
						</div>
						<div class="col-6">

						</div>
					</div>
					<div class="row">

						<div class="col-6">
							<div class="form-group row">
								<label for="" class="col-sm-4 col-form-label">Product Of Service</label>
								<div class="col-sm-8">

									<select class="form-control" id="service" name="">
										<option value="">Select</option>
										@*@foreach (var item in )
											{
												<option value="></option>
											}*@
									</select>
								</div>
							</div>
						</div>
						<div class="col-6">

						</div>
					</div>
					<div class="row">

						<div class="col-6">
							<div class="form-group row">
								<label for="" class="col-sm-4 col-form-label">PR Raiser</label>
								<div class="col-sm-8">

									<select class="form-control" id="prraiser" name="">
										<option value="">Select</option>
										@*@foreach (var item in )
											{
												<option value="></option>
											}*@
									</select>
								</div>
							</div>
						</div>
						<div class="col-6">

						</div>
					</div>
					<div class="row">

						<div class="col-6">
							<div class="form-group row">
								<label for="" class="col-sm-4 col-form-label">Status Update</label>
								<div class="col-sm-8">


									<select class="form-control" id="statusupdate" name="">
										<option value="">Select</option>
										<option value="">PR Raised</option>
										<option value="">PR Approval Pending</option>
										<option value="">CS Pending</option>
										<option value="">PO Raised</option>
										<option value="">PO Approved</option>
										<option value="">Goods Recieved</option>
										<option value="">Bill Created</option>
										<option value="">Unpaied</option>
										<option value="">Partially Paid</option>
										<option value="">Paied</option>

									</select>
								</div>
							</div>
						</div>
						<div class="col-6">

						</div>
					</div>

					<div class="row">

						<div class="col-6">
							<div class="form-group row">
								<label for="" class="col-sm-4 col-form-label"></label>
								<div class="col-sm-8">
									<a href="javascript:void(0)" class="btn btn-success btn-sm btn-block" onclick="Filter()">Filter</a>
								</div>
							</div>
						</div>
						<div class="col-6">

						</div>
					</div>

				</div>

			</form>
		</div>
	</div>
</div>
<br />
<hr />
<div class="row clearfix">
	<div class="col-12">
		<div class="card">
			<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between" style="background-color: #EAF6FA;">
				<h6 class="m-0 font-weight-bold">Report Details</h6>
			</div>
			<div class="card-body">
				<table class="table  table-striped table-responsive table-bordered nowrap" style="width:100%;" id="voucherList">
					<thead>
						<tr>
							<th style="text-align:center;">Pr Date</th>
							<th style="text-align:center;">Pr No</th>
							<th style="text-align:center;">Pr Raised By</th>
							<th style="text-align:center;">Pr Purpose</th>
							<th style="text-align:center;">Expected Delivery Date</th>
							<th style="text-align:center;">Cs Date</th>
							<th style="text-align:center;">Cs Ref</th>
							<th style="text-align:center;">PO Date</th>
							<th style="text-align:center;">PO Ref</th>
							<th style="text-align:center;">Supplier Name</th>
							<th style="text-align:center;">PO Ammount</th>
							<th style="text-align:center;">Net Payable Amount</th>
							<th style="text-align:center;">GRN Date</th>
							<th style="text-align:center;">GRN No</th>
							<th style="text-align:center;">GRN In Value</th>
							<th style="text-align:center;">Payment Date</th>
							<th style="text-align:center;">Payment Ref</th>
							<th style="text-align:center;">Paid Amount</th>
							<th style="text-align:center;">Due Amount</th>
							<th style="text-align:center;">Status Update</th>
						</tr>
					</thead>
					<tbody>
						
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>



@section Scripts{
	<script>
		function Filter() {
			var date = $('#DateDrop').val();
			var supplier = $('#supplier').val();
			var service = $('#service').val();
			var prraiser = $('#prraiser').val();
			var statusupdate = $('#statusupdate').val();
			if (date == '') {
				date = 0;
			}
			if (supplier == '') {
				supplier = 0;
			}
			if (service == '') {
				service = 0;
			}
			if (prraiser == '') {
				prraiser = 0;
			}
			if (statusupdate == '') {
				statusupdate = 0;
			}

			Common.Ajax('GET', '/SCMRequisition/RequisitionMaster/PurchaseRegDetailApi?date=' + date + '&supplier=' + supplier + '&service=' + service + '&raiser=' + prraiser + '&status=' + status, [], 'json', ajaxFunction, false);
		}

		function ajaxFunction(response) {
			console.log(response)
			var option = "";
			$.each(response.requistionReports, function (i, item) {
				var csdate = formatDate(item.getAllReqReport.CsDate);
				var podate = formatDate(item.getAllReqReport.PoDate);
				var prdate = formatDate(item.getAllReqReport.PrDate);
				var deldate = formatDate(item.getAllReqReport.ExpectedDeliveryDate);

				option += `<tr>
								<td>${prdate}</td>
								<td>${item.getAllReqReport.PrNo}</td>
								<td>${item.getAllReqReport.PrRaisedBy}</td>
								<td></td>
								<td>${deldate}</td>
								<td>${csdate}</td>
								<td>${item.getAllReqReport.CSRef}</td>
								<td>${podate}</td>
								<td>${item.getAllReqReport.PoRef}</td>
								<td>${item.supplierName}</td>
							</tr>`
			});
			$('#voucherList tbody').empty();
			$('#voucherList tbody').append(option);
		}

		function formatDate(date) {
			date = new Date(date);
			var year = date.getFullYear(),
				month = date.getMonth() + 1, // months are zero indexed
				day = date.getDate(),
				hour = date.getHours(),
				minute = date.getMinutes(),
				second = date.getSeconds(),
				hourFormatted = hour % 12 || 12, // hour returned in 24 hour format
				minuteFormatted = minute < 10 ? "0" + minute : minute,
				morning = hour < 12 ? "am" : "HR";

			return month + "/" + + day + "/" + year;
		}
	</script>
}