@model AppointmentBarViewModel
@{
	ViewData["Title"] = "Appointment Bar";
	Layout = "~/Areas/Payroll/Views/Shared/_SalaryMasterForm.cshtml";
}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
<style>
	.col-md-12 {
		padding-right: 20px !important;
	}

	.slot-section {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-top: 50px;
	}

	.slot {
		width: 6.25%;
		height: 65px;
		border-right: 1px solid gray;
		border-top: 1px solid gray;
		border-bottom: 1px solid gray;
		position: relative;
	}

	.s1 {
		border-left: 1px solid gray;
		border-top-left-radius: 20% !important;
		border-bottom-left-radius: 20%;
	}

	.s17 {
		border-top-right-radius: 20%;
		border-bottom-right-radius: 20%;
	}

	.fa-users {
		color: darkgreen;
	}

	.fa-desktop {
		color: darkmagenta;
	}

	.card-header {
		background-color: #E7EAED;
	}

	.card-body {
		background-color: linen;
	}

	.card-footer {
		padding-bottom: 4px;
	}

	.modal-body {
		padding-top: 0;
		padding-bottom: 0;
	}

	.modal-footer {
		padding-top: 0px;
		padding-bottom: 0px;
	}

	.card-header h2 {
		font-size: 1.5rem;
		font-weight: 400;
	}

	.card-header .fa-desktop {
		margin-left: 20px;
	}

	h1.main-heading {
		font-size: 1.8rem !important;
		font-weight: 800;
		font-family: sans-serif;
	}

	.slot span {
		position: absolute;
		font-size: 20px;
		top: -31px;
		left: -18px;
	}

	.slot input[type="checkbox"] {
		width: 100%;
		height: 100%;
		opacity: 0;
	}


	.not-booked {
		background-color: greenyellow;
	}

	.pending {
		background-color: green;
	}

	.booked {
		background-color: red;
		color: red;
	}

	#header {
		padding: 5px;
		border: 1px solid gray;
		font-size: 20px;
		font-weight: 500;
	}

	.outer-slot-section {
		height: 693px;
		overflow: scroll;
	}

	.booked span:first-child {
		color: black;
	}

	.s1:before {
		content: '9.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s2:before {
		content: '9.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s3:before {
		content: '10.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s4:before {
		content: '10.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s5:before {
		content: '11.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s6:before {
		content: '11.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s7:before {
		content: '12.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s8:before {
		content: '12.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s9:before {
		content: '1.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s10:before {
		content: '1.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s11:before {
		content: '2.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s12:before {
		content: '2.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s13:before {
		content: '3.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s14:before {
		content: '3.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s15:before {
		content: '4.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s16:before {
		content: '4.30';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}

	.s17:before {
		content: '5.00';
		position: absolute;
		top: -31px;
		right: 10px;
		font-size: 20px;
		color: black;
	}


	.slot span {
		display: none;
	}
</style>
<script>
	var shapla = 0;
	var krisnochura = 0;
	var kopotakkho = 0;
	var dhanshiri = 0;
	var shurma = 0;
	var ConferenceRoom7 = 0;
	var ConferenceRoomEast = 0;
	var ConferenceRoomWest = 0;
	var ConferenceRoom9 = 0;
</script>

<br />
<div class="row">
	<div class="col-md-12">
		<h1>@*@ViewBag.Doctor*@</h1>
		<h1>Dr. ABC</h1>
	</div>
</div>

<div class="container">
	<div class="row mt-4">
		<div class="col-md-12" id="header">
			<div class="row">
				<div class="col-md-4">
					<span>Booking Date: </span><span>@ViewBag.date</span>
				</div>
				<div class="col-md-4">
					<span id="conferenceName"></span>
				</div>
				<div class="col-md-4" style="text-align: right !important;">
					<span>Time: </span><span class="time-difference" id="shaplatiming">0.00-0.00</span>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="row outer-slot-section">
	@*<div class="col-md-12">
		<h2 class="main-heading">@Model.doctorInfo?.employee?.nameEnglish</h2>
	</div>*@
	<div class="col-md-12">
		<div class="card row">
			<div class="card-body lead">
				<div class="col-md-12 slot-section shapla">
					<input type="text" id="startshapla" hidden value="9.00,1.30" />
					<input type="text" id="endshapla" hidden value="10.30,3.30" />
					<input type="text" id="hallIdShapla" hidden value="" />
					<input type="text" class="confName" hidden value="Dr. ABC" />

					<div class="slot s1">
						<span>9.00</span>
						<input type="checkbox" name="slotchk" value="9.00">
					</div>
					<div class="slot s2">
						<span>9.30</span>
						<input type="checkbox" name="slotchk" value="9.30">
					</div>
					<div class="slot s3">
						<span>10.00</span>
						<input type="checkbox" name="slotchk" value="10.00">
					</div>
					<div class="slot s4">
						<span>10.30</span>
						<input type="checkbox" name="slotchk" value="10.30">
					</div>
					<div class="slot s5">
						<span>11.00</span>
						<input type="checkbox" name="slotchk" value="11.00">
					</div>
					<div class="slot s6">
						<span>11.30</span>
						<input type="checkbox" name="slotchk" value="11.30">
					</div>
					<div class="slot s7">
						<span>12.00</span>
						<input type="checkbox" name="slotchk" value="12.00">
					</div>
					<div class="slot s8">
						<span>12.30</span>
						<input type="checkbox" name="slotchk" value="12.30">
					</div>
					<div class="slot s9">
						<span>1.00</span>
						<input type="checkbox" name="slotchk" value="1.00">
					</div>
					<div class="slot s10">
						<span>1.30</span>
						<input type="checkbox" name="slotchk" value="1.30">
					</div>
					<div class="slot s11">
						<span>2.00</span>
						<input type="checkbox" name="slotchk" value="2.00">
					</div>
					<div class="slot s12">
						<span>2.30</span>
						<input type="checkbox" name="slotchk" value="2.30">
					</div>
					<div class="slot s13">
						<span>3.00</span>
						<input type="checkbox" name="slotchk" value="3.00">
					</div>
					<div class="slot s14">
						<span>3.30</span>
						<input type="checkbox" name="slotchk" value="3.30">
					</div>
					<div class="slot s15">
						<span>4.00</span>
						<input type="checkbox" name="slotchk" value="4.00">
					</div>
					<div class="slot s16">
						<span>4.30</span>
						<input type="checkbox" name="slotchk" value="4.30">
					</div>
					<div class="slot s17">
						<span>5.00</span>
						<input type="checkbox" name="slotchk" value="5.00">
					</div>
				</div>
				<div class="col-md-12 mt-1">
					<a href="javascript:void(0)" type="button" class="btn btn-success fa-pull-right" onclick="next(1,'@ViewBag.date')" name="name">Next</a>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-body">
				<p id="bedDescription"></p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

@section ScriptsMD{
	<script src="~/AllCalender/main.js"></script>
	<script>
		var myarray = [];
		var allSlots = ['9.00', '9.30', '10.00', '10.30', '11.00', '11.30', '12.00', '12.30', '1.00', '1.30', '2.00', '2.30', '3.00', '3.30', '4.00', '4.30', '5.00'];
		var allSlotNumbe = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];

		$(document).ready(function () {
			//var allSlots = ['9.00', '9.30', '10.00', '10.30', '11.00', '11.30', '12.00', '12.30', '1.00', '1.30', '2.00', '2.30', '3.00', '3.30', '4.00', '4.30', '5.00'];

			//jQuery for Shapla//
			loadShapla();
		})

		function formatDate(date) {
			date = new Date(date);
			var year = date.getFullYear(),
				month = date.getMonth() + 1, // months are zero indexed
				day = date.getDate(),
				hour = date.getHours(),
				minute = date.getMinutes(),
				second = date.getSeconds(),
				hourFormatted = hour % 12 || 12, // hour returned in 24 hour format
				minuteFormatted = minute < 10 ? "0" + minute : minute,
				morning = hour < 12 ? "am" : "HR";

			return day + "/" + + month + "/" + year;
		}

		$('.slot').click(function () {
			var hallid = $(this).closest('.slot').text();

			//Common.Ajax('GET', '/SCMStock/IssueStock/GetHallBookingInfo?id=' + hallid, [], 'json', ajaxFunction, false);

			function ajaxFunction(response) {
				console.log(response);
				response.bookingDate = formatDate(response.bookingDate);
				$('#exampleModalLabel').text(response.hallInfo.hallNameBn);
				var option = "";
				option += `<div class="row">
						<div class="col-md-5" style="background: aliceblue;">
							<div class="row mt-3">
								<div class="col-md-12">
									<div style="display: flex; justify-content: center; align-items: center;">
										<img src="/images/user.png" style="height: 60px; width: 60px; border-radius: 50%;border: 1px solid gray;" />
									</div>
									<div class="text-center">
										<p class="mb-0">Presided by</p>
										<p>${response.presidedBy}</p>
									</div>
								</div>
								<div class="col-md-12">
									<div style="display: flex; justify-content: center; align-items: center;">
										<img src="/images/user.png" style="height: 60px; width: 60px; border-radius: 50%;border: 1px solid gray;" />
									</div>
									<div class="text-center">
										<p class="mb-0">Initiated by</p>
										<p>${response.applicantName}</p>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-7" style="background-color: lightyellow">
							<div class="row">
								<div class="col-md-12" style="padding: 30px 50px; border-bottom: 1px solid lightgray">
									<div class="form-group row">
										<label class="control-label col-md-3"><i style="font-size: 16px !important;" class="fas fa-calendar-alt"></i></label>
										<label class="control-label col-md-9" style="font-weight: 500;">${response.bookingDate}</label>
									</div>
									<div class="form-group row">
										<label class="control-label col-md-3"><i style="font-size: 16px !important;" class="far fa-clock"></i></label>
										<label class="control-label col-md-9" style="font-weight: 500;">${response.startTime} - ${response.endTime}</label>
									</div>
								</div>
								<div class="col-md-12" style="text-align: center; padding: 20px;font-size: 20px; text-transform: capitalize; font-weight: 600;">
									${response.meetingTitle}
								</div>
							</div>
						</div>
					</div>`

				$('#exampleModal4 .modal-body').empty();
				$('#exampleModal4 .modal-body').append(option);
			}

			//alert(hallid);

			var min = '';
			var max = '';

			$('#conferenceName').text($(this).parent().find('.confName').val());
			//console.log($(this).parent().find('.confName').text());
			//var clickedValue = $(this).find('input[type="checkbox"]').val();

			var checkslotname1 = $(this).parent().prop('class').split(' ')[$(this).parent().prop('class').split(' ').length - 1];
			$('.' + checkslotname1).addClass('active1').siblings('.slot-section').removeClass('active1');
			$('.' + checkslotname1).addClass('active1').siblings('.slot-section').find('.slot').removeClass('pending').find('input[type="checkbox"]').prop('checked', false);

			//if ($(".slot input:checkbox[name=slotchk]").is(":checked")) {
			//	myarray.push($(this).text().trim());
			//	$(this).closest('.slot').toggleClass('pending');
			//}

			//if (($(".slot input:checkbox[name=slotchk]").is(":checked")) == true) {
			//	myarray = [];
			//	console.log($(this).text())
			//	myarray.push($(this).text().trim());
			//	$(this).closest('.slot').toggleClass('pending');
			//}
			myarray = [];
			$('.slot input:checkbox[name=slotchk]:checked').each(function () {
				if ($(this).closest('.slot').prop('class').indexOf('booked') == -1) {
					myarray.push($(this).val());
				}
			});
			//console.log($(this).closest('.slot').prop('class').indexOf('booked') >= 0);
			if ($(this).closest('.slot').prop('class').indexOf('booked') >= 0) {
				//getBookingInfo();

				$('#exampleModal4').modal('show');
			}
			else {
				$(this).closest('.slot').toggleClass('pending');
			}


			if (myarray.length < 2) {
				$('#shaplatiming').text(myarray[0])
			}

			if (myarray.length >= 2) {
				min = myarray[0];
				max = myarray[myarray.length - 1];

				var minIndex = jQuery.inArray(min, allSlots);
				var maxIndex = jQuery.inArray(max, allSlots);

				if (maxIndex - minIndex > 1) {
					for (var i = minIndex + 1; i < maxIndex; i++) {
						if (jQuery.inArray(allSlots[i], myarray) == -1) {
							myarray.push(allSlots[i]);
						}
					}
				}
			}

			//console.log(myarray)
			//if (myarray.length > 1) {
			//    loadShaplaGreen(myarray[0], myarray[1]);
			//}

			$(this).closest('.s1').siblings('.s1').addClass('pending');
			//$(this).closest('.slot').next('.slot').addClass('pending');
			for (var i = 0; i < myarray.length; i++) {
				var className = '.s_' + myarray[i];
				$(className).addClass('pending');
			}

			//console.log(min + ' ' + max);
			if (min > 0 && max > 0) {
				//console.log(checkslotname1);
				//var checkslotname = $(this).parent().prop('class').split(' ')[$(this).parent().prop('class').split(' ').length - 1];
				//var getid = '#' + checkslotname1 + 'timing';
				//console.log(grtid);

				$('#shaplatiming').text(min + '-' + max);
				//console.log($(this).parent().prop('class').split(' ')[$(this).parent().prop('class').split(' ').length - 1]);
				////$(this).parent().parent().find('h2.time-difference').text(min + '-' + max);
				//$(this).prev('.time-difference').text(min + '-' + max);
			}

		})
		function next(hallId, date) {
			var value = $('#shaplatiming').text();
			window.location.href = '/SCMStock/IssueStock/Conferenceboooking?hallId=' + hallId + '&duration=' + value + '&date=' + date;
		}

		function loadShapla() {
			//get array of all start and end time slot
			var shaplaBookStartArr = $('#startshapla').val().split(",");
			var shaplaBookEndArr = $('#endshapla').val().split(",");
			//alert(shaplaBookStartArr)
			var hallIdArr = $('#hallIdShapla').val().split(",");
			//console.log("id");
			//console.log(hallIdArr);
			$('.booked span.hallidspan').text(hallIdArr[0]);


			//create a blank array to store booked time slot
			var shaplaBooked = [];
			var shaplaIds = [];

			//loop over the start or end time slot array
			for (var i = 0; i < shaplaBookStartArr.length; i++) {
				shaplaIds.push(hallIdArr[i]);
				shaplaIds.push(hallIdArr[i]);
				//push start and end time to the array
				shaplaBooked.push(shaplaBookStartArr[i]);
				shaplaBooked.push(shaplaBookEndArr[i]);
				//calculate difference between start and end time slot
				var dif = allSlots.indexOf(shaplaBookEndArr[i]) - allSlots.indexOf(shaplaBookStartArr[i]);
				//if there any slot between the start and end time, push the slots to the array
				if (dif > 1) {
					for (var j = 1; j < dif; j++) {
						shaplaBooked.push(allSlots[allSlots.indexOf(shaplaBookStartArr[i]) + j]);
						shaplaIds.push(hallIdArr[i]);
					}

				}
				else {
					return false;
				}
			}

			//get all the booked slot in console
			//console.log(shaplaBooked);
			//console.log("array " + shaplaIds);
			//fill the slots with styles which are booked
			var iteration = 0;
			shaplaBooked.forEach(e => {
				$('.shapla .slot input[value="' + e + '"]').closest('.slot').addClass('booked');
				$('.shapla .slot input[value="' + e + '"]').closest('.slot').click(false);

				$('.shapla .slot input[value="' + e + '"]').closest('.slot').text(shaplaIds[iteration]);


				iteration++;
				//$('.shapla .slot input[value="' + e + '"]').click(false);
			});

			//console.log(shaplaBooked);
		}

	</script>
}
