

@model ActivityMasterViewModel
@{
    ViewData["Title"] = "Activities";
    Layout = "~/Areas/CRMLead/Views/Shared/_LeadFormCold.cshtml";
}

@section StyleLead{

    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote-bs4.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    @*<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>*@
    <style>
        ul.ui-autocomplete {
            z-index: 99999999;
        }
    </style>
}

<div class="card" style="width: 100%;">
    <div class="card-body">
        @*<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h4 class="m-0 font-weight-bold text-primary">Activities</h4>
                <a href="/CRMLead/LeadManagement/AllLeadList" style="background-color:#024972;" class="btn btn-info btn-sm pull-right">Back to List</a>
            </div>*@


        <hr>
        <div class="container">
            <form asp-area="CRMLead" asp-controller="Activity" asp-action="ActivityMasterColdVisit" method="post" data-parsley-validate="parsley">
                <div asp-validation-summary="All" class="text-danger"></div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group row">

                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Company name</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="LeadName" id="LeadName">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Category</label>
                            <div class="col-sm-8">
                                <input type="hidden" name="Id" id="Id" value="0" />
                                <input type="hidden" name="leadsID" id="leadsID" value="@ViewBag.leadId" />
                                <input type="hidden" name="category" id="category" value="1008" />
                                <input type="text" class="form-control" name="categoryName" id="categoryName" value="Cold Visit" readonly>
                                @*<select class="form-control" name="category" id="category">

            @foreach (var data in Model.ActivityCategories.Where(x => x.Id == 1008))
            {
                <option value="@data.Id">@data.activityCategoryName</option>
            }
        </select>*@
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Session</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="session" id="session" data-parsley-required="true">
                                    <option value="">Select</option>
                                    @foreach (var data in Model.ActivitySessions)
                                    {
                                        <option value="@data.Id">@data.activitySessionName</option>
                                    }
                                </select>

                            </div>
                        </div>





                        <div class="form-group row">

                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Assign To</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="assignTo" id="assignTo">

                                    <option value="Own">Own</option>
                                    <option value="TeamMember">Team Member</option>

                                </select>
                            </div>
                        </div>
                        <div class="form-group row" id="teamdiv" style="display:none">

                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Team Member</label>
                            <div class="col-sm-5">
                                <select class="form-control" name="teamMember" id="teamMember">

                                    <option value="">Select</option>
                                    @foreach (var data in Model.teams.Where(x => x.moduleId == 2))
                                    {
                                        <option value="@data.Id">@data.memberName</option>
                                    }

                                </select>
                            </div>
                            <a href="#" class="btn  btn-default" onclick="AddTeam()" style="float:right;"><i class="fas fa-plus"></i></a>
                        </div>
                        <div class="form-group row" id="teamdivd" style="display:none">
                            <div class="col-sm-4">

                            </div>
                            <div class="col-sm-5" id="contactdivIdt">

                            </div>
                            <div class="col-sm-1" id="contactdivIdtbtn">

                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group row">
                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Type</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="typeId" id="typeId" data-parsley-required="true">
                                    <option value="">Select</option>
                                    @foreach (var data in Model.ActivityTypes)
                                    {
                                        <option value="@data.Id">@data.activityTypeName</option>
                                    }
                                </select>

                            </div>
                        </div>
                        <div class="form-group row" id="relationwith" style="display:none">
                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Relation With</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="parentID" id="parentID">
                                    <option value="">Select</option>
                                    @foreach (var data in Model.coldActivityMasters.Where(x => x.activityCategoryId == 1008))
                                    {
                                        <option value="@data.Id">@data.subject (@data.Id)</option>
                                    }
                                </select>

                            </div>
                        </div>
                        <div class="form-group row">

                            <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Status</label>
                            <div class="col-sm-8">
                                <select class="form-control" name="activityStatusId" id="activityStatusId" data-parsley-required="true">
                                    <option value="">Select</option>
                                    @foreach (var data in Model.activityStatuses)
                                    {
                                        <option value="@data.Id">@data.status</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">

                            <label for="activitiesDate" class="col-sm-4 col-form-label">Activity Date Time</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="activitiesDate" id="activitiesDate">
                            </div>

                        </div>
                        <div class="form-group row">

                            <label for="activitiesDate" class="col-sm-4 col-form-label">Set Reminder?</label>
                            <div class="col-sm-2">
                                <input type="checkbox" class="form-control" name="isreminder" id="isreminder">
                            </div>

                        </div>
                        <div class="form-group row" id="reminderTimediv" style="display:none">

                            <label for="activitiesDate" class="col-sm-4 col-form-label">Remind Time</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="reminderTime" id="reminderTime">
                            </div>

                        </div>

                    </div>
                </div>
                <hr />
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group row">
                            <label for="activityCategoryName" class="col-sm-4 col-form-label" id="lblsubject">Subject</label>
                            <div class="col-sm-8">
                                <input type="text" data-parsley-required="true" data-parsley-trigger="keyup" class="form-control" name="subject" id="subject">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="activityCategoryName" class="col-sm-4 col-form-label" id="lbldescription">Description</label>
                            <div class="col-sm-8">
                                <textarea type="text" class="form-control" id="description" name="description"></textarea>

                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group row">

                            <label for="activityCategoryName" class="col-sm-4 col-form-label" id="lblcontact">Contact  Name</label>
                            <div class="col-sm-5">
                                @*<select class="form-control" id="contactsId" name="contactsId">
                                        <option value="0">-Select-</option>
                                        @foreach (var data in Model.contacts)
                                        {
                                            <option value="@data.Id">@data.resource.resourceName</option>
                                        }
                                    </select>*@
                                <input type="text" data-parsley-required="true" data-parsley-trigger="keyup" class="form-control" name="contactsId" id="contactsId">

                            </div>
                            <a href="#" class="btn  btn-default" onclick="AddContact()" style="float:right;"><i class="fas fa-plus"></i></a>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-4">

                            </div>
                            <div class="col-sm-5" id="contactdivId">

                            </div>
                            <div class="col-sm-1" id="contactdivIdbtn">

                            </div>
                        </div>

                    </div>
                </div>

                <hr>
                <button type="submit" value="Submit" class="btn btn-success btn-lg" style="float:right; margin-top:5px;"><i class="fas fa-save"></i></button>
            </form>
        </div>
    </div>
</div>

<br />
<hr />
<div class="row clearfix">
    <div class="col-12">
        <div class="card mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Activity list</h6>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <table class="table table-striped table-bordered" id="ActivityMasterTable">
                    <thead>
                        <tr>
                            <th>Lead Name</th>
                            <th>Subject</th>
                            <th>Category</th>
                            @*<th>Start Date</th>
                                <th>End Date</th>*@
                            @*<th>Priority</th>*@
                            <th>Description</th>
                            <th>action</th>
                    </thead>
                    <tbody>
                        @foreach (var data in Model.coldActivityMasterCViewModels.Where(x => x.activityMasters.activityCategory.activityCategoryName != "Cold Phone Call").OrderByDescending(x=>x.activityMasters.activitiesDate))
                        {
                            <tr>
                                <td>@data.activityMasters.companyName</td>
                                <td>@data.activityMasters.subject</td>
                                <td>@data.activityMasters.activityCategory.activityCategoryName</td>

                                @*<td>@data.activityMasters.priority</td>*@
                                <td>@data.activityMasters.description</td>
                                <td>
                                    <a class="btn btn-success" onclick="Edit(@data.activityMasters.Id,0,'@data.activityMasters.companyName','@data.activityMasters.subject','@data.activityMasters.activityCategoryId','@data.activityMasters.priority','@data.activityMasters.description',@data.activityMasters.activitySessionId,@data.activityMasters.activityTypeId,'@data.activityMasters.ownerType',@data.activityMasters.activityStatusId,@data.activityMasters.isreminder,'@data.activityMasters.activitiesDate','@data.activityMasters.reminderTime',@data.activityMasters.coldActivityMastersId)" href="javascript:void(0)"><i class="fa fa-edit"></i></a>
                                    <a class="btn btn-danger" title="Delete Activity" onclick="DeleteActivity(@data.activityMasters.Id)" href="#"><i class="fa fa-trash-alt"></i></a>
                                    <a class="btn btn-success" onclick="showdetails(@data.activityMasters.Id,'@data.activityMasters.companyName')" href="javascript:void(0)"><i class="fas fa-tasks"></i></a>
                                    <a title="View Cold Activity Details" class="btn btn-success" href="~/CRMLead/Activity/ColdVisitActivityMasterView/@data.activityMasters.Id">@data.countchild</a>
                                    @*<a class="btn btn-success" onclick="showdetails(@data.activityMasters.Id)" href="javascript:void(0)">@data.countchild</a>*@
                                    @*<a title="View Activity Details" class="btn btn-success" href="~/CRMLead/Activity/ActivityMasterView/@data.activityMasters.Id">@data.countchild</a>*@
                                </td>
                                @*<td>
                                        <a class="btn btn-success"  href="javascript:void(0)"><i class="fa fa-edit">@Model.activityMasters.Where(x=>x.parentId==data.Id).Count()</i></a>

                                    </td>*@
                            </tr>
                        }

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="acitivitydetails" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">


            <div class="modal-body">

                <div class="container">
                    <form asp-area="CRMLead" asp-controller="Activity" asp-action="ActivityMasterColdVisitDis" method="post" data-parsley-validate="parsley">
                        <div asp-validation-summary="All" class="text-danger"></div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="form-group row">
                                    <label for="activityCategoryName" class="col-sm-12 col-form-label" style="text-align:center">Add Discussion(<span id="companyName"></span>)</label>

                                </div>
                                <div class="form-group row">
                                    <label for="activityCategoryName" class="col-sm-2 col-form-label" id="lbldiscussion">Discussion</label>
                                    <div class="col-sm-8">
                                        <textarea type="text" class="form-control" id="discussion" name="discussion"></textarea>

                                    </div>
                                    <a href="#" class="btn  btn-default" onclick="AddDiscussion()" style="float:right;"><i class="fas fa-plus"></i></a>
                                </div>
                                <div class="row">
                                    <div class="col-sm-2">

                                    </div>
                                    <div class="col-sm-8" id="discussiondivId">

                                    </div>
                                    <div class="col-sm-1" id="discussiondivIdbtn">

                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <div class="form-group row">
                                    @*<input type="checkbox" class="togg" id="showtask" name="showtask" style="max-width: 100px !important" data-toggle="toggle" data-on="On" data-off="Follow Up" data-width="120" data-height="30">*@
                                    <label for="activitiesDate" class="col-sm-3 col-form-label">Follow Up?</label>
                                    <div class="col-sm-2">
                                        <input type="checkbox" class="form-control" name="isfollowUp" id="isfollowUp">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />


                        <div class="row" id="newtaskone" style="display:none">
                            <div class="col-sm-6">
                                <div class="form-group row">

                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Company name</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" name="LeadName" id="LeadNameM" readonly>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Category</label>
                                    <div class="col-sm-8">
                                        <input type="hidden" name="Id" id="Id" value="0" />
                                        <input type="hidden" name="leadsID" id="leadsID" value="@ViewBag.leadId" />
                                        <select class="form-control" name="category" id="category">

                                            @foreach (var data in Model.ActivityCategories)
                                            {
                                                <option value="@data.Id">@data.activityCategoryName</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Session</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" name="session" id="session">

                                            @foreach (var data in Model.ActivitySessions)
                                            {
                                                <option value="@data.Id">@data.activitySessionName</option>
                                            }
                                        </select>

                                    </div>
                                </div>





                                <div class="form-group row">

                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Assign To</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" name="assignTo" id="assignToM">

                                            <option value="Own">Own</option>
                                            <option value="TeamMember">Team Member</option>

                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row" id="teamdivM" style="display:none">

                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Team Member</label>
                                    <div class="col-sm-5">
                                        <select class="form-control" name="teamMember" id="teamMemberM">


                                            @foreach (var data in Model.teams.Where(x => x.moduleId == 2))
                                            {
                                                <option value="@data.Id">@data.memberName</option>
                                            }

                                        </select>
                                    </div>
                                    <a href="#" class="btn  btn-default" onclick="AddTeamM()" style="float:right;"><i class="fas fa-plus"></i></a>
                                </div>
                                <div class="form-group row" id="teamdivdM" style="display:none">
                                    <div class="col-sm-4">

                                    </div>
                                    <div class="col-sm-5" id="contactdivIdtM">

                                    </div>
                                    <div class="col-sm-1" id="contactdivIdtMbtn">

                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group row">
                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Type</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" name="typeId" id="typeId">

                                            @foreach (var data in Model.ActivityTypes.Where(x => x.Id == 2))
                                            {
                                                <option value="@data.Id">@data.activityTypeName</option>
                                            }
                                        </select>

                                    </div>
                                </div>
                                <div class="form-group row" id="relationwith" style="display:none">
                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Relation With</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" name="parentID" id="parentMID">

                                            @foreach (var data in Model.coldActivityMasters)
                                            {
                                                <option value="@data.Id">@data.subject (@data.Id)</option>
                                            }
                                        </select>

                                    </div>
                                </div>
                                <div class="form-group row">

                                    <label for="activityCategoryName" class="col-sm-4 col-form-label">Activity Status</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" name="activityStatusId" id="activityStatusId">

                                            @foreach (var data in Model.activityStatuses)
                                            {
                                                <option value="@data.Id">@data.status</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">

                                    <label for="activitiesDate" class="col-sm-4 col-form-label">Activity Date Time</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" name="activitiesDate" id="activitiesDateM">
                                        <input type="hidden" class="form-control" name="CParentId" id="CParentId">
                                    </div>

                                </div>
                                <div class="form-group row">

                                    <label for="activitiesDate" class="col-sm-4 col-form-label">Set Reminder?</label>
                                    <div class="col-sm-2">
                                        <input type="checkbox" class="form-control" name="isreminder" id="isreminderM">
                                    </div>

                                </div>
                                <div class="form-group row" id="reminderTimedivM" style="display:none">

                                    <label for="activitiesDate" class="col-sm-4 col-form-label">Remind Time</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" name="reminderTime" id="reminderTimeM">
                                    </div>

                                </div>

                            </div>
                        </div>
                        <hr />
                        <div class="row" id="newtasktwo" style="display:none">
                            <div class="col-sm-6">
                                <div class="form-group row">
                                    <label for="activityCategoryName" class="col-sm-4 col-form-label" id="lblsubject">Subject</label>
                                    <div class="col-sm-8">
                                        <input type="text" data-parsley-trigger="keyup" class="form-control" name="subject" id="subject">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="activityCategoryName" class="col-sm-4 col-form-label" id="lbldescription">Description</label>
                                    <div class="col-sm-8">
                                        <textarea type="text" class="form-control" id="description" name="description"></textarea>

                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group row">

                                    <label for="activityCategoryName" class="col-sm-4 col-form-label" id="lblcontact">Contact  Name</label>
                                    <div class="col-sm-5">

                                        <input type="text" data-parsley-trigger="keyup" class="form-control" name="contactsId" id="contactsIdM">

                                    </div>
                                    <a href="#" class="btn  btn-default" onclick="AddContactM()" style="float:right;"><i class="fas fa-plus"></i></a>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-4">

                                    </div>
                                    <div class="col-sm-5" id="contactdivIdM">

                                    </div>
                                    <div class="col-sm-1" id="contactdivIdMbtn">

                                    </div>
                                </div>

                            </div>
                        </div>

                        <hr>
                        <button type="submit" id="adddisduss" class="btn btn-success btn-lg" style="float:right; margin-top:5px;"><i class="fas fa-save"></i></button>
                    </form>
                </div>

            </div>
            <div class="modal-footer">
                <a href="javascript:void(0)" style="color:deepskyblue" id="btnCancel" data-dismiss="modal">Cancel</a>
            </div>

        </div>
    </div>
</div>
@section ScriptsLead{
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote-bs4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script>


        function AddDetails(subject, description) {

            var ifExistIndex = null;
            var index = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                index = $("#tblCoscentre tbody>tr").length;
            }
            else {
                index = ifExistIndex;
                tdRID = $("#tblCoscentre tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .txtcoscentreId").val();
            }
            var dtTable = $("#tblCoscentre");
            var tableBody = dtTable.find('tbody');
            var trHtml = '<tr id=' + 1 + '>' +
                '<td>' + subject + '</td>' +

                '<td >' + description + '</td>' +
                '<td><a href="javascript:void(0)" data-toggle="tooltip" title="Edit" class="btn btn-success" onclick="Edit(' + 1 + ')"><i class="fa fa-trash"></i></a></td>' +


                '</tr>';

            if (ifExistIndex == null || ifExistIndex == "null") {
                tableBody.append(trHtml);
            }
            else {
                var rowUpdate = $("#tblCoscentre tbody >tr:eq(" + ifExistIndex + ")");
                rowUpdate.replaceWith(trHtml);
                window.localStorage.setItem("holdIndex", null);
                ifExistIndex = null;
            }

            let rowCount = $("#tblCoscentre tbody>tr").length;
            var tableFoot = dtTable.find('tfoot');

        }
        $(document).ready(function () {
            //$('#startDate').datepicker({ uiLibrary: 'bootstrap4' });
            //$('#endDate').datepicker({ uiLibrary: 'bootstrap4' });
            $('#description').summernote({
                tabsize: 2,
                height: 300
            });
            $('#activitiesDate').flatpickr({
                enableTime: true,
                minTime: "09:00"
            });
            $('#reminderTime').flatpickr({
                enableTime: true,
                minTime: "07:00"
            });
            $('#activitiesDateM').flatpickr({
                enableTime: true,
                minTime: "09:00"
            });
            $('#reminderTimeM').flatpickr({
                enableTime: true,
                minTime: "07:00"
            });
            //$(document).on("click", "input[name = 'showtask']", function (e) {
            //    alert("dcjdsacd");
            //});
            //$('#showtask').on('click', function(event){
            //    event.preventDefault();
            //    alert("dcscdsa");

            //});

            $(document).on("click", "input[name = 'isfollowUp']", function (e) {
                var proval = 0;

                if (this.checked) {
                    $(this).attr("value", "1");
                    $("#newtaskone").show();
                    $("#newtasktwo").show();
                }

                else {
                    $(this).attr("value", "0");
                    $("#newtaskone").hide();
                    $("#newtasktwo").hide();
                }
            });
            //$('.togg').on('click', function () {
            //    alert("dcjdsacd");
            //});
            $(document).on("click", "input[name = 'isreminder']", function (e) {
                var proval = 0;
               

                if (this.checked) {
                    $(this).attr("value", "1");
                    $("#reminderTimediv").show();
                }

                else {
                    $(this).attr("value", "0");
                    $("#reminderTimediv").hide();
                }
            });
            $(document).on("click", "input[id = 'isreminderM']", function (e) {
                var proval = 0;
                //$('[name="ProcurementValue"]').each(function (i, e) {
                //    if ($(e).is(':checked')) {
                //        proval = 1;
                //    }
                //});

                if (this.checked) {
                    $(this).attr("value", "1");
                    $("#reminderTimedivM").show();
                }

                else {
                    $(this).attr("value", "0");
                    $("#reminderTimedivM").hide();
                }
            });

            $("#coldVisit").addClass("active");
            $('#ActivityMasterTable').DataTable();
            $('#assignTo').change(function () {

                var id = $(this).val();
                if (id == "Own") {
                    $('#teamdiv').hide();
                    $('#teamdivd').hide();
                }
                else {
                    $('#teamdiv').show();
                    $('#teamdivd').show();

                }
            });
            $('#assignToM').change(function () {

                var id = $(this).val();
                if (id == "Own") {
                    $('#teamdivM').hide();
                    $('#teamdivdM').hide();
                }
                else {
                    $('#teamdivM').show();
                    $('#teamdivdM').show();

                }
            });
            $('#typeId').change(function () {
                if ($('#typeId').val() == "2") {
                    $('#relationwith').show();


                }
                else {
                    $('#relationwith').hide();
                }

            });
            $('#category').change(function () {

                if ($('#category option:selected').text() == "Email") {

                    $('#lblsubject').text("Email Subject");
                    $('#lblcontact').text("Mail To");
                    $('#lbldescription').text("Mail Descrioption");

                }
                if ($('#category option:selected').text() == "phone call") {

                    $('#lblsubject').text("Phone Call Reason");
                    $('#lblcontact').text("Call To");
                    $('#lbldescription').text("Discussion");

                }
                if ($('#category option:selected').text() == "Client Visit") {

                    $('#lblsubject').text("Visit Reason");
                    $('#lblcontact').text("Visit To");
                    $('#lbldescription').text("Meeting Minutes");

                }
                if ($('#category option:selected').text() == "Meeting") {

                    $('#lblsubject').text("Meeting Agenda");
                    $('#lblcontact').text("Meeting With");
                    $('#lbldescription').text("Meeting Minutes");

                }
                if ($('#category option:selected').text() == "Team Meeting") {

                    $('#lblsubject').text("Meeting Title");
                    $('#lblcontact').text("Meeting With");
                    $('#lbldescription').text("Meeting Minutes");

                }
                if ($('#category option:selected').text() == "Others") {

                    $('#lblsubject').text("Subject");
                    $('#lblcontact').text("Contact");
                    $('#lbldescription').text("Remarks");

                }
                if ($('#category option:selected').text() == "Offer Letter") {

                    $('#lblsubject').text("Subject");
                    $('#lblcontact').text("Offer To");
                    $('#lbldescription').text("Remarks");

                }
            });

           if (@Model.coldActivityMaster?.Id!= 0)
            {
                $("#Id").val(@Model.coldActivityMaster?.Id);
                @*$("#leadsID").val(@Model.activityMaster.leadsId);*@
                $("#session").val(@Model.coldActivityMaster?.activitySessionId);
                $("#LeadName").val('@Model.coldActivityMaster?.companyName');
                $("#subject").val('@Model.coldActivityMaster.subject');
                $("#category").val(@Model.coldActivityMaster.activityCategoryId);
                $("#typeId").val(@Model.coldActivityMaster.activityTypeId);
                $("#assignTo").val('@Model.coldActivityMaster.ownerType');
                $("#activityStatusId").val(@Model.coldActivityMaster.activityStatusId);
                $("#activitiesDate").val('@Model.coldActivityMaster.activitiesDate');
                @*string reminder ='@Model.activityMaster?.isreminder';
                alert(reminder);*@
                if ('@Model.coldActivityMaster?.isreminder' != '') {
                    $("#isreminder").prop("checked", true);
                    $("#reminderTimediv").show();
                }
                else {

                    $("#isreminder").prop("checked", false);
                    $("#reminderTimediv").hide();
                }
                $("#isreminder").val(@Model.coldActivityMaster.isreminder);
                $("#reminderTime").val('@Model.coldActivityMaster.reminderTime');

                if ('@Model.coldActivityMaster?.ownerType' == "Own") {
                    $('#teamdiv').hide();
                    $('#teamdivd').hide();
                }
                else {
                    $('#teamdiv').show();
                    $('#teamdivd').show();

                }
                if ('@Model.coldActivityMaster?.activityTypeId' != '')
                {
                    $("#relationwith").hide();

                }
                else
                {
                    $("#relationwith").show();
                    $("#parentID").val(@Model.coldActivityMaster.coldActivityMastersId);
                }

                    $("#priority").val('@Model.coldActivityMaster.priority');

                $("#description").val('@Model.coldActivityMaster.description');

                
                 Common.Ajax('GET', '/global/api/ActivityDetailsCold/' + @Model.coldActivityMaster.Id, [], 'json', ajaxGetcontactList);
                 Common.Ajax('GET', '/global/api/ActivityTeamsCold/' + @Model.coldActivityMaster.Id, [], 'json', ajaxGetTeamList);

            }

        });
        function DeleteActivity(Id) {
            //Common.Ajax('GET', '/CRMMasterData/Sector/DeleteSectorById/?id=' + Id, [], 'json', ajaxHandle);

            swal({
                title: 'Are you sure?', text: 'Do you want to delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, delete it!'
            }).then(function () {
                window.location.href = "/CRMLead/Activity/DeleteActivityById/?id=" + Id;
                swal({
                    title: '', text: 'Deleted Successfully!', type: 'success', showCancelButton: false, confirmButtonColor: '#3085d6', confirmButtonText: 'Ok!',
                });
            });
        }
        function ajaxGetcontactList(response) {
            $('#contactdivId').empty();
            $('#contactdivIdbtn').empty();
            var GetLeadList = [];
            $.each(response, function (id, option) {

                AddContactEdit(option.contactName);

            });

        }
        function ajaxGetdiscussList(response) {

            $('#discussiondivId').empty();
            $('#discussiondivIdbtn').empty();
            console.log(response);
            var GetLeadList = [];
            $.each(response, function (id, option) {

                AddDiscussionEdit(option.discussion);

            });

        }
        function ajaxGetDeatilsList(response) {
            var GetLeadList = [];
            console.response;
            $.each(response, function (id, option) {

                AddDetails(option.subject, option.description);

            });

        }
        function ajaxGetTeamList(response) {
            $('#contactdivIdt').empty();
            $('#contactdivIdtbtn').empty();
            var GetLeadList = [];
            console.response;
            $.each(response, function (id, option) {

                AddTeamEdit(option.teamId, option.team.memberName);

            });

        }
        function showdetails(id, name) {
            $('#acitivitydetails').modal('show');

            $('#companyName').text(name);
            $('#LeadNameM').val(name);

            $('#parentID').val(id);
            $('#CParentId').val(id);

            //$("#tblCoscentre tbody>tr").remove();
            Common.Ajax('GET', '/global/api/ActivityDiscussionByParentId/' + id, [], 'json', ajaxGetdiscussList);

        }
        function Edit(Id, leadsID, leadName, subject, activityCategoryId, priority, description, sessionId, activityTypeId, OwnerType, activityStatusId, isreminder, activityDate, reminderTime, activitymasterId) {

            $("#Id").val(Id);
            $("#leadsID").val(leadsID);
            $("#session").val(sessionId);
            $("#LeadName").val(leadName);
            $("#subject").val(subject);
            $("#category").val(activityCategoryId);
            $("#typeId").val(activityTypeId);
            $("#assignTo").val(OwnerType);
            $("#activityStatusId").val(activityStatusId);
            $("#activitiesDate").val(activityDate);
            if (isreminder == 1) {
                $("#isreminder").prop("checked", true);
                $("#reminderTimediv").show();
            }
            else {

                $("#isreminder").prop("checked", false);
                $("#reminderTimediv").hide();
            }
            $("#isreminder").val(isreminder);
            $("#reminderTime").val(reminderTime);

            if (OwnerType == "Own") {
                $('#teamdiv').hide();
                $('#teamdivd').hide();
            }
            else {
                $('#teamdiv').show();
                $('#teamdivd').show();

            }
            if (activityTypeId == 1) {
                $("#relationwith").hide();

            }
            else {
                $("#relationwith").show();
                $("#parentID").val(activitymasterId);
            }

            $("#priority").val(priority);
            $("#description").val(description);


            Common.Ajax('GET', '/global/api/ActivityDetailsCold/' + Id, [], 'json', ajaxGetcontactList);
            Common.Ajax('GET', '/global/api/ActivityTeamsCold/' + Id, [], 'json', ajaxGetTeamList);
        }
        //Common.Ajax('GET', '/global/api/GetLeadsByLeadOwner', [], 'json', ajaxGetLeadsByLeadOwner);
        function AddTeam() {
            var comvalue = $('#teamMember option:selected').text();
            var comvalueId = $('#teamMember').val();
            if (comvalueId == 0) {
                swal('Attention', 'Please select valid contact', 'warning');

                return false;
            }

            if (document.getElementById(comvalueId) == null) {
                $('#contactdivIdt').append('<input class="form-control" style="margin-bottom:10px" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
                $('#contactdivIdt').append('<input style="margin-bottom:10px"  type="hidden" id="hdn' + comvalueId + '" name="teamlist[]" value="' + comvalueId + '" />');
                $('#contactdivIdtbtn').append('<a href="javasript:void(0)" id="txt' + comvalueId + '" class="btn  btn-default" onclick="hideelementxt(' + comvalueId + ',' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px"><i class="fas fa-minus"></i></a>');
            }
            else {
                swal('Attention', 'This record already exists', 'warning');
                return false;
            }
        }
        function AddTeamEdit(Id, Name) {

            var comvalue = Name;
            var comvalueId = Id;

            $('#contactdivIdt').append('<input class="form-control" style="margin-bottom:10px" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
            $('#contactdivIdt').append('<input type="hidden" style="margin-bottom:10px" id="hdn' + comvalueId + '" name="teamlist[]" value="' + comvalueId + '" />');
            $('#contactdivIdtbtn').append('<a href="javasript:void(0)" id="txt' + comvalueId + '" class="btn  btn-default" onclick="hideelementxt(' + comvalueId + ',' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px"><i class="fas fa-minus"></i></a>');
            // alert($('#contactdivIdt').length);
        }
        function AddTeamM() {
            var comvalue = $('#teamMemberM option:selected').text();
            var comvalueId = $('#teamMemberM').val();
            if (comvalueId == 0) {
                swal('Attention', 'Please select valid contact', 'warning');

                return false;
            }

            if (document.getElementById(comvalueId) == null) {
                $('#contactdivIdtM').append('<input class="form-control" style="margin-bottom:10px" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
                $('#contactdivIdtM').append('<input  type="hidden" style="margin-bottom:10px" id="hdn' + comvalueId + '" name="teamlist[]" value="' + comvalueId + '" />');
                $('#contactdivIdtMbtn').append('<a href="javasript:void(0)" id="txt' + comvalueId + '" class="btn  btn-default" onclick="hideelementxt(' + comvalueId + ',' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px"><i class="fas fa-minus"></i></a>');
            }
            else {
                swal('Attention', 'This record already exists', 'warning');
                return false;
            }
        }

        function AddContactM() {
            var comvalue = $('#contactsIdM').val();
            var comvalueId = $('#contactsIdM').val();

            if (document.getElementById(comvalueId) == null) {
                $('#contactdivIdM').append('<input class="form-control" type="text" style="margin-bottom:10px;" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
                $('#contactdivIdM').append('<input  type="hidden" style="margin-bottom:10px;" id="hdn' + comvalue + '" name="contactlistname[]" value="' + comvalueId + '" />');
                $('#contactdivIdMbtn').append('<a href="javasript:void(0)" id="txt' + comvalue + '" class="btn  btn-default" onclick="hideelementx(' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px;"><i class="fas fa-minus"></i></a>');
            }
            else {
                swal('Attention', 'This record already exists', 'warning');
                return false;
            }
        }
        function AddContact() {
            var comvalue = $('#contactsId').val();
            var comvalueId = $('#contactsId').val();

            if (document.getElementById(comvalueId) == null) {
                $('#contactdivId').append('<input class="form-control" style="margin-bottom:10px;" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
                $('#contactdivId').append('<input  type="hidden" style="margin-bottom:10px;" id="hdn' + comvalue + '" name="contactlistname[]" value="' + comvalueId + '" />');
                $('#contactdivIdbtn').append('<a href="javasript:void(0)" id="txt' + comvalue + '" class="btn  btn-default" onclick="hideelementx(' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px"><i class="fas fa-minus"></i></a>');
            }
            else {
                swal('Attention', 'This record already exists', 'warning');
                return false;
            }
        }
        function AddContactEdit(Name) {
            var comvalue = Name;
            var comvalueId = Name;

            $('#contactdivId').append('<input class="form-control" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
            $('#contactdivId').append('<input type="hidden" id="hdn' + comvalue + '" name="contactlistname[]" value="' + comvalueId + '" />');
            $('#contactdivIdbtn').append('<a href="javasript:void(0)" id="txt' + comvalue + '" class="btn  btn-default" onclick="hideelementx(' + "'" + comvalue + "'" + ')" style="float:right;"><i class="fas fa-minus"></i></a>');
        }
        function AddDiscussionEdit(name) {
            //$('#txt' + name).remove();
            //$('#hdn' + name).remove();
            //$('#' + name).remove();
            var comvalue = name;
            var comvalueId = name;
            if ($('#discussion').val() != "") {
                if (document.getElementById(comvalueId) == null) {
                    $('#discussiondivId').append('<input class="form-control" style="margin-bottom:10px;" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
                    $('#discussiondivId').append('<input  type="hidden" style="margin-bottom:10px;" id="hdn' + comvalue + '" name="discussionlist[]" value="' + comvalueId + '" />');
                    $('#discussiondivIdbtn').append('<a href="javasript:void(0)"  id="txt' + comvalue + '" class="btn  btn-default" onclick="hideelementx(' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px"><i class="fas fa-minus"></i></a>');
                }
                else {
                    swal('Attention', 'This record already exists', 'warning');
                    return false;
                }
            }
            $('#discussion').val("");
        }
        function AddDiscussion() {
            var comvalue = $('#discussion').val();
            var comvalueId = $('#discussion').val();
            if ($('#discussion').val() != "") {
                if (document.getElementById(comvalueId) == null) {
                    $('#discussiondivId').append('<input class="form-control" style="margin-bottom:10px;" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
                    $('#discussiondivId').append('<input  type="hidden" style="margin-bottom:10px;" id="hdn' + comvalue + '" name="discussionlist[]" value="' + comvalueId + '" />');
                    $('#discussiondivIdbtn').append('<a href="javasript:void(0)"  id="txt' + comvalue + '" class="btn  btn-default" onclick="hideelementx(' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px"><i class="fas fa-minus"></i></a>');
                }
                else {
                    swal('Attention', 'This record already exists', 'warning');
                    return false;
                }
            }
            $('#discussion').val("");
        }
        function AddDiscussionEdit(Name) {
            var comvalue = Name;
            var comvalueId = Name;

            $('#discussiondivId').append('<input class="form-control" style="margin-bottom:10px;" type="text" id="' + comvalueId + '" name="' + comvalue + '" readonly value="' + comvalue + '" />');
            $('#discussiondivId').append('<input type="hidden" style="margin-bottom:10px;" id="hdn' + comvalue + '" name="discussionlist[]" value="' + comvalueId + '" />');
            $('#discussiondivIdbtn').append('<a href="javasript:void(0)" id="txt' + comvalue + '" class="btn  btn-default" onclick="hideelementx(' + "'" + comvalue + "'" + ')" style="float:right;margin-bottom:2px"><i class="fas fa-minus"></i></a>');
        }


        function hideelementx(name) {

            $('#txt' + name).remove();
            $('#hdn' + name).remove();
            $('#' + name).remove();


        }
        function hideelementxt(comvalueId, name) {
            $('#txt' + comvalueId).remove();
            $('#hdn' + comvalueId).remove();
            $('#' + comvalueId).remove();


        }
        function ajaxGetLeadsByLeadOwner(response) {
            var GetLeadList = [];
            $.each(response, function (id, option) {
                var obj = new Object();
                obj.key = option.id;
                obj.value = option.leadName;
                GetLeadList[GetLeadList.length] = obj;
            });
            //console.log(GetLeadList);
            $('#LeadName').autocomplete({
                source: GetLeadList,
                select: function (event, ui) {
                    $("#LeadName").val(ui.item.value);
                    $("#leadsID").val(ui.item.key);
                }
            });
        }
    </script>
}







