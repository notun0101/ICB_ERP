@model TrainingEnrollViewModel
@{
	ViewData["Title"] = "Add Perticipants";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Style{
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<style>
		.redStar {
			color: red;
		}
	</style>
}

<div class="card" style="width: 100%;">
	<div class="card-header row outBox" style="background-color: #EAF6FA;padding: 0; color: black;">
		<div class="col-md-4" style="display: flex; justify-content: flex-start; align-items: center;">
			<h5 class="card-title" style="color: black; margin: 8px;">Training Information</h5>
		</div>
		<div class="col-md-8">

			<div style="float: right; margin: 16px;">
				<a class='btn btn-info' style="" data-toggle='tooltip' title='Go Back' href='/HRPMSTrainingNew/TrainingImplementation/ForeignTrainingList'><i class="fas fa-angle-double-left"> <span style="">Back</span></i></a>
			</div>
		</div>
	</div>
	<div class="card-body">

		<div class="container">
			<form asp-area="HRPMSTrainingNew" asp-controller="TrainingImplementation" asp-action="Enroll" id="FormId" method="post" data-parsley-validate="parsley">
				<div asp-validation-summary="All" class="text-danger"></div>

				<div class="" style="">
					<div class="form-group row">
						<label for="course" class="col-sm-2 col-form-label">@Model.fLang.course</label>

						<div class="col-sm-4">
							<input type="text" class="form-control" name="course" id="course" value="@Model.trainingInfoNew?.course" readonly>
							<input type="hidden" name="id" id="id" value="@Model.trainingInfoNew?.Id">
						</div>

						<label for="participant" class="col-sm-2 col-form-label">No of perticipants</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" name="participant" id="participant" value="@Model.trainingInfoNew?.noOfParticipants" readonly>
						</div>
					</div>

					<div class="form-group row d-none">
						<label for="courseObjective" class="col-sm-2 col-form-label">@Model.fLang.courseObjective</label>
						<div class="col-sm-4">
							<input type="text" value="@Model.trainingInfoNew?.courseObjective" class="form-control" name="courseObjective" id="courseObjective" readonly>
						</div>

						<label for="amount" class="col-sm-2 col-form-label">@Model.fLang.amount</label>
						<div class="col-sm-4">
							<input type="text" value="@Model.trainingInfoNew?.amount" class="form-control" name="amount" id="amount" readonly>
						</div>
					</div>

					<div class="form-group row">
						<label for="planeStartDate" class="col-sm-2 col-form-label">Start Date</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" name="planeStartDate" id="planeStartDate" value="@Model.trainingInfoNew?.startDate?.ToString("dd-MMM-yy")" readonly>
						</div>

						<label for="type" class="col-sm-2 col-form-label">End Date</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" name="planeEndDate" id="planeEndDate" value="@Model.trainingInfoNew?.endDate?.ToString("dd-MMM-yy")" readonly>
						</div>
					</div>

					<div class="form-group row">
						@*<label for="year" class="col-sm-2 col-form-label">@Model.fLang.year</label>
							<div class="col-sm-4">
								<input type="text" class="form-control" name="year" id="year" value="@Model.trainingInfoNew.year" readonly>
							</div>*@


					</div>

					@*<div class="form-group row">
						<label for="HR" class="col-sm-2 col-form-label">@Model.fLang.budget</label>
						<div class="col-sm-4">
							<input class="form-control" name="HR" id="HR" value="@Model.trainingInfoNew.budget" readonly>
						</div>
					</div>*@
				</div>

				<br />


				<div class="" style="">
					<div class="card-header row outBox" style="background-color: #EAF6FA;padding: 0; color: black;">
						<div class="col-md-12" style="display: flex; justify-content: flex-start; align-items: center;">
							<h5 class="card-title" style="color: black; margin: 8px;">Add Participant</h5>
						</div>
						@*<div class="col-md-8">


							</div>*@
					</div>
					<br />
					<div class="row">

						<div class="col-12">
							<div class="form-group row" id="hdnEmpidArea">
								<label for="employeeCode" class="col-sm-2 col-form-label">@Model.fLang.employeeId</label>
								<div class="col-sm-10">
									<input type="text" class="form-control" placeholder="Search" id="employeeCode" name="employeeCode">
									<input type="hidden" id="employeeId" name="employeeId" value="0" />
								</div>
							</div>
						</div>

						<div class="col-6">
							<div class="form-group row">
								<label for="employeeName" class="col-sm-4 col-form-label">@Model.fLang.employeeName <span style="float:right;" class="redStar">*</span></label>
								<div class="col-sm-8">
									<input type="text" readonly class="form-control" name="employeeName" id="employeeName" data-parsley-required="true" data-parsley-trigger="keyup">
								</div>
							</div>
						</div>

						<div class="col-6">
							<div class="form-group row">
								<label for="designation" class="col-sm-4 col-form-label">Designation <span style="float:right;" class="redStar">*</span></label>
								<div class="col-sm-8">
									<input type="text" readonly class="form-control" name="designation" id="designation" data-parsley-required="true" data-parsley-trigger="keyup">
								</div>
							</div>
						</div>

						@*<div class="col-6">
								<div class="form-group row">
									<label for="organization" class="col-sm-4 col-form-label">@Model.fLang.organization <span style="float:right;" class="redStar">*</span></label>
									<div class="col-sm-8">
										<input type="text" class="form-control" name="organization" id="organization" data-parsley-required="true" data-parsley-trigger="keyup">
									</div>
								</div>
							</div>*@

						<div class="col-6">
							<div class="form-group row">
								<label for="mobile" class="col-sm-4 col-form-label">@Model.fLang.mobile <span style="float:right;" class="redStar">*</span></label>
								<div class="col-sm-8">
									<input type="text" class="form-control" name="mobile" id="mobile" data-parsley-required="true" data-parsley-trigger="keyup">
								</div>
							</div>
						</div>

						<div class="col-6">
							<div class="form-group row">
								<label for="email" class="col-sm-4 col-form-label">@Model.fLang.email <span style="float:right;" class="redStar">*</span></label>
								<div class="col-sm-8">
									<input type="text" class="form-control" name="email" id="email" data-parsley-required="true" data-parsley-trigger="keyup">
								</div>
							</div>
						</div>

						<div class="col-12">
							<div class="form-group row">
								<label for="address" class="col-sm-2 col-form-label">@Model.fLang.address</label>
								<div class="col-sm-10">
									<input type="text" class="form-control" name="address" id="address">
								</div>
							</div>
						</div>

					</div>

				</div>


				<hr>
				@*<button type="submit" id="submit" value="Submit" class="btn btn-success btn-lg" style="float:right; margin-top:5px;"><i class="fas fa-save"></i></button>*@

				<button type="submit" id="submitbtn" value="Submit" class="btn btn-success" style="float:right; margin-top:5px;display:none;"><i class="fas fa-save"></i> Save</button>
				<button type="button" id="submit" value="Submit" class="btn btn-success" style="float:right; margin-top:5px;"><i class="fas fa-save"></i> Save</button>

			</form>
		</div>
	</div>
</div>

<hr />

<div class="row clearfix">
	<div class="col-12">
		<div class="card mb-4">
			<!-- Card Header - Dropdown -->
			<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
				<h6 class="m-0 font-weight-bold text-primary">Participants</h6>
			</div>
			<!-- Card Body -->
			<div class="card-body">
				<table class="table table-striped table-bordered" id="trainingEnrollTable">
					<thead>
						<tr>
							<th>SL</th>
							<th>@Model.fLang.employeeName</th>
							<th>Designation</th>
							<th>Posting</th>
							@*<th>@Model.fLang.organization</th>*@
							<th>@Model.fLang.mobile</th>
							<th>@Model.fLang.address</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						@{ 
							var index = 1;
						}
						@foreach (var data in Model.enrolledTraineees)
						{
							
						<tr id="rowID_@data.mobile">
							<td style="text-align:center;">@index</td> 
							<td class="clsStatus">@data.name</td>
							<td>@data.designation</td>
							<td>@data.posting</td>
							@*<td>@data.workingPlace</td>*@
							<td>@data.mobile</td>
							<td>@data.address</td>
                            <td>
                                <a class='btn btn-info ml-1' title='Print' target="_blank" href="/HRPMSTrainingNew/TrainingImplementation/TrainingLetterformatPdf?trainingId=@Model.trainingInfoNew?.Id&participantId=@data.traineeId"><i class='fa fa-print'></i></a>
                                <a class='btn btn-success ml-1' title='Send' target="_blank" href="/HRPMSTrainingNew/TrainingImplementation/TrainingLetterformatMail?trainingId=@Model.trainingInfoNew?.Id&participantId=@data.traineeId"><i class='fa fa-mail-bulk'></i></a>
                            </td>
						</tr>
							index++; 
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

@section Scripts{
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="~/lib/jquery/dist/notify.js"></script>
	<script>
        var GetEmployeeList = [];
        @*$('#submit').click(function () {
		        console.log($('#FormId').serializeArray());
		        var data = $('#FormId').serializeArray();

		        console.log(data[0].value)
		        swal({
			        title: 'Are you sure?', text: 'Do you want to submit this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, submit it!'
		        }).then(function () {
			        $.ajax({
				        url: '@Url.Action("Enroll", "TrainingImplementation")',
				        type: 'POST',
				        data: data
			        }).done(function () {
                        if (data[0].value == 0) {
                            swal('success', 'Saved Successfully!', 'success').then(function () {
                                location.reload();
                            });
                        }
                        else {
                            swal('success', 'Updated Successfully!', 'success').then(function () {
                                location.reload();
                            });;
                        }
			        }).fail(function () {
				        swal('warning', 'Failed!', 'warning');
			        })
		        });
        })*@
        $(document).ready(function () {
            $('#employeeCode').autocomplete({
                source: GetEmployeeList,

                select: function (event, ui) {
                    console.log(ui)
                    $("#employeeName").val(ui.item?.name);
                    $("#employeeId").val(ui.item.key);
                    $("#designation").val(ui.item?.designation);
                    $("#organization").val(ui.item?.orgType);
                    $("#nid").val(ui.item?.nationalID);
                    $("#mobile").val(ui.item?.mobile);
                    $("#email").val(ui.item?.email);
                }
            });
			$("#submit").click(function () {
				var mobile = $("#mobile").val();
				//console.log(mobile);
				if ($('table#trainingEnrollTable').find('#rowID_' + mobile).length > 0) {
					swal('', 'already exists this Person!', 'error');
					return false;
				}

                var indexx = $('.clsStatus').length;
                var limit = $("#participant").val();
                if (indexx >= limit) {
                    swal('', 'limit exceeded!', 'warning');
                    return false;
				}
				
                console.log(indexx);
				if (isValidForm()) {
					$("#submitbtn").click();
					//swal({
					//	title: 'Are you sure?', text: 'Do you want to submit this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, submit it!'
					//}).then(function () {
					//	$("#submitbtn").click();
					//});
				};
			});

			function isValidForm() {
				var isValid = false;

				 if ($("#Designation").val() == '') {
					$.notify("error:Designation Required", "error");
				}
				else if ($("#employeeName").val() == '') {
					$.notify("error: Employee Name Required", "error");
				}
				else if ($("#mobile").val() == '') {
					$.notify("error: Mobile Number Required", "error");
				 }
				 else if ($("#email").val() == '') {
					 $.notify("error: Email Required", "error");
				 }
				else {
					isValid = true;
				}
				return isValid;
			}


            $("#enroll").addClass("active");
            $('#trainingEnrollTable').DataTable({
                stateSave: false,
                dom: "<'row'<'col-sm-12 col-md-2'l><'col-sm-12 col-md-3'B><'col-sm-12 col-md-7'f>>" +
                    "<'row'<'col-sm-12't>>" +
                    "<'row'<'col-sm-12 col-md-6'i><'col-sm-12 col-md-6'pr>>",
                buttons: [
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fa fa-file-excel"></i> Excel',
                        titleAttr: 'Excel',
                        exportOptions: {
                            columns: [0, 1, 2, 3]
                        },
                        title: "ERP-HRPMS",
                        messageTop: 'List Of Training Participants',
                        class: 'btn btn-info'
                    },
                    //{
                    //    extend: 'csvHtml5',
                    //    text: '<i class="fa fa-file-excel"></i> CSV',
                    //    titleAttr: 'CSV',
                    //    exportOptions: {
                    //        columns: [0, 1, 2, 3]
                    //    },
                    //    title: "ERP-HRPMS",
                    //    messageTop: 'List Of Employee Training'
                    //},
                    {
                        extend: 'print',
                        text: '<i class="fa fa-print"></i> Print',
                        titleAttr: 'Print',
                        title: "ERP-HRPMS",
                        messageTop: 'List Of Training Participants',
                        exportOptions: {
                            columns: [0, 1, 2, 3]
                        },
                        customize: function (doc) {
                            $(doc.document.body).find('h1').css('font-size', '20pt');
                            $(doc.document.body).find('h1').css('font-family', "'Times New Roman', Times, serif");
                            $(doc.document.body).find('h1').css('text-align', 'center');
                        }
                    }
                ]
            });

            $('#startDateActual').datepicker({ uiLibrary: 'bootstrap4' });
            $('#endDateActual').datepicker({ uiLibrary: 'bootstrap4' });
            $("input[name='trainerType']").change(function () {
                TrainerType();
            });

            Common.Ajax('GET', '/global/api/getEmployeeInfoByOrg/', [], 'json', ajaxEmployeeList, false);


        });

        function ajaxEmployeeList(response) {
            //console.log(response);

            $.each(response, function (id, option) {
                if (option.employeeCode == 'e56789') {
                    console.log(option);

                }

                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.employeeCode + ' - ' + option.nameEnglish;
                obj.name = option.nameEnglish;
                obj.designation = option.lastDesignation ?.designationName;
                obj.orgType = option.orgType;
                obj.nationalID = option.nationalID;
                obj.mobile = option.mobileNumberPersonal;
                obj.email = option.emailAddress;
                GetEmployeeList[GetEmployeeList.length] = obj;
            });

        }

        function TrainerType() {
            var radioValue = $("input[name='trainerType']:checked").val();
            if (radioValue == 'Internal') {
                $("#hdnEmpidArea").show();
                $('#designation').attr('readonly', true);
                $('#employeeName').attr('readonly', true);
                $('#organization').attr('readonly', true);
                $('#nid').attr('readonly', true);
                $('#address').attr('readonly', false);
            }
            else if (radioValue == 'External') {
                $("#hdnEmpidArea").hide();
                $('#designation').attr('readonly', false);
                $('#employeeName').attr('readonly', false);
                $('#organization').attr('readonly', false);
                $('#nid').attr('readonly', false);
                $('#address').attr('readonly', false);

            }
        }
       
	</script>
}

