@model ProjectLocationViewModel
@{
    ViewData["Title"] = "ProjectActivityByLocation";
}

<section>
    <br />
    <form id="myForm">
        <div class="card">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h5 class="font-weight-bold" style="color:black">Create Activity By Loaction</h5>
                <a class="btn btn-info" href="~/SCMMasterData/Project/ProjectActivityByLocationList">Back To List</a>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <div class="form-group row">
                            <label class="col-form-label col-md-4">Project</label>
                            <div class="col-md-8">
                                <select class="form-control" name="projectId" id="projectId" data-parsley-required="true">
                                    <option value="">Select</option>
                                    @foreach (var data in Model.projects)
                                    {
                                        <option value="@data.Id">@data.projectName</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <div class="form-group row">
                            <label class="col-form-label col-md-4">Reporting User</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control" name="userName" id="userName">
                                <input type="hidden" id="applicationUserId" name="applicationUserId" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <div class="form-group row">
                            <label class="col-form-label col-md-4">Remarks</label>
                            <div class="col-md-8">
                                <input type="text" name="remarks" id="remarks" class="form-control" />
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12">

                    </div>
                </div>
            </div>
        </div>
        <br />
        <div class="card">
            <div class="card-header">
                <h5 class="font-weight-bold" style="color: black;">Details Information</h5>
            </div>

            <div class="card-body">
                <div class="row">

                    <table id="tblProject" class="table table-bordered">
                        <thead>
                            <tr>
                                <td colspan="2" style="text-align:center;">Location</td>
                            </tr>
                            <tr>
                                <th>Level <button type="button" onclick="AddInitialNode()" style="font-weight:bold;font-size:20px;">&nbsp;+</button></th>
                                <th>Grid <button type="button" onclick="AddFirstNode()" style="font-weight:bold;font-size:20px;">&nbsp;+</button></th>
                                <th>Activities <button type="button" onclick="AddSecondNode()" style="font-weight:bold;font-size:20px;">&nbsp;+</button></th>
                                <th>Unit</th>
                                <th>QTY</th>
                                <th>Item <button type="button" onclick="AddThirdNode()" style="font-weight:bold;font-size:20px;">+</button></th>
                                <th>Unit</th>
                                <th>QTY</th>
                                <th>Action</th>
                            </tr>
                        </thead>

                        <tbody>

                            <tr id="tr_id_1">
                                <td style="padding-left:0px;padding-right:0px;vertical-align:middle;" id="initial_node_first_child_1">
                                    <input name="levelLocation" style="width:96%" />
                                </td>
                                <td style="padding-left:0px;padding-right:0px;vertical-align:middle;" id="initial_first_node_first_child_1">
                                    <input name="location" style="width:96%" />
                                    <input type="hidden" name="projectLocationId" value="0" style="width:96%" />
                                    <input type="hidden" id="levelIndexForGrid_id_1" name="levelIndexForGrid" value="0" />
                                </td>
                                <td style="padding-left:0px;padding-right:0px;vertical-align:middle;" id="initial_first_node_of_second_node_first_child_1">
                                    <select name="activity" id="activity">
                                        <option value="">Select</option>
                                        @foreach (var data in Model.workProgressActivityTypes)
                                        {
                                            <option value="@data.Id">@data.activityName</option>
                                        }
                                    </select>
                                </td>
                                <td style="padding-left:0px;padding-right:0px;vertical-align:middle;" id="initial_first_node_of_second_node_second_child_1">
                                    <input id="activityUnit_1" style="width:96%" />
                                    <input type="hidden" name="activityUnit" id="activityUnit_id_1" style="width:96%" />
                                </td>
                                <td style="padding-left:0px;padding-right:0px;vertical-align:middle;" id="initial_first_node_of_second_node_third_child_1"><input name="activityQty" style="width:96%" /></td>
                                <td style="padding-left:0px;padding-right:0px;" class="common_item_cls_1">
                                    <input type="text" id="itemspecification_1" style="width:96%">
                                    <input type="hidden" id="itemSpecification_id_1" name="item" />
                                    <input type="hidden" id="locationIndexForActivity_id_1" name="locationIndexForActivity" value="0" />
                                </td>
                                <td style="padding-left:0px;padding-right:0px;">
                                    <input id="itemUnit_1" style="width:96%" />
                                    <input type="hidden" name="itemUnit" id="itemUnit_id_1" style="width:96%" />
                                </td>
                                <td style="padding-left:0px;padding-right:0px;">
                                    <input name="itemQty" style="width:96%" />
                                    <input type="hidden" id="locationIndexForItem_id_1" name="locationIndexForItem" value="0" />
                                    <input type="hidden" id="activityIndexForItem_id_1" name="activityIndexForItem" value="0" />
                                </td>
                                <td style="padding-left:0px;padding-right:0px;"></td>
                            </tr>

                        </tbody>

                    </table>
                </div>

            </div>
            <div class="card-footer">
                <button type="button" onclick="formSubmitFun()" class="btn btn-success btn-lg float-right">Submit</button><br />
            </div>
        </div>

        <div style="height:350px;"></div>
    </form>
</section>

@section Scripts
    {

    <script type="text/javascript">

        var allActivity = @Html.Raw(Json.Serialize(Model.workProgressActivityTypes));
        $(document).ready(function () {

            //Common.Ajax('GET', '/global/api/GetAllItemSpecification/', [], 'json', GetItemSpecificationList, 1);
            GetItemSpecificationListApiCall(1);
            Common.Ajax('GET', '/global/api/getUserInfoList/', [], 'json', GetAllUserList);
            GetUnitListApiCall(1);
            GetUnitListForItemsApiCall(1);

        });

        function GetItemSpecificationListApiCall(i) {

            $.ajax({
                url: "/global/api/GetAllItemSpecification",
                type: "get",
                success: function (res) {
                    //console.log(res);
                    GetItemSpecificationList(res, i)
                }
            })
        }

        function GetItemSpecificationList(response, i) {
            //console.log(i);
            var lstPOP = [];
            // console.log(response);
            $.each(response, function (i, option) {
                //  alert(option.itemName);
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.specificationName;
                lstPOP[lstPOP.length] = obj;
            });
            $('#itemspecification_' + i).autocomplete({
                source: lstPOP,
                select: function (event, ui) {

                    $("#itemspecification_" + i).val(ui.item.value);
                    $("#itemSpecification_id_" + i).val(ui.item.key);

                }
            });
            return false;
        }

        // units for activity

        function GetUnitListApiCall(i) {

            $.ajax({
                url: "/global/api/Project/GetAllUnits",
                type: "get",
                success: function (res) {
                    //console.log(res);
                    GetUnitList(res, i)
                }
            })
        }

        function GetUnitList(response, i) {
            //console.log(i);
            var lstPOP = [];
            // console.log(response);
            $.each(response, function (i, option) {
                //  alert(option.itemName);
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.unitName;
                lstPOP[lstPOP.length] = obj;
            });
            $('#activityUnit_' + i).autocomplete({
                source: lstPOP,
                select: function (event, ui) {

                    $("#activityUnit_" + i).val(ui.item.value);
                    $("#activityUnit_id_" + i).val(ui.item.key);

                }
            });
            return false;
        }

        // end

        // units for items

        function GetUnitListForItemsApiCall(i) {

            $.ajax({
                url: "/global/api/Project/GetAllUnits",
                type: "get",
                success: function (res) {
                    //console.log(res);
                    GetUnitListForItems(res, i)
                }
            })
        }

        function GetUnitListForItems(response, i) {
            //console.log(i);
            var lstPOP = [];
            // console.log(response);
            $.each(response, function (i, option) {
                //  alert(option.itemName);
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.unitName;
                lstPOP[lstPOP.length] = obj;
            });
            $('#itemUnit_' + i).autocomplete({
                source: lstPOP,
                select: function (event, ui) {

                    $("#itemUnit_" + i).val(ui.item.value);
                    $("#itemUnit_id_" + i).val(ui.item.key);

                }
            });
            return false;
        }

        // end

        function GetAllUserList(response) {
            var lstUser = [];
            //console.log(response);
            $.each(response, function (i, option) {
                //  alert(option.itemName);
                var obj = new Object();
                obj.key = option.aspnetId;
                obj.value = option.EmpName;
                lstUser[lstUser.length] = obj;
            });
            $('#userName').autocomplete({
                source: lstUser,
                select: function (event, ui) {

                    $("#userName").val(ui.item.value);
                    $("#applicationUserId").val(ui.item.key);

                }
            });

        }

        function formSubmitFun() {
            var projectId = $('#projectId').val();
            var userId = $('#applicationUserId').val();

            var data = $("#myForm").serialize();
            swal({
                title: 'Are you sure?', text: 'Save this!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, Save it!'
            }).then(function () {
                $.ajax({
                    url: "/SCMMasterData/Project/ProjectActivityByLocation",
                    type: "post",
                    data: data,
                    success: function (res) {
                        swal("Success", "Saved Successfully !!", "success");
                        window.location.href = "/SCMMasterData/Project/ProjectActivityByLocationList";
                    }
                })
            });
        }

        var initialNodeIndex = 1;
        var firstNodeIndex = 1;
        var secondNodeIndex = 1;
        var thirdNodeIndex = 1;
        var initialRowSpan = 2;
        var rowSpan = 2;
        var rowSpan_01 = 2;
        var rowSpan_02 = 2;
        var lastClick = 0;
        var lastClick_02 = 0;
        var newClick = 0;

        var commonCls = 1;
        var commonActivity = 1;
        var commonItem = 0;
        var levelVal = 0;
        var locationVal = 0;
        var activityVal = 0;
        var lastClickCheckedForIndex = 1;

        function AddInitialNode() {

            initialNodeIndex = parseInt(initialNodeIndex) + 1;

            initialRowSpan = 2;
            //rowSpan_02 = 2;
            lastClick = 0;
            lastClick_02 = 0;
            commonItem = commonItem + 1;
            levelVal = levelVal + 1;
            locationVal = locationVal + 1;
            activityVal = activityVal + 1;
            lastClickCheckedForIndex = 0;
            //alert("common item " + commonItem);
            //console.log("method first : " + firstNodeIndex + ' _ ' + secondNodeIndex + ' _ ' + thirdNodeIndex + ' _row span_1 = ' + rowSpan + ' _row span_2 = ' + rowSpan_02);
            $('#tblProject > tbody:last-child').append('<tr class="common_cls_row_' + commonCls + '" id="tr_id_' + initialNodeIndex + '">' +
                '<td style="padding-left:0px;padding-right:0px;" id="initial_node_first_child_' + initialNodeIndex + '"><input  name="levelLocation" style="width:96%" /></td > ' +
                '<td style="padding-left:0px;padding-right:0px;" id="initial_first_node_first_child_' + initialNodeIndex + '"><input  name="location" style="width:96%" /><input type="hidden" id="levelIndexForGrid_id_' + initialNodeIndex + '" name="levelIndexForGrid" value="' + levelVal+'" /></td > ' +
                '<td style="padding-left:0px;padding-right:0px;" id="initial_first_node_of_second_node_first_child_' + initialNodeIndex + '"><select name="activity" id="activity_00' + initialNodeIndex + '" style="width:96%"> </select></td >' +
                '<td style="padding-left:0px;padding-right:0px;" id="initial_first_node_of_second_node_second_child_' + initialNodeIndex + '">' +
                '<input id="activityUnit_00' + initialNodeIndex + '" style="width:96%" />' +
                '<input type="hidden" name="activityUnit" id="activityUnit_id_00' + initialNodeIndex + '" style="width:96%" />' +
                '</td>' +
                '<td style="padding-left:0px;padding-right:0px;" id="initial_first_node_of_second_node_third_child_' + initialNodeIndex + '"><input name="activityQty" style="width:96%" /></td>' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + ' common_item_cls_' + commonItem + '" id="initial_first_node_of_third_node_first_child_' + initialNodeIndex + '">' +
                '<input type = "text" id = "itemspecification_00' + initialNodeIndex + '" style = "width:96%" ></td > ' +
                '<input type="hidden" id="itemSpecification_id_00' + initialNodeIndex + '" name="item" />' +
                '<input type="hidden" id="locationIndexForActivity_id_00' + initialNodeIndex + '" name="locationIndexForActivity" value="' + locationVal + '"/>' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + '" id="first_node_of_third_node_second_child_' + initialNodeIndex + '">' +
                '<input id="itemUnit_00' + initialNodeIndex + '" style="width:96%" />' +
                '<input type="hidden" name="itemUnit" id="itemUnit_id_00' + initialNodeIndex + '" style="width:96%" />' +
                '</td > ' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + '" id="first_node_of_third_node_third_child_' + initialNodeIndex + '"><input  name="itemQty" style="width:96%" />' +
                '<input type="hidden" id="locationIndexForItem_id_00' + initialNodeIndex + '" name="locationIndexForItem" value="' + locationVal + '"/>' +
                ' <input type="hidden" id="activityIndexForItem_id_00' + initialNodeIndex + '" name="activityIndexForItem" value="' + activityVal + '"/>' +
                '</td > ' +
                '<td style=""><button type="button" class="btn btn-danger" onclick="initialDeleteFun(' + initialNodeIndex + "," + commonCls + ')"  style="font-weight:bold;font-size:20px;"><i class="fas fa-trash-alt"></i></button></td></tr>');

            $("#activity_00" + initialNodeIndex).append('<option value="">Select</option>');
            $.each(allActivity, function (i, e) {

                $("#activity_00" + initialNodeIndex).append('<option value="' + e.Id + '">' + e.activityName + '</option>')
            });

            GetItemSpecificationListApiCall('00'+initialNodeIndex);
            GetUnitListApiCall('00'+initialNodeIndex);
            GetUnitListForItemsApiCall('00'+initialNodeIndex);
            commonCls = commonCls + 1;
            commonActivity = commonActivity + 1;

            //console.log(lastClick);
            //console.log("===========END============")
        }

        function AddFirstNode() {

            firstNodeIndex = parseInt(firstNodeIndex) + 1;

            rowSpan = 2;
            rowSpan_01 = 2;
            //rowSpan_02 = 2;
            lastClick = 1;
            lastClick_02 = 1;
            commonItem = commonItem + 1;
            levelVal = levelVal + 1;
            locationVal = locationVal + 1;
            activityVal = activityVal + 1;
            lastClickCheckedForIndex = 1;
            //alert("common item " + commonItem);
            //console.log("method first : " + firstNodeIndex + ' _ ' + secondNodeIndex + ' _ ' + thirdNodeIndex + ' _row span_1 = ' + rowSpan + ' _row span_2 = ' + rowSpan_02);
            $('#tblProject > tbody:last-child').append('<tr class="common_cls_row_' + commonCls + '" id="tr_id_' + initialNodeIndex + '_' + firstNodeIndex + '">' +
                '<td style="padding-left:0px;padding-right:0px;" id="first_node_first_child_' + firstNodeIndex + '"><input  name="location" style="width:96%" /><input type="hidden" id="levelIndexForGrid_id_' + initialNodeIndex + '" name="levelIndexForGrid" value="' + levelVal +'" /></td > ' +
                '<td style="padding-left:0px;padding-right:0px;" id="first_node_of_second_node_first_child_' + firstNodeIndex + '"><select name="activity" id="activity_' + firstNodeIndex +'" style="width:96%"> </select></td >' +
                '<td style="padding-left:0px;padding-right:0px;" id="first_node_of_second_node_second_child_' + firstNodeIndex + '">' +
                '<input id="activityUnit_' + firstNodeIndex + '" style="width:96%" />' +
                '<input type="hidden" name="activityUnit" id="activityUnit_id_' + firstNodeIndex + '" style="width:96%" />' +
                '</td>' +
                '<td style="padding-left:0px;padding-right:0px;" id="first_node_of_second_node_third_child_' + firstNodeIndex + '"><input name="activityQty" style="width:96%" /></td>' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + ' common_item_cls_' + commonItem + '" id="first_node_of_third_node_first_child_' + firstNodeIndex + '">'+
                '<input type = "text" id = "itemspecification_' + firstNodeIndex + '" style = "width:96%" ></td > ' +
                '<input type="hidden" id="itemSpecification_id_' + firstNodeIndex + '" name="item" />' +
                '<input type="hidden" id="locationIndexForActivity_id_' + firstNodeIndex + '" name="locationIndexForActivity" value="' + locationVal + '"/>' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + '" id="first_node_of_third_node_second_child_' + firstNodeIndex + '">' +
                '<input id="itemUnit_' + firstNodeIndex + '" style="width:96%" />' +
                '<input type="hidden" name="itemUnit" id="itemUnit_id_' + firstNodeIndex + '" style="width:96%" />' +
                '</td > ' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + '" id="first_node_of_third_node_third_child_' + firstNodeIndex + '"><input  name="itemQty" style="width:96%" />' +
                '<input type="hidden" id="locationIndexForItem_id_' + firstNodeIndex + '" name="locationIndexForItem" value="' + locationVal + '"/>' +
                ' <input type="hidden" id="activityIndexForItem_id_' + firstNodeIndex + '" name="activityIndexForItem" value="' + activityVal + '"/>' +
                '</td > ' +
                '<td style=""><button type="button" class="btn btn-danger" onclick="locationDeleteFun(' + firstNodeIndex + "," + commonCls + ')"  style="font-weight:bold;font-size:20px;"><i class="fas fa-trash-alt"></i></button></td></tr>');

            $('#tblProject tbody').find("#initial_node_first_child_" + initialNodeIndex).attr('rowspan', initialRowSpan).css('vertical-align', 'middle').css('text-align', 'center');

            $("#activity_" + firstNodeIndex).append('<option value="">Select</option>');
            $.each(allActivity, function (i, e) {

                $("#activity_" + firstNodeIndex).append('<option value="' + e.Id + '">' + e.activityName +'</option>')
            });

            initialRowSpan++;
            //rowSpan_01++;

            GetItemSpecificationListApiCall(firstNodeIndex);
            GetUnitListApiCall(firstNodeIndex);
            GetUnitListForItemsApiCall(firstNodeIndex);
            commonCls = commonCls + 1;
            commonActivity = commonActivity + 1;

            //console.log(lastClick);
            //console.log("===========END============")
        }

        function AddSecondNode() {

            secondNodeIndex = parseInt(secondNodeIndex) + 1;

            commonItem = commonItem + 1;
            activityVal = activityVal + 1;
            rowSpan_02 = 2;

            //alert("common item " + commonItem);
            //console.log("method second : " + firstNodeIndex + ' _ ' + secondNodeIndex + ' _ ' + thirdNodeIndex + ' _row span_1 = ' + rowSpan + ' _row span_2 = ' + rowSpan_02);
            $('#tblProject > tbody:last-child').append('<tr class="common_cls_row_' + commonCls + ' common_activity_cls_' + commonActivity +'" id="tr_id_' + firstNodeIndex + "_" + secondNodeIndex + '">' +
                '<td style="padding-left:0px;padding-right:0px;" id="second_node_first_child_' + secondNodeIndex + '"><select name="activity" id="activity2_' + secondNodeIndex + '" style="width:96%"></select></td>' +
                '<td style="padding-left:0px;padding-right:0px;" id="second_node_second_child_' + secondNodeIndex + '">' +
                '<input id="activityUnit_2' + secondNodeIndex + '" style="width:96%" />' +
                '<input type="hidden" name="activityUnit" id="activityUnit_id_2' + secondNodeIndex + '" style="width:96%" />' +
                '</td > ' +
                '<td style="padding-left:0px;padding-right:0px;" id="second_node_third_child_' + secondNodeIndex + '"><input name="activityQty" style="width:96%" /></td>' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + ' common_item_cls_' + commonItem + '"><input type="text" id="itemspecification_2' + secondNodeIndex + '" style="width:96%">' +
                '<input type="hidden"  id="itemSpecification_id_2' + secondNodeIndex + '" name="item" />' +
                ' <input type="hidden"  id="locationIndexForActivity_id_2' + secondNodeIndex + '" name="locationIndexForActivity" value="' + locationVal + '"/>' +
                '</td > ' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + '">' +
                '<input id="itemUnit_2' + secondNodeIndex + '" style="width:96%" />' +
                '<input type="hidden" name="itemUnit" id="itemUnit_id_2' + secondNodeIndex + '" style="width:96%" />' +
                '</td>' +
                '<td style="padding-left:0px;padding-right:0px;" class="item_common_item_cls_' + commonItem + '">'+
                '<input name = "itemQty" style = "width:96%" /></td > ' +
                '<input type="hidden" id="locationIndexForItem_id_2' + secondNodeIndex + '" name="locationIndexForItem" value="' + locationVal + '"/>' +
                '<input type="hidden" id="activityIndexForItem_id_2' + secondNodeIndex + '" name="activityIndexForItem" value="' + activityVal + '"/>' +
                '<td style=""><button type="button" class="btn btn-danger" onclick="itemDeleteFun(' + firstNodeIndex + "," + secondNodeIndex + "," + thirdNodeIndex + "," + commonItem + "," + rowSpan + "," + rowSpan_02 + "," + lastClick + ')" style="font-weight:bold;font-size:20px;"><i class="fas fa-trash-alt"></i></button></td>' +
                '</tr>');

            //console.log(lastClick);
            //console.log("===========END============")

            $('#tblProject tbody').find("#initial_node_first_child_" + initialNodeIndex).attr('rowspan', initialRowSpan).css('vertical-align', 'middle').css('text-align', 'center');

            if (lastClick_02 == 1) {
                $('#tblProject tbody').find("#first_node_first_child_" + firstNodeIndex).attr('rowspan', rowSpan_01).css('vertical-align', 'middle').css('text-align', 'center');
                //$('#tblProject tbody').find("#first_node_of_second_node_first_child_" + firstNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                //$('#tblProject tbody').find("#first_node_of_second_node_second_child_" + firstNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                //$('#tblProject tbody').find("#first_node_of_second_node_third_child_" + firstNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            }
            else if (lastClick_02 == 0) {
                $('#tblProject tbody').find("#initial_first_node_first_child_" + initialNodeIndex).attr('rowspan', rowSpan_01).css('vertical-align', 'middle').css('text-align', 'center');
                //$('#tblProject tbody').find("#initial_first_node_of_second_node_first_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                //$('#tblProject tbody').find("#initial_first_node_of_second_node_second_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                //$('#tblProject tbody').find("#initial_first_node_of_second_node_third_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            }
            //else if (lastClick_02 == 2) {
            //    $('#tblProject tbody').find("#initial_first_node_first_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            //    //$('#tblProject tbody').find("#initial_first_node_of_second_node_first_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            //    //$('#tblProject tbody').find("#initial_first_node_of_second_node_second_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            //    //$('#tblProject tbody').find("#initial_first_node_of_second_node_third_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            //}

            rowSpan++;
            rowSpan_01++;
            //rowSpan_02++;
            initialRowSpan++;
            lastClick = 2;

            $("#activity2_" + secondNodeIndex).append('<option value="">Select</option>');
            $.each(allActivity, function (i, e) {

                $("#activity2_" + secondNodeIndex).append('<option value="' + e.Id + '">' + e.activityName + '</option>')
            });

            GetItemSpecificationListApiCall('2' + secondNodeIndex);
            GetUnitListApiCall('2' + secondNodeIndex);
            GetUnitListForItemsApiCall('2' + secondNodeIndex);

        }

        function AddThirdNode() {

            thirdNodeIndex = parseInt(thirdNodeIndex) + 1;
            lastClickCheckedForIndex = 3;
            //console.log("method third : " + firstNodeIndex + ' _ ' + secondNodeIndex + ' _ ' + thirdNodeIndex + ' _row span_1 = ' + rowSpan + ' _row span_2 = ' + rowSpan_02 + ' _last click = ' + lastClick);

            $('#tblProject > tbody:last-child').append('<tr class="common_cls_row_' + commonCls + ' common_item_cls_' + commonItem + '" id="tr_id_' + firstNodeIndex + "_" + secondNodeIndex + "_" + thirdNodeIndex + '">' +
                '<td style="padding-left:0px;padding-right:0px;" >'+
                '<input maxlength = "150" type = "text" id = "itemspecification_3' + thirdNodeIndex + '" style = "width:96%" ></td > ' +
                ' <input type="hidden" id="itemSpecification_id_3' + thirdNodeIndex + '" name="item" />' +
                '<td style="padding-left:0px;padding-right:0px;">' +
                '<input id="itemUnit_3' + thirdNodeIndex + '" style="width:96%" />' +
                '<input type="hidden" name="itemUnit" id="itemUnit_id_3' + thirdNodeIndex + '" style="width:96%" />' +
                '</td > ' +
                '<td style="padding-left:0px;padding-right:0px;"><input name="itemQty" style="width:96%" /></td>' +
                '<input type="hidden" id="locationIndexForItem_id_3' + thirdNodeIndex + '" name="locationIndexForItem" value="' + locationVal + '"/>' +
                '<input type="hidden" id="activityIndexForItem_id_3' + thirdNodeIndex + '" name="activityIndexForItem" value="' + activityVal + '"/>' +
                '<td style=""><button type="button" class="btn btn-danger" onclick="itemDeleteFun(' + firstNodeIndex + "," + secondNodeIndex + "," + thirdNodeIndex + "," + commonItem + "," + rowSpan + "," + rowSpan_02 + "," + lastClick + ')" style="font-weight:bold;font-size:20px;"><i class="fas fa-trash-alt"></i></button></td>' +
                '</tr>');

            //console.log(lastClick);
            //console.log("===========END============")

            $('#tblProject tbody').find("#initial_node_first_child_" + initialNodeIndex).attr('rowspan', initialRowSpan).css('vertical-align', 'middle').css('text-align', 'center');

            if (lastClick == 1) {
                //alert("last one");
                $('#tblProject tbody').find("#first_node_first_child_" + firstNodeIndex).attr('rowspan', rowSpan).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#first_node_of_second_node_first_child_" + firstNodeIndex).attr('rowspan', rowSpan_01).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#first_node_of_second_node_second_child_" + firstNodeIndex).attr('rowspan', rowSpan_01).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#first_node_of_second_node_third_child_" + firstNodeIndex).attr('rowspan', rowSpan_01).css('vertical-align', 'middle').css('text-align', 'center');
            }
            else if (lastClick == 2) {
                //alert('last two');
                $('#tblProject tbody').find("#initial_first_node_first_child_" + initialNodeIndex).attr('rowspan', rowSpan).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#second_node_first_child_" + secondNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#second_node_second_child_" + secondNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#second_node_third_child_" + secondNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            }
            else if (lastClick == 0) {
                $('#tblProject tbody').find("#initial_first_node_first_child_" + initialNodeIndex).attr('rowspan', rowSpan).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#initial_first_node_of_second_node_first_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#initial_first_node_of_second_node_second_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                $('#tblProject tbody').find("#initial_first_node_of_second_node_third_child_" + initialNodeIndex).attr('rowspan', rowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
            }



            rowSpan++;
            rowSpan_02++;
            rowSpan_01++;
            initialRowSpan++;

            $("#activity3_" + thirdNodeIndex).append('<option value="">Select</option>');
            $.each(allActivity, function (i, e) {

                $("#activity3_" + thirdNodeIndex).append('<option value="' + e.Id + '">' + e.activityName + '</option>')
            });

            GetItemSpecificationListApiCall('3' + thirdNodeIndex);
            GetUnitListApiCall('3' + thirdNodeIndex);
            GetUnitListForItemsApiCall('3' + thirdNodeIndex);

        }

        function locationDeleteFun(initialNodeIndex ,firstIndex, commonCls) {
            //console.log(firstIndex + "_" + secondIndex + "_" + thirdIndex);
            swal({
                title: 'Are you sure?', text: 'Do you want Delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, Delete it!'
            }).then(function () {

                if (parseInt(firstIndex) > 0 && parseInt(commonCls) > 0) {
                    $("#tblProject > tbody").find("#tr_id_" + initialNodeIndex + '_' + firstIndex).remove();
                }
                else if (parseInt(firstIndex) > 0 && parseInt(secondIndex) > 0) {
                    $("#tblProject > tbody").find("#tr_id_" + initialNodeIndex + '_' + firstIndex + "_" + secondIndex).remove();
                }
                else if (parseInt(firstIndex) > 0) {
                    $("#tblProject > tbody").find("#tr_id_" + initialNodeIndex + '_' + firstIndex).remove();
                }
            });

        }

        function itemDeleteFun(initialNodeIndex, firstNodeIndex, secondNodeIndex, thirdNodeIndex, commonItem, rowSpan, rowSpan_02, lastClick) {
            //console.log(firstNodeIndex + "_" + secondNodeIndex + "_" + thirdNodeIndex + "_" + commonItem + "_" + rowSpan + "_" + rowSpan_02);

            var countItemLen = 0;

            $.each($(".common_item_cls_" + commonItem), function (i, e) {
                //console.log("========Item Delete Fun ==========" + "\n i = " + i);
                //console.log(e);
                countItemLen = countItemLen + 1;
            })
            //console.log(countItemLen);
            if (countItemLen > 1) {
                var locationCol = $("#first_node_first_child_" + firstNodeIndex).attr('rowspan');
                var newRowSpan = locationCol - 1;
                $('#tblProject tbody').find("#first_node_first_child_" + firstNodeIndex).attr('rowspan', newRowSpan).css('vertical-align', 'middle').css('text-align', 'center');

                if (lastClick == 1) {
                    var activityCol = $("#first_node_of_second_node_first_child_" + firstNodeIndex).attr('rowspan');
                    var newRowSpan_02 = activityCol - 1;
                    $('#tblProject tbody').find("#first_node_of_second_node_first_child_" + firstNodeIndex).attr('rowspan', newRowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                    $('#tblProject tbody').find("#first_node_of_second_node_second_child_" + firstNodeIndex).attr('rowspan', newRowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                    $('#tblProject tbody').find("#first_node_of_second_node_third_child_" + firstNodeIndex).attr('rowspan', newRowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                }
                else if (lastClick == 2) {
                    var activityCol = $("#second_node_first_child_" + secondNodeIndex).attr('rowspan');
                    var newRowSpan_02 = activityCol - 1;
                    $('#tblProject tbody').find("#second_node_first_child_" + secondNodeIndex).attr('rowspan', newRowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                    $('#tblProject tbody').find("#second_node_second_child_" + secondNodeIndex).attr('rowspan', newRowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                    $('#tblProject tbody').find("#second_node_third_child_" + secondNodeIndex).attr('rowspan', newRowSpan_02).css('vertical-align', 'middle').css('text-align', 'center');
                }

                $('#tblProject tbody').find("#tr_id_" + initialNodeIndex + '_' + firstNodeIndex + "_" + secondNodeIndex + "_" + thirdNodeIndex).remove();
            }
            else if (countItemLen == 1) {
                $('#tblProject tbody').find("#tr_id_" + initialNodeIndex + '_' + firstNodeIndex + "_" + secondNodeIndex + "_" + thirdNodeIndex).remove();
                $('#tblProject tbody').find("#tr_id_" + initialNodeIndex + '_' + firstNodeIndex + "_" + secondNodeIndex).remove();
            }


            //swal({
            //    title: 'Are you sure?', text: 'Do you want Delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, Delete it!'
            //}).then(function () {

            //    if (parseInt(firstIndex) > 0 && parseInt(commonCls) > 0) {
            //        $("#tblProject > tbody").find("#tr_id_" + firstIndex).remove();
            //    }
            //    else if (parseInt(firstIndex) > 0 && parseInt(secondIndex) > 0) {
            //        $("#tblProject > tbody").find("#tr_id_" + firstIndex + "_" + secondIndex).remove();
            //    }
            //    else if (parseInt(firstIndex) > 0) {
            //        $("#tblProject > tbody").find("#tr_id_" + firstIndex).remove();
            //    }
            //});

        }

    </script>
}

