@model IOUViewModel
@{
    ViewData["Title"] = "IOU";
}

@section Style{
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote-bs4.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
}

<div class="row clearfix">
    <div class="col-12">
        <div class="card mb-4">
            <form asp-area="SCMIOU" asp-controller="IOU" asp-action="CreateIOU" method="post" enctype="multipart/form-data" data-parsley-validate="parsley">
                <div asp-validation-summary="All" class="text-danger"></div>
                <div class="row">
                    <div class="col-md-6" style="padding-right:5px;">
                        <div style="height:10px;"></div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card">
                                    <div class="card-header" style="padding:6px 0px 5px 3px;">
                                        <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; Requisition Information</label>
                                    </div>
                                    <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                                        <dl class="row" style="color:#5b5959;">
                                            <dt class="col-sm-6">
                                                <span>Subject</span>
                                            </dt>
                                            <dd class="col-sm-6">
                                                <span>: @Model.requisitionMaster.subject</span>
                                                <input type="hidden" id="projectId" name="projectId" value="@Model.requisitionMaster.projectId" />
                                            </dd>
                                            <dt class="col-sm-6">
                                                <span>Requisition No.</span>
                                            </dt>
                                            <dd class="col-sm-6">
                                                <span>: @Model.requisitionMaster.reqNo</span>
                                            </dd>
                                            <dt class="col-sm-6">
                                                <span>Requisition Date</span>
                                            </dt>
                                            <dd class="col-sm-6">
                                                <span>: @Model.requisitionMaster.reqDate?.ToString("dd-MMM-yyyy")</span>
                                            </dd>
                                            <dt class="col-sm-6">
                                                <span>Requisiton By</span>
                                            </dt>
                                            <dd class="col-sm-6">
                                                <span>: @Model.requisitionMaster.reqBy</span>
                                            </dd>
                                            <dt class="col-sm-6">
                                                <span>Assign Date</span>
                                            </dt>
                                            <dd class="col-sm-6">
                                                <span>: @Model.requisitionMaster.assignDate?.ToString("dd-MMM-yyyy")</span>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6" style="padding-left:5px;">
                        <div style="height:10px;"></div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card">
                                    <div class="card-header" style="padding:6px 0px 5px 3px;">
                                        <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-9 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; PR Attachment</label>
                                        <button type="button" onclick="location.href='@Url.Action("Index", "IOU","SCMIOU")'" class="btn btn-info col-sm-2 p-0 m-0">Back To List</button>
                                    </div>
                                    <div class="card-body p-3 m-0" style="max-height:196px;min-height:196px;overflow-x:scroll;">
                                        <table id="dtAttachment" class="table table-striped table-bordered">
                                            <thead style="background-color:#c6c3c3">
                                                <tr>
                                                    <th style="width:30%">File Name</th>
                                                    <th style="width:30%">File</th>
                                                    <th style="width:15%;">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbodyAttachment"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <br />
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-header" style="padding:6px 0px 5px 3px;">
                                <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; Purchase Process Information</label>
                            </div>
                            <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group row">
                                                <label for="processBy" class="col-sm-4 col-form-label">Process By</label>
                                                <div class="col-sm-8">
                                                    <input type="text" class="form-control" id="processBy" name="processBy" readonly />
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label for="expectedDeliveryDate" class="col-sm-4 col-form-label">Expected Delivery Date</label>
                                                <div class="col-sm-8">
                                                    <input type="text" class="form-control" id="expectedDeliveryDate" name="expectedDeliveryDate" readonly />
                                                    <input type="hidden" id="requisitionId" name="requisitionId" value="@ViewBag.reqId" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-6">
                                            <div class="form-group row">
                                                <label for="iouNo" class="col-sm-4 col-form-label">IOU No.</label>
                                                <div class="col-sm-8">
                                                    <input type="text" class="form-control" id="iouNo" name="iouNo" readonly />
                                                </div>
                                            </div>

                                            <div class="form-group row">
                                                <label for="attentionTo" class="col-sm-4 col-form-label">Attention To</label>
                                                <div class="col-sm-8">
                                                    <input type="text" class="form-control" id="attentionTo" name="attentionTo" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>                

                <br />

                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-header" style="padding:6px 0px 5px 3px;">
                                <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; PO Details</label>
                            </div>
                            <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                                <table class="table table-striped table-bordered" id="poDetailsListTable">
                                    <thead>
                                        <tr>
                                            <th>Item Code</th>
                                            <th>Item Name</th>
                                            <th>Item Spec</th>
                                            <th>Unit Name</th>
                                            <th>IOU Qty</th>
                                            <th>Unordered Qty</th>
                                            <th>IOU Unit Rate</th>
                                            <th>Action</th>
                                    </thead>
                                    <tbody>
                                        @foreach (var data in Model.requisitionDetails)
                                        {
                                            <tr>
                                                <td>@data.itemSpecification?.Item?.itemCode</td>
                                                <td>@data.itemSpecification?.Item?.itemName</td>
                                                <td>@data.itemSpecification?.specificationName</td>
                                                <td>@data.itemSpecification?.Item?.unit?.unitName</td>
                                                <td>0</td>
                                                <td>@data.reqQty</td>
                                                <td>@data.reqRate</td>
                                                <td>
                                                    <a class="btn btn-info" href="#" onclick="AddModal(@data.Id, '@data.itemSpecification?.Item?.Id', '@data.itemSpecification?.Item?.itemCode', '@data.itemSpecification?.Item?.itemName', '@data.itemSpecification?.specificationName', '@data.itemSpecification?.Item?.unit?.unitName', '@data.reqQty', '@data.reqRate')"><i class="fa fa-cog"></i></a>
                                                </td>
                                            </tr>
                                        }

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <br />

                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-header" style="padding:6px 0px 5px 3px;">
                                <label style="padding:0px 0px 0px 10px;font-size:16px;font-weight:600" class="col-sm-10 pull-left"><i class="fa fa-th-list fa-sm"></i>&nbsp;&nbsp; PO Item Details</label>
                            </div>
                            <div class="card-body p-3 m-0" style="padding-bottom:0px;">
                                <table class="table table-striped table-bordered" id="poDetailsItemListTable">
                                    <thead>
                                        <tr>
                                            <th>Item Code</th>
                                            <th>Item Name</th>
                                            <th>Unordered Qty</th>
                                            <th>Ordered Qty</th>
                                            <th>Unit Rate</th>
                                            <th>Amt Excl VAT</th>
                                            <th>Total</th>
                                            <th>Action</th>
                                    </thead>
                                    <tbody></tbody>
                                    <tfoot>
                                        <tr>
                                            <th colspan="6" style="text-align:right;">Grand Total</th>
                                            <th style="text-align:right;" id="grandTotal"></th>
                                            <th></th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <br />

                <div class="col-12">
                    <button type="submit" class="btn btn-success" style="float:right">Save</button>
                </div>                
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="ValidatModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="width:1040px;">
            <div class="modal-header">
                <label class="modal-title pull-left" id="myModalLabel" style="color:rgb(9, 7, 161);font-size:1em;">
                    Add IOU Item Details
                </label>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <br />
            </div>
            <div class="modal-body">
                <form data-parsley-validate="parsley">
                    <div class="container">
                        <div class="row">
                            <div class="col-6 row">
                                <label class="col-sm-4 col-form-label">Item Code</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtcode" readonly="readonly" />
                                <input type="hidden" id="HiddenItemId" readonly="readonly" />
                                <input type="hidden" id="HiddencsDetailsId" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Item Name</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtname" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Unit Name</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtunit" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Spacification</label>
                                <input class="col-sm-8 form-control" type="text" id="txtSpec" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Description</label>
                                <textarea class="col-sm-8 form-control" style="margin-bottom: 8px;" id="txtDescription" rows="4"></textarea>

                                <label class="col-sm-4 col-form-label">Delivery Location*</label>
                                <select class="col-sm-8 form-control" style="margin-bottom: 8px;" onchange="OtherLocation()" id="txtLocation" readonly="readonly">
                                    <option value="">Select One</option>
                                    @foreach (var data in Model.deliveryLocations)
                                    {
                                        <option value="@data.Id">@data.locationName</option>
                                    }
                                </select>

                                <label class="col-sm-4 col-form-label txtOtherLocation">Other Location</label>
                                <textarea class="col-sm-8 form-control txtOtherLocation" style="margin-bottom: 8px;" id="txtOtherLocation" rows="4"></textarea>

                                <label class="col-sm-4 col-form-label">Procurement Category</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;" type="text" id="txtProcurementCategory" readonly="readonly" />
                            </div>

                            <div class="col-6 row" style="margin-left: 10px;">

                                <label class="col-sm-4 col-form-label">PR QTY</label>
                                <input class="col-sm-8 form-control" style="margin-bottom: 8px;text-align:right;" type="text" id="txtPRQty" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">Unordered QTY</label>
                                <input class="col-sm-8 form-control" type="text" id="txtUnOrderedQty" readonly="readonly" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label">Ordered QTY</label>
                                <input class="col-sm-8 form-control numeric" type="text" id="txtOrderedQty" style="margin-bottom: 8px;text-align:right;" />
                                <div class="col-sm-12 row">

                                    <label class="col-sm-4 col-form-label">Currency</label>
                                    <select class="col-sm-4 form-control" onchange="addCurrencyRate()" id="currency" readonly="readonly" style="margin-bottom: 8px;margin-left:10px;">
                                        @foreach (var data in Model.currencies)
                                        {
                                            <option value="@data.Id">@data.currencyName</option>
                                        }
                                    </select>
                                    <input type="text" class="form-control col-sm-3" style="text-align:right;margin-left:15px;" id="currencyRate" />
                                </div>
                                <label class="col-sm-4 col-form-label">Unit Rate</label>
                                <input class="col-sm-8 form-control" type="text" id="txtUnitRate" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label">Amt. Excl. VAT</label>
                                <input class="col-sm-8 form-control" type="text" id="txtAmtExVat" readonly="readonly" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label AitrelatedClass">AIT(%)</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control AitrelatedClass" type="text" id="txtAit" />

                                <label class="col-sm-4 col-form-label AitrelatedClass">AIT Amount</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control AitrelatedClass" type="text" id="txtAitAmount" readonly="readonly" />

                                <label class="col-sm-4 col-form-label AitrelatedClass">Amt. Incl. VAT</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control AitrelatedClass" type="text" id="txtAitIncludeAmount" readonly="readonly" />

                                <label class="col-sm-4 col-form-label">VAT(%)</label>
                                <input style="margin-bottom: 8px;text-align:right;" class="col-sm-8 form-control" type="text" id="txtVat" />

                                <label class="col-sm-4 col-form-label">VAT Amount</label>
                                <input class="col-sm-8 form-control" type="text" id="txtVatAmount" readonly="readonly" style="margin-bottom: 8px;text-align:right;" />

                                <label class="col-sm-4 col-form-label">Total Amount</label>
                                <input class="col-sm-8 form-control" type="text" id="txtTotalAmount" readonly="readonly" style="margin-bottom: 8px;text-align:right" />
                            </div>

                            <div class="col-1" style="display:none">
                                <input value="1" type="radio" style="margin-top:100px;" checked id="btnRadio" name="includeAlt" class="form-control" /><span>Incl AIT</span>
                                <br />
                                <input value="2" type="radio" id="btnRadio" name="includeAlt" class="form-control" /><span>Excl AIT</span>
                            </div>
                        </div>
                    </div>
                </form>
                <button class="btn btn-lg btn-success" onclick="AddItemInfo()" style="float:right">Add</button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-arrow-left"></i> Back</button>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.11/summernote-bs4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script type="text/javascript">
        var bdtUnitRate = 0;
        $(document).ready(function () {
            $('#poDetailsListTable').DataTable();
            $('#expectedDeliveryDate').flatpickr({ dateFormat: "d-M-Y", minDate: "@DateTime.Now.ToString("dd/MMM/yyyy")" });

            $('#poDate').val("@DateTime.Now.ToString("dd-MMM-yyyy")");
            $('#deliveryDate').val("@DateTime.Now.ToString("dd-MMM-yyyy")");
            $(".txtOtherLocation").hide();
            $('#summernote').summernote({
                tabsize: 2,
                height: 300
            });

            $("#currency").val(1);
            $('#currencyRate').hide();

            $("#currencyRate").keyup(function () {
                mrate = parseFloat($(this).val());
                if (isNaN(mrate) == true) {
                    mrate = 1;
                }
                var ConvUnitRate = parseFloat(bdtUnitRate) / mrate;
                $('#txtUnitRate').val(ConvUnitRate.toFixed(2));
                OrderQTYKey(parseFloat($("#txtOrderedQty").val()));
                VATKey(parseFloat($("#txtVat").val()));
            });

            $("#txtOrderedQty").keyup(function () {
                var thisOQVal = $(this).val();
                OrderQTYKey(thisOQVal);
            });

            $("#txtUnitRate").keyup(function () {
                var thisOQVal = $("#txtOrderedQty").val();
                OrderQTYKey(thisOQVal);
            });

            $("#txtVat").keyup(function () {
                var thisVVal = $(this).val();
                VATKey(thisVVal);
            });

            $("#txtAit").keyup(function () {
                var thisAIT = $(this).val();
                AITKey(thisAIT);
            });


            $(".AitrelatedClass").hide();

            $("input:radio[name='includeAlt']").change(function () {
                if ($("input[name='includeAlt']:checked").val() == '1') {
                    $(".AitrelatedClass").hide();
                }
                else if ($("input[name='includeAlt']:checked").val() == '2') {
                    $(".AitrelatedClass").show();
                }
            });

            $(".numeric").keydown(function (e) {
                if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                    (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                    (e.keyCode >= 35 && e.keyCode <= 40)) {
                    return;
                }
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });


            LoadAttachment();
            $("#iouNo").val('@ViewBag.IOUNO');
            $("#processBy").val('@ViewBag.EmpName');
            $("#attentionTo").val('@ViewBag.AttentionTo');
        });

        function LoadAttachment() {
            var rowno = 0;
            $.ajax({
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                url: '/SCMRequisition/RequisitionApprove/GetAttachmentListByMatrixType?masterId=' + @ViewBag.reqId,
                data: {},
                dataType: 'json',
                async: true,
                success: function (attachments) {
                    var index = 1;
                    var dtTable = $("#dtAttachment");
                    var tableBody = dtTable.find('tbody');
                    tableBody.empty();
                    $.each(attachments, function (index, E) {
                        rowno = rowno + 1;
                        var filePath = '/Upload/' + E.fileName;
                        $('#SubjectName').val(E.Subject);
                        if (E.FilePath != "") {
                            if (E.MimeType == "application/msword" || E.MimeType == "application/pdf" || E.MimeType == "application/x-msexcel" || E.MimeType == "application/octet-stream" || E.MimeType == "text/plain" || E.MimeType == "application/vnd.openxmlformats-officedocument.wordprocessingml.document" || E.MimeType == "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet") {
                                tableBody.append(
                                    '<tr id=' +
                                    rowno +
                                    '>' +
                                    '<td>' +
                                    E.fileName +
                                    '</td>' +
                                    '<td><i class="fa fa-file" style="font-size:40px;color:lightgray"> </i></td>' +
                                    '<td><a href=' +
                                    "'" +
                                    filePath +
                                    "'" +
                                    '  target="_blank"  title="Preview"  class="btn btn-info btn-sm"><i class="fa fa-eye"></i></a></td>' +
                                    '</tr>');
                            }
                            else {
                                tableBody.append(
                                    '<tr id=' +
                                    rowno +
                                    '>' +
                                    '<td>' +
                                    E.fileName +
                                    '</td>' +
                                    '<td style="height:50px;width: 45px; background - color:lightgray"><img src=' +
                                    "'" +
                                    filePath +
                                    "'" +
                                    ' height=50 width=45 /></td>' +
                                    '<td><a href=' +
                                    "'" +
                                    filePath +
                                    "'" +
                                    '  target="_blank"  title="Preview"  class="btn btn-info btn-sm"><i class="fa fa-eye"></i></a></td>' +
                                    '</tr>');
                            }
                        }
                        index = index + 1;
                    });
                    $('#AjaxLoader').hide();
                },
                error: function (request, status, error) {
                    alert(request.statusText + "/" + request.statusText + "/" + error);
                }
            });
        }

        function refreshSupplierView() {
            $("#department").val("");
            $("#RFQRef").val("");
            $("#supplier").val("");
            $("#contactPerson").val("");
            $("#contactNo").val("");
        }

        function SupplierView(masterId, dept, rfq, requisitionId) {
            refreshSupplierView();
            $("#department").val(dept);
            $("#RFQRef").val(rfq);
            $("#txtCsmasterId").val(masterId);
            $("#txtRequsitionId").val(requisitionId);
            Common.Ajax('GET', '/global/api/GetCSDetailListByMasterId/' + masterId, [], 'json', GetCSDetailListByMasterId);

            Common.Ajax('GET', '/global/api/GetPurchaseOrderNo/' + requisitionId, [], 'json', GetPONumberByrequisitionId);
        }

        function GetPONumberByrequisitionId(response) {
            $("#poNo").val(response.autoNumber);
        }

        function GetCSDetailListByMasterId(response) {

            $("#Suppliertbl tbody>tr").empty();
            //console.log(response);

            $.each(response, function (key, value) {

                index = $("#Suppliertbl tbody>tr").length;
                var dtTable = $("#Suppliertbl");
                var tableBody = dtTable.find('tbody');
                var trHtml = '<tr>' +
                    '<td>' + value.orgCode + '</td>' +
                    '<td>' + value.organizationName + '</td>' +
                    '<td>' + value.total + '</td>' +

                    '<td><a href="javascript:void(0)" data-toggle="tooltip" title="Delete" class="btn btn-info btn-xs" onclick="AddItem(' + value.supplierId + ',' + "'" + value.personName + "'" + ',' + "'" + value.contactNo + "'" + ',' + "'" + value.organizationName + "'" + ')"><i class="fa fa-info-circle"></i></a>&nbsp;&nbsp;' +

                    '</tr>';

                tableBody.append(trHtml);
            })
        }

        function AddItem(supplierId, personName, mobile, orgName) {
            $("#supplier").val(orgName);
            $("#contactPerson").val(personName);
            $("#contactNo").val(mobile);
            $("#txtSupplierId").val(supplierId);
            Common.Ajax('GET', '/global/api/GetCSDetailListBySupplierId/' + supplierId, [], 'json', GetCSDetailListBySupplierId);
        }

        function GetCSDetailListBySupplierId(response) {

            $("#poDetailsListTable tbody>tr").empty();
            console.log(response);

            $.each(response, function (key, value) {

                index = $("#poDetailsListTable tbody>tr").length;
                var dtTable = $("#poDetailsListTable");
                var tableBody = dtTable.find('tbody');
                var trHtml = '<tr>' +
                    '<td>' + value.itemCode + '</td>' +
                    '<td>' + value.itemName + '</td>' +
                    '<td>' + value.itemSpec + '</td>' +
                    '<td>' + value.unit + '</td>' +
                    '<td>' + value.qnt + '</td>' +
                    '<td>' + value.UnorderQnt + '</td>' +
                    '<td>' + value.CSUnitPrice + '</td>' +

                    '<td><a href="javascript:void(0)" data-toggle="tooltip" title="Delete" class="btn btn-info btn-xs" onclick="AddModal('+ value.csDetailsId + ',' + value.itemId + ',' + "'" + value.itemCode + "'" + ',' + "'" + value.itemName + "'" + ',' + "'" + value.itemSpec + "'" + ',' + "'" + value.unit + "'" + ',' + "'" + value.qnt + "'" + ',' + "'" + value.UnorderQnt + "'" + ',' + "'" + value.CSUnitPrice + "'" + ',' + "'" + value.PRQnt + "'" + ')"><i class="fa fa-info-circle"></i></a>&nbsp;&nbsp;' +

                    '</tr>';

                tableBody.append(trHtml);
            })
        }

        function AddModal(reqDetailsId, itemId, itemCode, itemName, specificationName, unitName, reqQty, reqRate) {
            $("#HiddenItemId").val(itemId);
            $("#HiddencsDetailsId").val(reqDetailsId);
            $("#txtcode").val(itemCode);
            $("#txtname").val(itemName);
            $("#txtunit").val(unitName);
            $("#txtSpec").val(specificationName);
            $("#txtPRQty").val(reqQty);
            $("#txtUnOrderedQty").val(reqQty);

            $("#ValidatModal").modal("show");
        }

        function OrderQTYKey(thisOQVal) {
            if (isNaN(thisOQVal) == true || thisOQVal == "") {
                thisOQVal = 0;
            }
            var orderQty = parseFloat($("#txtOrderedQty").val());
            if (orderQty > parseFloat($("#txtUnOrderedQty").val())) {
                swal('Attention!', "Order quantity must be less then unorder quantity", 'warning')
                $("#txtOrderedQty").val('');
            }
            else {
                VATA = parseFloat($('#txtVatAmount').val());
                URate = $('#txtUnitRate').val();
                OQ = parseFloat(thisOQVal) * parseFloat(URate);
                $('#txtAmtExVat').val(OQ).number(true, 2);
                if (isNaN(VATA)) {
                    VATA = 0;
                }
                $('#txtTotalAmount').val(OQ + VATA).number(true, 2);
            }
        }

        function VATKey(thisVATVal) {
            if (isNaN(thisVATVal) == true || thisVATVal == "") {
                thisVATVal = 1;
            }
            var OrdQTY = parseFloat($('#txtOrderedQty').val());
            VATA = parseFloat(thisVATVal);
            URate = parseFloat($('#txtUnitRate').val());
            if (thisVATVal == 1) {
                OQ = 0;
            }
            else {
                OQ = (OrdQTY * URate * VATA) / 100;
            }
            $('#txtVatAmount').val(OQ).number(true, 2);
            $('#txtTotalAmount').val(OQ + (URate * OrdQTY)).number(true, 2);
        }

        function AITKey(thisAIT) {
            if (thisAIT == "") {
                thisAIT = 0;
            }
            var AITAMT = 0;
            var VATAMT = 0;
            var AITP = parseFloat(thisAIT);
            var OrdQTY = parseFloat($('#txtOrderedQty').val());
            var unitRate = parseFloat($('#txtUnitRate').val());
            var VATP = parseFloat($('#txtVat').val());
            if (isNaN(VATP)) {
                VATP = 0;
            }
            AITAMT = ((OrdQTY * unitRate) * AITP) / 100;
            $('#txtAitAmount').val(AITAMT).number(true, 2);
            $('#txtAitIncludeAmount').val(AITAMT + (OrdQTY * unitRate)).number(true, 2);
            VATAMT = ((AITAMT + (OrdQTY * unitRate)) * VATP) / 100;
            $('#txtLOAVatAmount').val(VATAMT).number(true, 2);
            $('#txtTotalAmount').val(VATAMT + AITAMT + (OrdQTY * unitRate)).number(true, 2);
        }

        function addCurrencyRate() {
            if ($('#currency').val() == 1) {
                $('#currencyRate').hide();
                $('#currencyRate').val('');
                $('#txtUnitRate').val(bdtUnitRate);
            }
            else {
                $('#currencyRate').show();
            }
        }
                
        function AddItemInfo() {

            var ifExistIndex = window.localStorage.getItem("holdIndex");
            var index = "0";
            if (ifExistIndex == "null" || ifExistIndex == null) {
                index = $("#poDetailsItemListTable tbody>tr").length;
            }
            else {
                index = ifExistIndex;
                tdRID = $("#poDetailsItemListTable tbody >tr:eq(" + ifExistIndex + ") td:eq(0) .clsId").val();
            }


            let id = parseInt($("#contactid").val()) ? parseInt($("#contactid").val()) : 0;

            let txtcode = $('#txtcode').val();
            let txtname = $('#txtname').val();
            let HiddencsDetailsId = $('#HiddencsDetailsId').val();
            let txtUnOrderedQty = $('#txtUnOrderedQty').val();
            let txtOrderedQty = $('#txtOrderedQty').val();
            let txtUnitRate = $('#txtUnitRate').val();
            let txtAmtExVat = $('#txtAmtExVat').val();
            let txtTotalAmount = $('#txtTotalAmount').val();
            let txtDescription = $('#txtDescription').val();
            let txtVat = $('#txtVat').val();
            let txtVatAmount = $('#txtVatAmount').val();
            let txtAit = $('#txtAit').val();
            let txtAitAmount = $('#txtAitAmount').val();
            let currency = $('#currency').val();
            let currencyRate = $('#currencyRate').val();
            let txtOtherLocation = $('#txtOtherLocation').val();

            let txtLocation = $('#txtLocation').val();
            if (txtLocation == null || txtLocation == '') {
                swal("Warning", "Please entry Location first", "warning");
                return
            }

            if (txtOrderedQty == null || txtOrderedQty == '') {
                swal("Warning", "Please entry order quantity first", "warning");
                return
            }

            if (txtUnitRate == null || txtUnitRate == '') {
                swal("Warning", "Please entry unit rate first", "warning");
                return
            }

            if (txtOtherLocation == null || txtOtherLocation == '') {
                txtOtherLocation = "N/A";
            }

            if (txtAitAmount == null || txtAitAmount == '') {
                txtAitAmount = 0;
            }
            if (txtAit == null || txtAit == '') {
                txtAit = 0;
            }
            if (txtVatAmount == null || txtVatAmount == '') {
                txtVatAmount = 0;
            }
            if (txtAmtExVat == null || txtAmtExVat == '') {
                txtAmtExVat = 0;
            }
            if (txtVat == null || txtVat == '') {
                txtVat = 0;
            }

            if (txtDescription == null || txtDescription == '') {
                txtDescription = "N/A";
            }

            var editOption = parseInt($('#IsEditCon').val()) ? parseInt($('#IsEditCon').val()) : 0;
            var RowCount = $("#poDetailsItemListTable tbody>tr").length;

            for (i = 0; i < RowCount; i++) {

                var _itemId = $('#txtcode' + i + '').val();
                if (_itemId == txtcode && editOption == 0) {
                    swal("Warning", "You have already added this item!", "warning");
                    return false;
                }
            }

            var dtTable = $("#poDetailsItemListTable");
            var tableBody = dtTable.find('tbody');
            var trHtml = '<tr id=' + index + '>' +
                '<td>' + txtcode + '<input type="hidden" name="txtcodeall"  id="txtcode' + index + '" value="' + txtcode + '"/></td>' +
                '<td>' + txtname + '<input type="hidden"name="reqDetailsall" value="' + HiddencsDetailsId + '"/><input type="hidden" name="txtDescriptionall" value="' + txtDescription + '"/><input type="hidden" name="txtAitall" value="' + txtAit + '"/></td>' +
                '<td>' + txtUnOrderedQty + '<input type="hidden" name="txtVatall" value="' + txtVat + '"/><input type="hidden" name="txtAitAmountall" value="' + txtAitAmount + '"/><input type="hidden" name="currencyall" value="' + currency + '"/></td>' +
                '<td>' + txtOrderedQty + '<input type="hidden"name="poQntall" value="' + txtOrderedQty + '"/><input type="hidden" name="currencyRateall" value="' + currencyRate + '"/></td>' +
                '<td>' + txtUnitRate + '<input type="hidden"name="txtUnitRateall" value="' + txtUnitRate + '"/><input type="hidden" name="txtOtherLocationall" value="' + txtOtherLocation + '"/></td>' +
                '<td>' + txtAmtExVat + '<input type="hidden"name="txtAmtExVatall" value="' + txtAmtExVat + '"/><input type="hidden" name="txtLocationall" value="' + txtLocation + '"/></td>' +
                '<td>' + txtTotalAmount + '<input type="hidden"name="txtVatAmountall" value="' + txtVatAmount + '"/><input type="hidden" class="clsTotalAmount" value="' + txtTotalAmount + '"/></td>' +


                '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="DeleteContact(' + index + ')"><i class="fa fa-trash"></i></a>&nbsp;&nbsp;' +
                //'<a onclick="EditconTbl(' + index + "', '" + phone + "','" + mobile + ", " + resouceid + ", " +id + ')" href="javascript:void(0)" title="Edit" class="btn btn-success btn-xs" > <i class="fa fa-edit"></i></a >' +

                '</tr>';

            if (ifExistIndex == null || ifExistIndex == "null") {
                tableBody.append(trHtml);
            }
            else {
                var rowUpdate = $("#poDetailsItemListTable tbody >tr:eq(" + ifExistIndex + ")");
                rowUpdate.replaceWith(trHtml);
                window.localStorage.setItem("holdIndex", null);
                ifExistIndex = null;
            }
            index = index + 1;
           
            $("#ValidatModal").modal("hide");
            ClearModalControls();
            TotalAmt();
        }

        function TotalAmt() {
            let sum = 0;
            $(".clsTotalAmount").each(function () {
                sum += +parseFloat($(this).val().replace(/,/g, '')) ? parseFloat($(this).val().replace(/,/g, '')) : 0;
            });
            $('#grandTotal').html(sum);
        }

        function ClearModalControls() {
            $('#txtOrderedQty').val('');
            $('#txtUnitRate').val('');
            $('#txtAmtExVat').val('');
            $('#txtAit').val('');
            $('#txtAitAmount').val('');
            $('#txtAitIncludeAmount').val('');
            $('#txtVat').val('');
            $('#txtVatAmount').val('');
            $('#txtTotalAmount').val('');
        }

        function DeleteContact(index) {
            swal({
                title: 'Are you sure?', text: 'Do you want to delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, delete it!'
            }).then(function () {
                $("#poDetailsItemListTable #" + index).remove();
                swal('', 'Deleted Successfully!', 'success')
            });

            return false;
        }

        function OtherLocation() {
            if ($("#txtLocation").val() == 5) {
                $(".txtOtherLocation").show();
            } else {
                $(".txtOtherLocation").hide();
            }
        }

    </script>
}

